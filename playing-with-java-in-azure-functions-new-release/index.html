<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Playing with Java in Azure Functions - New Release | Nebrass Homepage</title><meta name=keywords content><meta name=description content="In one of the previous posts, I introduced the Azure Functions Java. I felt that I need to write a dedicated tutorial to this great Azure Serverless service üòÅ
In this post, I will be covering many concepts in deep:
 Triggers¬†and¬†bindings Events and messaging Deployments & Consumptions Monitoring  Generating the hello-world project We will scaffold a Java-based Azure Function project using Maven Archetypes, using this command:"><meta name=author content><link rel=canonical href=https://blog.nebrass.fr/playing-with-java-in-azure-functions-new-release/><link crossorigin=anonymous href=/assets/css/stylesheet.min.9aeab43847eb11aca320bfadedfe191ed6516dd768bf1314b534c4992aac901a.css integrity="sha256-muq0OEfrEayjIL+t7f4ZHtZRbddovxMUtTTEmSqskBo=" rel="preload stylesheet" as=style><script src=/js/prism.min.js></script>
<link rel=stylesheet href=/css/prism.min.css><link rel=icon href=https://blog.nebrass.fr/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.nebrass.fr/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.nebrass.fr/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.nebrass.fr/apple-touch-icon.png><link rel=mask-icon href=https://blog.nebrass.fr/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><style amp-custom>.main,.footer,.nav{max-width:calc(var(--main-width) + var(--gap) * 15)}</style><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,o,i,a,t,n,s){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,n=o.createElement(i),s=o.getElementsByTagName(i)[0],n.async=1,n.src=a,s.parentNode.insertBefore(n,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-111781986-1","auto"),ga("send","pageview"))</script><meta property="og:title" content="Playing with Java in Azure Functions - New Release"><meta property="og:description" content="In one of the previous posts, I introduced the Azure Functions Java. I felt that I need to write a dedicated tutorial to this great Azure Serverless service üòÅ
In this post, I will be covering many concepts in deep:
 Triggers¬†and¬†bindings Events and messaging Deployments & Consumptions Monitoring  Generating the hello-world project We will scaffold a Java-based Azure Function project using Maven Archetypes, using this command:"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.nebrass.fr/playing-with-java-in-azure-functions-new-release/"><meta property="og:image" content="https://blog.nebrass.fr/images/playing-with-java-in-azure-functions-new-release.webp"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-10-19T00:00:00+00:00"><meta property="article:modified_time" content="2019-10-19T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.nebrass.fr/images/playing-with-java-in-azure-functions-new-release.webp"><meta name=twitter:title content="Playing with Java in Azure Functions - New Release"><meta name=twitter:description content="In one of the previous posts, I introduced the Azure Functions Java. I felt that I need to write a dedicated tutorial to this great Azure Serverless service üòÅ
In this post, I will be covering many concepts in deep:
 Triggers¬†and¬†bindings Events and messaging Deployments & Consumptions Monitoring  Generating the hello-world project We will scaffold a Java-based Azure Function project using Maven Archetypes, using this command:"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://blog.nebrass.fr/posts/"},{"@type":"ListItem","position":3,"name":"Playing with Java in Azure Functions - New Release","item":"https://blog.nebrass.fr/playing-with-java-in-azure-functions-new-release/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Playing with Java in Azure Functions - New Release","name":"Playing with Java in Azure Functions - New Release","description":"In one of the previous posts, I introduced the Azure Functions Java. I felt that I need to write a dedicated tutorial to this great Azure Serverless service üòÅ\nIn this post, I will be covering many concepts in deep:\n Triggers¬†and¬†bindings Events and messaging Deployments \u0026amp; Consumptions Monitoring  Generating the hello-world project We will scaffold a Java-based Azure Function project using Maven Archetypes, using this command:","keywords":[],"articleBody":"In one of the previous posts, I introduced the Azure Functions Java. I felt that I need to write a dedicated tutorial to this great Azure Serverless service üòÅ\nIn this post, I will be covering many concepts in deep:\n Triggers¬†and¬†bindings Events and messaging Deployments \u0026 Consumptions Monitoring  Generating the hello-world project We will scaffold a Java-based Azure Function project using Maven Archetypes, using this command:\n1 2 3 4 5 6 7 8 9  $ mvn archetype:generate -DarchetypeGroupId=com.microsoft.azure \\  -DarchetypeArtifactId=azure-functions-archetype \\  -DappName=hello-world-app-example \\  -DappRegion=FranceCentral \\  -DresourceGroup=helloworld-rg \\  -DgroupId=com.helloworld.group \\  -DartifactId=helloworld-functions \\  -Dpackage=com.helloworld \\  -DinteractiveMode=false   The generated project will look like:\n The sample function looks like:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30  /** * Azure Functions with HTTP Trigger. */ public class Function { @FunctionName(\"HttpTrigger-Java\") public HttpResponseMessage run( @HttpTrigger(name = \"req\", methods = {HttpMethod.GET, HttpMethod.POST}, authLevel = AuthorizationLevel.FUNCTION) HttpRequestMessageOptionalString request, final ExecutionContext context) { context.getLogger().info(\"Java HTTP trigger processed a request.\"); // Parse query parameter  String query = request.getQueryParameters().get(\"name\"); String name = request.getBody().orElse(query); if (name == null) { return request .createResponseBuilder(HttpStatus.BAD_REQUEST) .body(\"Please pass a name on the query string or in the request body\") .build(); } else { return request .createResponseBuilder(HttpStatus.OK) .body(\"Hello, \" + name) .build(); } } }   You can grab the final sample project from GitHub.\nWe need to create the Function Application on the Azure portal. I already mentioned how to do that on the previous Azure Functions tutorial ü§ì\nBuilding the Azure Functions Application Before running the project, you need to build it: mvn package This Maven command will do the package-functions operation:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26  [INFO] ... [INFO] --- azure-functions-maven-plugin:1.3.4:package (package-functions) @ helloworld-functions --- [INFO] [INFO] Step 1 of 7: Searching for Azure Functions entry points [INFO] 1 Azure Functions entry point(s) found. [INFO] [INFO] Step 2 of 7: Generating Azure Functions configurations [INFO] Generation done. [INFO] [INFO] Step 3 of 7: Validating generated configurations [INFO] Validation done. [INFO] [INFO] Step 4 of 7: Saving empty host.json [INFO] Successfully saved to /Users/nebrass/azure/helloworld-functions/target/azure-functions/hello-world-example/host.json [INFO] [INFO] Step 5 of 7: Saving configurations to function.json [INFO] Starting processing function: HttpTrigger-Java [INFO] Successfully saved to /Users/nebrass/azure/helloworld-functions/target/azure-functions/hello-world-example/HttpTrigger-Java/function.json [INFO] [INFO] Step 6 of 7: Copying JARs to staging directory/Users/nebrass/azure/helloworld-functions/target/azure-functions/hello-world-example [INFO] Using 'UTF-8' encoding to copy filtered resources. [INFO] Copying 1 resource to /Users/nebrass/azure/helloworld-functions/target/azure-functions/hello-world-example [INFO] Copied successfully. [INFO] Step 7 of 7: Installing function extensions if needed [INFO] Extension bundle specified, skip install extension [INFO] Successfully built Azure Functions.   This command will create an azure-functions folder under the Maven target folder:\n In the Function.java class, shown in the sample code above, we have a function called HttpTrigger-Java, this is why we got a folder with the same name, with a function definition file called function.json file:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  { \"scriptFile\" : \"../helloworld-functions-1.0-SNAPSHOT.jar\", \"entryPoint\" : \"com.helloworld.Function.run\", \"bindings\" : [ { \"type\" : \"httpTrigger\", \"direction\" : \"in\", \"name\" : \"req\", \"methods\" : [ \"GET\", \"POST\" ] }, { \"type\" : \"http\", \"direction\" : \"out\", \"name\" : \"$return\" } ] }    The scriptFile is pointing on the packaged application JAR file. the entryPoint is pointing on the run method of the Function class; where the Azure Function is defined. The first element in the¬†bindings array is the HTTP Trigger. The type¬†and¬†direction¬†properties identify the trigger. The¬†name property identifies the function parameter that receives the request content. The methods array will list the HTTP verbs that are identifying the HTTP Request. The second element in the bindings array is the HTTP output binding. The type¬†and¬†direction¬†properties identify the binding. The¬†name property specifies how the function provides the response, in this case by using the function return value. This means, when we do a return \"Hello World\"; this String will be emitted as an HTTP Response.  Running \u0026 deploying the Azure Functions Application To run the project locally just do: mvn azure-functions:run\nTo deploy the project to your Azure Subscription: mvn azure-functions:deploy\n The azure-functions:deploy command needs that your Azure CLI have to be authenticated to your subscription ü§ì\n Triggers and bindings Triggers¬†are what cause a function to run. A¬†trigger¬†defines how a function is invoked and a function must have exactly one¬†trigger.¬†Triggers¬†have associated data, which is often provided as the payload of the function.\nBinding¬†to a function is a way of declaratively connecting another resource to the function;¬†bindings¬†may be connected as¬†input bindings,¬†output bindings, or both. Data from¬†bindings¬†is provided to the function as parameters.\nWe can mix and match different bindings¬†to suit your needs.¬†Bindings¬†are optional and a function might have one or multiple input and/or output¬†bindings.\nWith Triggers¬†and¬†bindings, we can avoid hardcoding access to other services. Our function receives data (for example, the content of a queue message) in function parameters. We send data (for example, to create a queue message) by using the return value of the function.\nHow works the triggers and Bindings ? ü§î I found a great animated GIF in the Azure Functions documentation that describes how Triggers and Bindings work ?\nIn Azure Functions, bindings are available as separate packages from the functions runtime. Extension bundles allow other functions access to all bindings through a configuration setting. HTTP and timer triggers are supported by default and don‚Äôt require an extension.\nExtension bundles for local development Extension bundles is a local development technology that helps us to add a compatible set of Functions binding extensions to our Azure Functions project.\nWhen used, these extension packages will be included in the deployment package when we deploy it to Azure. To avoid conflicts between packages, the Bundles guarantee that¬†the packaged extension inside are compatible with each other.\n To develop Azure Functions application locally, we need to have the latest version of Azure Functions Core Tools, which provide a local development experience for creating, developing, testing, running, and debugging Azure Functions locally.\n The host.json file included in the generated project skull enables the Extension Bundle:\n1 2 3 4 5 6 7  { \"version\": \"2.0\", \"extensionBundle\": { \"id\": \"Microsoft.Azure.Functions.ExtensionBundle\", \"version\": \"[1.*, 2.0.0)\" } }   This Extension Bundle includes these extensions:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38  [ { \"id\": \"Microsoft.Azure.WebJobs.Extensions.Storage\", \"version\": \"3.0.4\" }, { \"id\": \"Microsoft.Azure.WebJobs.Extensions.ServiceBus\", \"version\": \"3.0.3\" }, { \"id\": \"Microsoft.Azure.WebJobs.Extensions.EventHubs\", \"version\": \"3.0.3\" }, { \"id\": \"Microsoft.Azure.WebJobs.Extensions.SendGrid\", \"version\": \"3.0.0\" }, { \"id\": \"Microsoft.Azure.WebJobs.Extensions.DurableTask\", \"version\": \"1.8.3\" }, { \"id\": \"Microsoft.Azure.WebJobs.Extensions.EventGrid\", \"version\": \"2.0.0\" }, { \"id\": \"Microsoft.Azure.WebJobs.Extensions.CosmosDB\", \"version\": \"3.0.3\" }, { \"id\": \"Microsoft.Azure.WebJobs.Extensions.Twilio\", \"version\": \"3.0.0\" }, { \"id\": \"Microsoft.Azure.WebJobs.Extensions.SignalRService\", \"version\": \"1.0.0\" } ]   Great ! Now, we saw how things work and what is the idea behind the Azure Functions?\nNow, we will discuss our demo scenario.\nThe demo scenario In our demo will be dealing with Azure Functions that are dealing with Cosmos DB and Service Bus.\nFor development cycles, we will be based on Azure DevOps as mentioned in this post.\n In the next steps, we will create:\n a Cosmos DB account a Storage account a Service Bus namespace  Create Azure Cosmos DB Account We need to create a CosmosDB account:\n Click on Review + create and confirm the creation.\nAfter creating the CosmosDB account, we need to create our Database and our Container (some thing like the SQL Table üòÅ )\nTo do that, we need to go to the Overview section of the recently Cosmos DB Account, and click Add Container:\n Next, fill the creation form :\n Database id: university Container id: students Partition key: /id   Now, we need to plug the Cosmos DB connection to our application.\nFirst of all, we need to get the Cosmos DB Connection Key and next we will plug it in two locations:\n in the Azure Function Application portal in the local development project  Okey üòÅ let‚Äôs do that !\ngetting the Cosmos DB Connection key First of all, we need to go to the Keys menu, next choose the Read-write Keys section and copy the Primary Connection String, this property will be used in the Azure Function Application to access the Cosmos DB:\n Next, we will use this connection key in the next steps..\n1) Plug the connection Key to the Azure Function Application portal To plug the Connection Key to the Azure Function Application, we need to go to our Azure Function dashboard, and click on the Configuration menu:\n Next, we will access the Configuration listing:\n Now, click on the New application setting and paste the Connection Key to the form :\n After filling the form and validating the creation, you will be back to the Configuration listing, you need to click on Save to confirm the creation.\n2) Plug the connection Key to the local development project We will go back to the source code project. We will add this Connection Key to the l_ocal.settings.json_ file. The file will look like:\n1 2 3 4 5 6 7 8  { \"IsEncrypted\": false, \"Values\": { \"AzureWebJobsStorage\": \"\", \"CosmosDbConnection\": \"AccountEndpoint=https://hello-world-cosmos-db-account.documents.azure.com:443/;AccountKey=GHXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX==;\", \"FUNCTIONS_WORKER_RUNTIME\": \"java\" } }   That‚Äôs all for the Cosmos DB configuration part ! üòÅ\nAs you see, we have already an AzureWebJobsStorage entry that did not have a value, but in the Configuration listing we have already this entry in the Application Settings; just click on¬†the Show values button to show the values. Next, we need to copy this value and past it into the l_ocal.settings.json_ file:\n1 2 3 4 5 6 7 8  { \"IsEncrypted\": false, \"Values\": { \"AzureWebJobsStorage\": \"DefaultEndpointsProtocol=https;AccountName=helloworldexamplestorage;AccountKey=vs3aXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX==;EndpointSuffix=core.windows.net\", \"CosmosDbConnection\": \"AccountEndpoint=https://hello-world-cosmos-db-account.documents.azure.com:443/;AccountKey=GHXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX==;\", \"FUNCTIONS_WORKER_RUNTIME\": \"java\" } }   Great ! But from where comes this value? Why it did come automatically ?\nIf you go back and look to the Azure Function creation form, you will notice that there already a Storage creation element in the form:\n So the AzureWebJobsStorage entry comes from the create Azure Storage account.\nNow, we need to move to creating the Azure Service Bus namespace üòé\nCreate Azure Service bus namespace We need to create a new Azure Service Bus namespace:\n Click on Add or Create namespace to go to the creation form:\n Click on Create and confirm the creation.\nNext, we will create a Queue on which we will be sending some messages.¬†To do that, we need to click on + Queue:\n The Queue creation form:\n  Name: hello-world-app-queue Max queue size: 1 GB Time To Live: 14 Days We need to enable:  Enable dead lettering on message expiration ‚ÑπÔ∏è Dead lettering messages involves holding messages that cannot be successfully delivered to any receiver to a separate queue after they have expired. Messages do not expire in the dead letter queue, and it supports peek-lock delivery and all transactional operations.     A dedicated tutorial about sessions will come soon üòé ‚ÑπÔ∏è Service bus sessions allow ordered handling of unbounded sequences of related messages. With sessions enabled a queue can guarantee first-in-first-out delivery of messages.\n Now, we need to connect our Azure Functions with the Service Bus. To do that, we will do as we did with the Cosmos DB and the Storage Account: on the Service Bus Namespace dashboard, we need to go to the Shared access policies. Next, double click on the RootManageSharedAccessKey policy to show the keys window.\n In this window, just click on the Copy button of the Primary Connection String.\nNext, go back to the Configuration listing menu of our Azure Functions Application. We will add the Connection String as a setting called ServiceBusConnection:\n Next, we will need to add this same setting to our local.settings.json:\n1 2 3 4 5 6 7 8 9  { \"IsEncrypted\": false, \"Values\": { \"AzureWebJobsStorage\": \"DefaultEndpointsProtocol=https;AccountName=helloworldexamplestorage;AccountKey=vsXXXXXXXXXXXXXXXXXXXX==;EndpointSuffix=core.windows.net\", \"CosmosDbConnection\": \"AccountEndpoint=https://hello-world-cosmos-db-account.documents.azure.com:443/;AccountKey=GHXXXXXXXXXXXXXXXXXXXX==;\", \"ServiceBusConnection\": \"Endpoint=sb://hello-world-app-example.servicebus.windows.net/;SharedAccessKeyName=RootManageSharedAccessKey;SharedAccessKey=wc0XXXXXXXXXXXXXXXXXXXX=\", \"FUNCTIONS_WORKER_RUNTIME\": \"java\" } }   Perfect ! Let‚Äôs go back to do some Java üòÅ\nIf we look again to our scenario diagram, we need to write 3 functions:\n HTTP to Cosmos DB function HTTP to Service Bus function Service Bus Message to Cosmos DB function  In our sample project, we will be inserting a Student record into Cosmos DB and we will be pushing a Student message to Service Bus.\nThe Student class will look like:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41  public class Student { private String id; private String name; private String email; public Student(String id, String name, String email) { this.id = id; this.name = name; this.email = email; } public String getId() { return id; } public void setId(String id) { this.id = id; } public String getName() { return name; } public void setName(String name) { this.name = name; } public String getEmail() { return email; } public void setEmail(String email) { this.email = email; } @Override public String toString() { return \"{\\\"id\\\":\\\"\" + id + \"\\\", \\\"name\\\":\\\"\" + name + \"\\\", \\\"email\\\":\\\"\" + email + \"\\\"}\"; } }   HTTP to Cosmos DB function This function will have as input a Name and Email address, requested using the HTTP Post verb.¬†After parsing the request payload, this function will create a record of a Student in Cosmos DB.\nThe sample HTTP Hello World Function shown in the beginning of this tutorial, will be a good starting point:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30  /** * Azure Functions with HTTP Trigger. */ public class Function { @FunctionName(\"HttpTrigger-Java\") public HttpResponseMessage run( @HttpTrigger(name = \"req\", methods = {HttpMethod.GET, HttpMethod.POST}, authLevel = AuthorizationLevel.FUNCTION) HttpRequestMessageOptionalString request, final ExecutionContext context) { context.getLogger().info(\"Java HTTP trigger processed a request.\"); // Parse query parameter  String query = request.getQueryParameters().get(\"name\"); String name = request.getBody().orElse(query); if (name == null) { return request .createResponseBuilder(HttpStatus.BAD_REQUEST) .body(\"Please pass a name on the query string or in the request body\") .build(); } else { return request .createResponseBuilder(HttpStatus.OK) .body(\"Hello, \" + name) .build(); } } }   In the run() method, we will add an other parameter: the Cosmos DB Binding üòÅ the Azure Functions connector to Cosmos DB ü§ì\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  @FunctionName(\"CosmosDBStoreBinding\") public HttpResponseMessage run( @HttpTrigger( name = \"req\", methods = {HttpMethod.POST}, 1Ô∏è‚É£ authLevel = AuthorizationLevel.FUNCTION) HttpRequestMessageOptionalString request, @CosmosDBOutput( name = \"database\", databaseName = \"university\", collectionName = \"students\", connectionStringSetting = \"CosmosDbConnection\") 2Ô∏è‚É£ OutputBindingString outputItem, final ExecutionContext context) { ... }   1Ô∏è‚É£ I only kept the HTTP Post verb - I don‚Äôt want that the function get called using the HTTP Get verb.\n2Ô∏è‚É£ Here we are defining an OutputBinding parameter, that will hold the computing result to Cosmos DB. That‚Äôs why this parameter is annotated using the @CosmosDBOutput.\nThe @CosmosDBOutput annotation has these main attributes:\n name: The variable name used in function.json üëâ Here we will use ‚Äúdatabase‚Äù databaseName: Defines the database name of the CosmosDB to which to write üëâ Here we will use ‚Äúuniversity‚Äù collectionName: Defines the collection name of the CosmosDB to which to write üëâ Here we will use ‚Äústudents‚Äù connectionStringSetting: Defines the app setting name that contains the CosmosDB connection string- This is the same attribute that we already defined in the local.settings.json and also in the Configuration section of the Azure Function in the Azure Subscription üëâ Here we will use ‚ÄúCosmosDbConnection‚Äù  Next, in the method body, we will proceed to\n extract the request parameters create a Student record convert the record to JSON set its value to the OutputBinding make an HTTP Response to the caller  The complete method will look like:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41  @FunctionName(\"CosmosDBStoreBinding\") public HttpResponseMessage run( @HttpTrigger( name = \"req\", methods = {HttpMethod.POST}, authLevel = AuthorizationLevel.FUNCTION) HttpRequestMessageOptionalString request, @CosmosDBOutput( name = \"database\", databaseName = \"university\", collectionName = \"students\", connectionStringSetting = \"CosmosDbConnection\") OutputBindingString outputItem, final ExecutionContext context) { context.getLogger().info(\"Java HTTP trigger processed a request.\"); String name = \"empty\"; String email = \"empty\"; // Parse query parameter  if (request.getBody().isPresent()) { JSONObject jsonObject = new JSONObject(request.getBody().get()); name = jsonObject.getString(\"name\"); email = jsonObject.getString(\"email\"); } // Generate random ID  final String id = String.valueOf(Math.abs(new Random().nextInt())); // Generate document  Student student = new Student(id, name, email); final String database = JSONWriter.valueToString(student); context.getLogger().info(String.format(\"Document to be saved in DB: %s\", database)); outputItem.setValue(database); // return the document to calling client.  return request.createResponseBuilder(HttpStatus.OK) .body(database) .build(); }   Here, we used the Bindings explicitly, we can do the same thing, just by annotating the Function itself using the @OutputBinding - as we will not have an OutputBinding object to assign the value to it; we will have to return the value that we want to insert into Cosmos DB as a return value of run() method. The function can be written like this:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35  @FunctionName(\"CosmosDBStoreAnnotation\") @CosmosDBOutput( name = \"database\", databaseName = \"university\", collectionName = \"students\", connectionStringSetting = \"CosmosDbConnection\") public String run( @HttpTrigger( name = \"req\", methods = {HttpMethod.POST}, authLevel = AuthorizationLevel.FUNCTION) HttpRequestMessageOptionalString request, final ExecutionContext context) { context.getLogger().info(\"Java HTTP trigger processed a request.\"); String name = \"empty\"; String email = \"empty\"; // Parse query parameter  if (request.getBody().isPresent()) { JSONObject jsonObject = new JSONObject(request.getBody().get()); name = jsonObject.getString(\"name\"); email = jsonObject.getString(\"email\"); } // Generate random ID  final String id = String.valueOf(Math.abs(new Random().nextInt())); // Generate document  Student student = new Student(id, name, email); final String database = new JSONObject(student).toString(); context.getLogger().info(String.format(\"Document to be saved in DB: %s\", database)); return database; }   These two possible formats of the function will give the same result - just in the second one, we will not be able to define the HTTP Response to the caller client.\n‚ö†Ô∏è‚ö†Ô∏è At this level, the insertion in the Cosmos DB is not effective yet; at this stage, we don‚Äôt know if the creation will be done or may fail whatever the reason. This is why the Azure Functions have a verbose logging that will help us understand if things are going in the correct way or not.\nWhen you run the functions locally you can have these logs on your console:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42  $ mvn azure-functions:run [INFO] Scanning for projects... [INFO] [INFO] --------------------------- [INFO] Building Azure Java Functions 1.0-SNAPSHOT [INFO] --------------------------------[ jar ]--------------------------------- [INFO] [INFO] --- azure-functions-maven-plugin:1.3.4:run (default-cli) @ helloworld-functions --- [INFO] Azure Function App's staging directory found at: /Users/nebrass/azure/helloworld-functions/target/azure-functions/hello-world-app-example [INFO] Azure Functions Core Tools found. %%%%%% %%%%%% @ %%%%%% @ @@ %%%%%% @@ @@@ %%%%%%%%%%% @@@ @@ %%%%%%%%%% @@ @@ %%%% @@ @@ %%% @@ @@ %% @@ %% % Azure Functions Core Tools (2.7.1704 Commit hash: fbab3b9c1de5ab95e3b4b6a471ead62c4f37e89c) Function Runtime Version: 2.0.12742.0 ... [19/10/2019 17:20:13] Host initialized (201ms) [19/10/2019 17:20:13] Host started (236ms) [19/10/2019 17:20:13] Job host started Hosting environment: Production Content root path: /Users/nebrass/azure/helloworld-functions/target/azure-functions/hello-world-app-example Now listening on: http://0.0.0.0:7071 Application started. Press Ctrl+C to shut down. Http Functions: CosmosDBStoreAnnotation: [POST] http://localhost:7071/api/CosmosDBStoreAnnotation CosmosDBStoreBinding: [POST] http://localhost:7071/api/CosmosDBStoreBinding [19/10/2019 17:20:18] Host lock lease acquired by instance ID '0000000000000000000000009DB0E06C'.   Now, if we call one of the two available functions, the log will be displayed on the console.\nWe can call the CosmosDBStoreAnnotation function using the curl tool:\n1  $ curl -i -d '{\"name\":\"nebrass\", \"email\":\"lnibrass@gmail.com\"}' -H \"Content-Type: application/json\" -X POST http://localhost:7071/api/CosmosDBStoreAnnotation   The curl reponse will look like:\n1  {\"id\":\"1465275753\", \"name\":\"nebrass\", \"email\":\"lnibrass@gmail.com\"}%   In the console, we will find some thing that looks like this:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  [19/10/2019...] Executing HTTP request: { [19/10/2019...] \"requestId\": \"647ca147-3917-4323-951b-b0744c0e2367\", [19/10/2019...] \"method\": \"POST\", [19/10/2019...] \"uri\": \"/api/CosmosDBStoreAnnotation\" [19/10/2019...] } [19/10/2019...] Executing 'Functions.CosmosDBStoreAnnotation' (Reason='This function was programmatically called via the host APIs.', Id=7582d976-d517-4d43-9b12-f645464705e2) [19/10/2019...] Java HTTP trigger processed a request. [19/10/2019...] Document to be saved in DB: {\"id\":\"1465275753\", \"name\":\"nebrass\", \"email\":\"lnibrass@gmail.com\"} [19/10/2019...] Function \"CosmosDBStoreAnnotation\" (Id: 7582d976-d517-4d43-9b12-f645464705e2) invoked by Java Worker [19/10/2019...] Executed 'Functions.CosmosDBStoreAnnotation' (Succeeded, Id=7582d976-d517-4d43-9b12-f645464705e2) [19/10/2019...] Executed HTTP request: { [19/10/2019...] \"requestId\": \"647ca147-3917-4323-951b-b0744c0e2367\", [19/10/2019...] \"method\": \"POST\", [19/10/2019...] \"uri\": \"/api/CosmosDBStoreAnnotation\", [19/10/2019...] \"identities\": [ [19/10/2019...] { [19/10/2019...] \"type\": \"WebJobsAuthLevel\", [19/10/2019...] \"level\": \"Admin\" [19/10/2019...] } [19/10/2019...] ], [19/10/2019...] \"status\": 200, [19/10/2019...] \"duration\": 1161 [19/10/2019...] }   In this case; we see that everything is going well.\nBut, if there is a problem, we will not get a response for the curl command and in the log we will get something like:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24  [19/10/2019..] Executing HTTP request: { [19/10/2019..] \"requestId\": \"28cb88b7-3a7a-4c96-bacc-f70349d30cd9\", [19/10/2019..] \"method\": \"POST\", [19/10/2019..] \"uri\": \"/api/CosmosDBStoreAnnotation\" [19/10/2019..] } [19/10/2019..] Executing 'Functions.CosmosDBStoreAnnotation' (Reason='This function was programmatically called via the host APIs.', Id=627d4d5d-6064-4322-aa2d-5ee1050f9a89) [19/10/2019..] Java HTTP trigger processed a request. [19/10/2019..] Document to be saved in DB: {\"id\":\"1234769986\", \"name\":\"nebrass\", \"email\":\"lnibrass@gmail.com\"} [19/10/2019..] Function \"CosmosDBStoreAnnotation\" (Id: 627d4d5d-6064-4322-aa2d-5ee1050f9a89) invoked by Java Worker [19/10/2019..] Executed 'Functions.CosmosDBStoreAnnotation' (Failed, Id=627d4d5d-6064-4322-aa2d-5ee1050f9a89) [19/10/2019..] System.Private.CoreLib: Exception while executing function: Functions.CosmosDBStoreAnnotation. System.Private.CoreLib: The input is not a valid Base-64 string as it contains a non-base 64 character, more than two padding characters, or an illegal character among the padding characters. [19/10/2019..] Executed HTTP request: { [19/10/2019..] \"requestId\": \"28cb88b7-3a7a-4c96-bacc-f70349d30cd9\", [19/10/2019..] \"method\": \"POST\", [19/10/2019..] \"uri\": \"/api/CosmosDBStoreAnnotation\", [19/10/2019..] \"identities\": [ [19/10/2019..] { [19/10/2019..] \"type\": \"WebJobsAuthLevel\", [19/10/2019..] \"level\": \"Admin\" [19/10/2019..] } [19/10/2019..] ], [19/10/2019..] \"status\": 500, [19/10/2019..] \"duration\": 14 [19/10/2019..] }   We can easily notice that there is a problem in the execution, and even there is a {status: 500} for the HTTP Request, which is the same headers sent back to the curl command.\nGreat ! Let‚Äôs continue our trip ! ü§©\nHTTP to Service Bus function Based on the previous section, the HTTP to Service Bus Function will look like:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34  @FunctionName(\"ServiceBusStoreAnnotation\") @ServiceBusQueueOutput( name = \"hello-world-app-queue-output\", queueName = \"hello-world-app-queue\", connection = \"ServiceBusConnection\") public String run( @HttpTrigger( name = \"req\", methods = {HttpMethod.POST}, authLevel = AuthorizationLevel.FUNCTION) HttpRequestMessageOptionalString request, final ExecutionContext context) { context.getLogger().info(\"Java HTTP trigger processed a request.\"); String name = EMPTY; String email = EMPTY; // Parse query parameter  if (request.getBody().isPresent()) { JSONObject jsonObject = new JSONObject(request.getBody().get()); name = jsonObject.getString(\"name\"); email = jsonObject.getString(\"email\"); } // Generate random ID  final String id = String.valueOf(new Random().nextInt()); // Generate Student  Student student = new Student(id, name, email); final String message = student.toString(); context.getLogger().info(String.format(\"Document to be sent to Queue: %s\", message)); return message; }   When called, the log of this function will look like:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  [19/10/2019..] Executing HTTP request: { [19/10/2019..] \"requestId\": \"a36738f3-e1fa-4c78-8600-7b4039382703\", [19/10/2019..] \"method\": \"POST\", [19/10/2019..] \"uri\": \"/api/ServiceBusStoreAnnotation\" [19/10/2019..] } [19/10/2019..] Executing 'Functions.ServiceBusStoreAnnotation' (Reason='This function was programmatically called via the host APIs.', Id=149530e6-d0c9-4c90-b582-726c6cac7cc0) [19/10/2019..] Java HTTP trigger processed a request. [19/10/2019..] Document to be sent to Queue: {\"id\":\"954440360\", \"name\":\"nebrass\", \"email\":\"lnibrass@gmail.com\"} [19/10/2019..] Function \"ServiceBusStoreAnnotation\" (Id: 149530e6-d0c9-4c90-b582-726c6cac7cc0) invoked by Java Worker [19/10/2019..] Executed 'Functions.ServiceBusStoreAnnotation' (Succeeded, Id=149530e6-d0c9-4c90-b582-726c6cac7cc0) [19/10/2019..] Executed HTTP request: { [19/10/2019..] \"requestId\": \"a36738f3-e1fa-4c78-8600-7b4039382703\", [19/10/2019..] \"method\": \"POST\", [19/10/2019..] \"uri\": \"/api/ServiceBusStoreAnnotation\", [19/10/2019..] \"identities\": [ [19/10/2019..] { [19/10/2019..] \"type\": \"WebJobsAuthLevel\", [19/10/2019..] \"level\": \"Admin\" [19/10/2019..] } [19/10/2019..] ], [19/10/2019..] \"status\": 200, [19/10/2019..] \"duration\": 1300 [19/10/2019..] }   Everything is good ! No Bad News Is Good News¬†! As there is no errors means every thing is working like a charm ü•≥\nWe can check on the Azure Portal that there is a Message on the Service Bus Queue:\n Service Bus Message to Cosmos DB function Now, we will create the function that will be triggered by a message in the Service Bus Queue and will insert data to Cosmos DB. The function will look like:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  @FunctionName(\"ServiceBusMessageToCosmosDb\") public void run( @ServiceBusQueueTrigger( name = \"messageTrigger\", queueName = \"hello-world-app-queue\", connection = \"ServiceBusConnection\" ) String student, @CosmosDBOutput( name = \"database\", databaseName = \"university\", collectionName = \"students\", connectionStringSetting = \"CosmosDbConnection\") OutputBindingString outputItem, final ExecutionContext context) { context.getLogger().info(String.format(\"Service Bus message trigger processed a request: %s\", student)); // This line will be used to validate the received JSON  String jsonValue = new JSONObject(student).toString(); context.getLogger().info(String.format(\"Document to be saved in DB: %s\", jsonValue)); outputItem.setValue(jsonValue); }   When we run our Functions Application, the Message that is already in the Service Bus Queue will be consumed - the execution log:\n1 2 3 4 5 6 7 8 9 10  [19/10/2019..] Executing 'Functions.ServiceBusMessageToCosmosDb' (Reason='New ServiceBus message detected on 'hello-world-app-queue'.', Id=dcb8e81d-f09e-48ee-a236-49542ae2e34d) [19/10/2019..] Trigger Details: MessageId: f5a0a1d6e5e94fc790aed052217dda5a, DeliveryCount: 1, EnqueuedTime: 19/10/2019 17:47:39, LockedUntil: 19/10/2019 18:00:44 [19/10/2019..] Service Bus message trigger processed a request: { [19/10/2019..] \"id\": \"954440360\", [19/10/2019..] \"name\": \"nebrass\", [19/10/2019..] \"email\": \"lnibrass@gmail.com\" [19/10/2019..] } [19/10/2019..] Document to be saved in DB: {\"name\":\"nebrass\",\"id\":\"954440360\",\"email\":\"lnibrass@gmail.com\"} [19/10/2019..] Function \"ServiceBusMessageToCosmosDb\" (Id: dcb8e81d-f09e-48ee-a236-49542ae2e34d) invoked by Java Worker [19/10/2019..] Executed 'Functions.ServiceBusMessageToCosmosDb' (Succeeded, Id=dcb8e81d-f09e-48ee-a236-49542ae2e34d)   Yooppi ü•≥ every thing is working like a charm ! ü•∞\nNow, we will see how to debug our Azure Functions Java Application üòÅ\nDEBUGGING the Azure Functions Application Locally To debug the application locally just do: mvn clean package azure-functions:run -DenableDebug to run the Azure Functions application in the Debugging Mode.\nIn you IDE, you need to attach a debugger to the Host: localhost and the Port: 5005.\n  For NetBeans In the Debug menu, click on Attach Debugger:\n Next, in the Attach Debugger window, we need to make localhost as Host and 5005 as Port:\n Next, try to put a breakpoint and call your application, you will see your application pause on your breakpoint:\n   For IntelliJ In the Run menu, select Edit Configurations, next click on the (+) button.. On the Configuration section:\n Host: localhost Port: 5005 Cmd line arguments: -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5005   Now, you can put a breakpoint in your code, start the application in Debug Mode, run the Remote Debug configuration that you just created in IntelliJ. When you invoke one of the functions, you will see the application pause on the breakpoint.\n   Cool ! Let‚Äôs move to the deployment part ! ü§©\nDeploying the Azure Functions Java Application Let‚Äôs deploy our Azure Functions Application:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  $ mvn package azure-functions:deploy ... [INFO] --- azure-functions-maven-plugin:1.3.4:deploy (default-cli) @ helloworld-functions --- [INFO] Authenticate with Azure CLI 2.0 [INFO] Updating the specified function app... [INFO] Java version of function host : 1.8 [INFO] Set function worker runtime to java [INFO] Successfully updated the function app.hello-world-app-example [INFO] Trying to deploy the function app... [INFO] Trying to deploy artifact to hello-world-app-example... [INFO] Successfully deployed the artifact to https://hello-world-app-example.azurewebsites.net [INFO] Successfully deployed the function app at https://hello-world-app-example.azurewebsites.net ...   Great! Our application is deployed ! ü•≥ü•≥\nLet‚Äôs enjoy our functions ! ü§©\nConsuming the Deployed Azure Functions Application In the deployment log, we see that our Functions App is deployed to https://hello-world-app-example.azurewebsites.net¬†.\nLet‚Äôs try our curl command on this host:\n1 2  $ curl -i -X POST https://hello-world-app-example.azurewebsites.net/api/ServiceBusStoreAnnotation -d '{\"name\":\"nebrass\", \"email\":\"lnibrass@gmail.com\"}'   We will get something like:\n1 2 3 4 5 6  HTTP/1.1 401 Unauthorized Set-Cookie: ARRAffinity=8ba760adb9686d1725150fb81799ab65bc89ea938e47cc3c421bf92dc2df040a;Path=/;HttpOnly;Domain=hello-world-app-example.azurewebsites.net Request-Context: appId=cid-v1:e3232f0f-c61a-48c2-92b8-537739c295b6 Set-Cookie: ARRAffinity=5d57fdaf326a15958b2bfa6786e779beb79860d9cad630e44e1343796e5fac76;Path=/;HttpOnly;Domain=hello-world-app-example.azurewebsites.net Date: Sat, 19 Oct 2019 18:20:29 GMT Content-Length: 0   HTTP 401 Unauthorized üò≥üò±üò≠üò∞üò£üò´ !!!\nBut from where comes the Authorization ? Did we secured our Functions ??\nActually, yes and this comes in the generated function sample. In the method signature, there is a @HttpTrigger¬†annotation with an attribute authLevel=AuthorizationLevel.FUNCTION¬†. In the Javadoc of this annotation, we see that authLevel determines what keys, if any, need to be present on the request in order to invoke the function. The authorization level can be one of the following values:\n anonymous: No API key is required. function: A function-specific API key is required. This is the default value if none is provided. admin: The master key is required.  Good ! So we need to have an API Key to be able to consume our Functions. Great, but from where we can get that? ü§ì\nKEEP CALM ! üò§ Everything is easy to find in the Azure Portal üòÅ\nGo to the Azure Functions Application, then click on Function App Settings:\n Next, in this window, you will find the default Host Keys:\n  The Azure Functions API keys can be either:\n a Host Key : an API Key that can be used with all the functions in the same application a Function Key: an API Key that can be used for only an assigned the function   Based on this definition, if we want to generate a Function Key, we need to go to the Function, next, click on Manage:\n Next, after you copy the Key, you need to include it to the request. We can do that in several ways:\n in the URL: https://APP_URL/api/CosmosDBStoreAnnotation?code=XXXXXXXXXXXXXXXXXXXXXXX in the headers, in a format: Key=x-functions-key and Value=XXXXXXXXXXXXXXXXXXXXXXX  Great ! Let‚Äôs test the curl again:\n1 2  $ curl -i -X POST https://hello-world-app-example.azurewebsites.net/api/ServiceBusStoreAnnotation?code=XXXXXXXXXXXXXXXXXXX== -d '{\"name\":\"nebrass\", \"email\":\"lnibrass@gmail.com\"}'   1 2 3 4 5 6 7 8 9  HTTP/1.1 200 OK Content-Length: 68 Content-Type: text/plain; charset=utf-8 Set-Cookie: ARRAffinity=aaaaaabbbbbbbbcccccccdddddeeeeeefffffff;Path=/;HttpOnly;Domain=hello-world-app-example.azurewebsites.net Request-Context: appId=cid-v1:12345678-abcd-efgh-xywz-537739c295b6 Set-Cookie: ARRAffinity=wwwwwwxxxxxxxxvvvvvvvuuuuuiiiiiihhhhhhh;Path=/;HttpOnly;Domain=hello-world-app-example.azurewebsites.net Date: Sat, 19 Oct 2019 20:03:48 GMT {\"id\":\"1251989744\", \"name\":\"nebrass\", \"email\":\"lnibrass@gmail.com\"}%   Youuppiiii !!! üòÅ\nMonitoring the Azure Functions Application When we created our application, we created an Application Insights account. To access the Azure Functions Monitoring, you need to go to the Function, next you click on the Monitor menu. Here you will find the latest requests with a small stats about the successful and failing ones:\n To check more, you can click on a request to see more details. Or even you can click on:\n Live app metrics to access the Metrics dashboard for our Functions application.    Run in Application Insights to access the detailed Logs and Log Analytics platform for our Functions application.   Cool ! As you see, we can do many crazy things easily with the Azure Functions, in a very efficient way. No hard configuration, no crazy yaml configuration files..\nThe Azure Functions is one of the most wonderful products that I like in the Azure world ü§© I really will try to go deep more and more in this great service. I will try to write an other tutorial when needed.\nFeel free to try in deep this tutorial and I will be interested to get your feedback. If you have a request or any inquiry, feel free to get in touch with me üòÑ\n","wordCount":"5172","inLanguage":"en","image":"https://blog.nebrass.fr/images/playing-with-java-in-azure-functions-new-release.webp","datePublished":"2019-10-19T00:00:00Z","dateModified":"2019-10-19T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.nebrass.fr/playing-with-java-in-azure-functions-new-release/"},"publisher":{"@type":"Organization","name":"Nebrass Homepage","logo":{"@type":"ImageObject","url":"https://blog.nebrass.fr/favicon.ico"}}}</script></head><body id=top><script>window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.nebrass.fr accesskey=h title="Nebrass Homepage (Alt + H)">Nebrass Homepage</a>
<span class=logo-switches></span></div><ul id=menu><li><a href=https://blog.nebrass.fr/ title=Posts><span>Posts</span></a></li><li><a href=https://blog.nebrass.fr/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://blog.nebrass.fr/categories/ title=Categories><span>Categories</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Playing with Java in Azure Functions - New Release</h1><div class=post-meta><span title="2019-10-19 00:00:00 +0000 UTC">October 19, 2019</span>&nbsp;¬∑&nbsp;25 min</div></header><figure class=entry-cover><img loading=lazy src=https://blog.nebrass.fr/images/playing-with-java-in-azure-functions-new-release.webp alt></figure><div class=post-content><p>In <a href=./playing-with-java-in-azure-functions-and-azure-devops/>one of the previous posts</a>, I introduced the <strong>Azure Functions Java</strong>. I felt that I need to write a dedicated tutorial to this great <strong>Azure Serverless service</strong> üòÅ</p><p>In this post, I will be covering many concepts in deep:</p><ul><li>Triggers¬†and¬†bindings</li><li>Events and messaging</li><li>Deployments & Consumptions</li><li>Monitoring</li></ul><h2 id=generating-the-hello-world-project>Generating the hello-world project<a hidden class=anchor aria-hidden=true href=#generating-the-hello-world-project>#</a></h2><p>We will <em>scaffold</em> a Java-based <strong>Azure Function</strong> project using <strong>Maven Archetypes</strong>, using this command:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ mvn archetype:generate -DarchetypeGroupId<span class=o>=</span>com.microsoft.azure <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -DarchetypeArtifactId<span class=o>=</span>azure-functions-archetype <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -DappName<span class=o>=</span>hello-world-app-example <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -DappRegion<span class=o>=</span>FranceCentral  <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -DresourceGroup<span class=o>=</span>helloworld-rg <span class=se>\ </span>
</span></span><span class=line><span class=cl>    -DgroupId<span class=o>=</span>com.helloworld.group <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -DartifactId<span class=o>=</span>helloworld-functions <span class=se>\ </span>
</span></span><span class=line><span class=cl>    -Dpackage<span class=o>=</span>com.helloworld <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -DinteractiveMode<span class=o>=</span><span class=nb>false</span>
</span></span></code></pre></td></tr></table></div></div><p>The generated project will look like:</p><div align=center><p><img loading=lazy src=../images/azure-functions-skaffold-structure.webp alt="Sample Azure Functions Java project structure"></p></div><p>The sample function looks like:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Azure Functions with HTTP Trigger.
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Function</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@FunctionName</span><span class=o>(</span><span class=s>&#34;HttpTrigger-Java&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>HttpResponseMessage</span> <span class=nf>run</span><span class=o>(</span>
</span></span><span class=line><span class=cl>            <span class=nd>@HttpTrigger</span><span class=o>(</span><span class=n>name</span> <span class=o>=</span> <span class=s>&#34;req&#34;</span><span class=o>,</span> 
</span></span><span class=line><span class=cl>                        <span class=n>methods</span> <span class=o>=</span> <span class=o>{</span><span class=n>HttpMethod</span><span class=o>.</span><span class=na>GET</span><span class=o>,</span> <span class=n>HttpMethod</span><span class=o>.</span><span class=na>POST</span><span class=o>},</span> 
</span></span><span class=line><span class=cl>                        <span class=n>authLevel</span> <span class=o>=</span> <span class=n>AuthorizationLevel</span><span class=o>.</span><span class=na>FUNCTION</span><span class=o>)</span> <span class=n>HttpRequestMessage</span><span class=o>&lt;</span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;&gt;</span> <span class=n>request</span><span class=o>,</span>
</span></span><span class=line><span class=cl>            <span class=kd>final</span> <span class=n>ExecutionContext</span> <span class=n>context</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>context</span><span class=o>.</span><span class=na>getLogger</span><span class=o>().</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;Java HTTP trigger processed a request.&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Parse query parameter
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>String</span> <span class=n>query</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=na>getQueryParameters</span><span class=o>().</span><span class=na>get</span><span class=o>(</span><span class=s>&#34;name&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>String</span> <span class=n>name</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=na>getBody</span><span class=o>().</span><span class=na>orElse</span><span class=o>(</span><span class=n>query</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>name</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>request</span>
</span></span><span class=line><span class=cl>                    <span class=o>.</span><span class=na>createResponseBuilder</span><span class=o>(</span><span class=n>HttpStatus</span><span class=o>.</span><span class=na>BAD_REQUEST</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                    <span class=o>.</span><span class=na>body</span><span class=o>(</span><span class=s>&#34;Please pass a name on the query string or in the request body&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                    <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>request</span>
</span></span><span class=line><span class=cl>                    <span class=o>.</span><span class=na>createResponseBuilder</span><span class=o>(</span><span class=n>HttpStatus</span><span class=o>.</span><span class=na>OK</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                    <span class=o>.</span><span class=na>body</span><span class=o>(</span><span class=s>&#34;Hello, &#34;</span> <span class=o>+</span> <span class=n>name</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                    <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>You can grab the <a href=http://github.com/nebrass/azure-functions-java-sample>final sample project from GitHub</a>.</p><p>We need to create the <strong>Function Application</strong> on the <strong>Azure portal</strong>. I already mentioned how to do that on the <a href=./playing-with-java-in-azure-functions-and-azure-devops/>previous Azure Functions tutorial</a> ü§ì</p><h4 id=building-the-azure-functions-application>Building the Azure Functions Application<a hidden class=anchor aria-hidden=true href=#building-the-azure-functions-application>#</a></h4><p>Before running the project, you need to build it: <code>mvn package</code> This <em>Maven</em> command will do the <strong>package-functions</strong> operation:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> ...
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> --- azure-functions-maven-plugin:1.3.4:package <span class=o>(</span>package-functions<span class=o>)</span> @ helloworld-functions ---
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> 
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Step <span class=m>1</span> of 7: Searching <span class=k>for</span> Azure Functions entry points
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> <span class=m>1</span> Azure Functions entry point<span class=o>(</span>s<span class=o>)</span> found.
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> 
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Step <span class=m>2</span> of 7: Generating Azure Functions configurations
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Generation <span class=k>done</span>.
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> 
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Step <span class=m>3</span> of 7: Validating generated configurations
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Validation <span class=k>done</span>.
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> 
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Step <span class=m>4</span> of 7: Saving empty host.json
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Successfully saved to /Users/nebrass/azure/helloworld-functions/target/azure-functions/hello-world-example/host.json
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> 
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Step <span class=m>5</span> of 7: Saving configurations to <span class=k>function</span>.json
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Starting processing <span class=k>function</span>: HttpTrigger-Java
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Successfully saved to /Users/nebrass/azure/helloworld-functions/target/azure-functions/hello-world-example/HttpTrigger-Java/function.json
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> 
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Step <span class=m>6</span> of 7: Copying JARs to staging directory/Users/nebrass/azure/helloworld-functions/target/azure-functions/hello-world-example
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Using <span class=s1>&#39;UTF-8&#39;</span> encoding to copy filtered resources.
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Copying <span class=m>1</span> resource to /Users/nebrass/azure/helloworld-functions/target/azure-functions/hello-world-example
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Copied successfully.
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Step <span class=m>7</span> of 7: Installing <span class=k>function</span> extensions <span class=k>if</span> needed
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Extension bundle specified, skip install extension
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Successfully built Azure Functions.
</span></span></code></pre></td></tr></table></div></div><p>This command will create an <strong>azure-functions</strong> folder under the <em>Maven</em> <strong>target</strong> folder:</p><div align=center><p><img loading=lazy src=../images/azure-functions-target-folder.webp alt></p></div><p>In the <em>Function.java</em> class, shown in the sample code above, we have a function called <em><strong>HttpTrigger-Java</strong></em>, this is why we got a folder with the same name, with a function definition file called <em>function.json</em> file:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;scriptFile&#34;</span> <span class=p>:</span> <span class=s2>&#34;../helloworld-functions-1.0-SNAPSHOT.jar&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;entryPoint&#34;</span> <span class=p>:</span> <span class=s2>&#34;com.helloworld.Function.run&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;bindings&#34;</span> <span class=p>:</span> <span class=p>[</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span> <span class=p>:</span> <span class=s2>&#34;httpTrigger&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;direction&#34;</span> <span class=p>:</span> <span class=s2>&#34;in&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;name&#34;</span> <span class=p>:</span> <span class=s2>&#34;req&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;methods&#34;</span> <span class=p>:</span> <span class=p>[</span> <span class=s2>&#34;GET&#34;</span><span class=p>,</span> <span class=s2>&#34;POST&#34;</span> <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span> <span class=p>:</span> <span class=s2>&#34;http&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;direction&#34;</span> <span class=p>:</span> <span class=s2>&#34;out&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;name&#34;</span> <span class=p>:</span> <span class=s2>&#34;$return&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>The <code>scriptFile</code> is pointing on the packaged application <em>JAR</em> file.</li><li>the <code>entryPoint</code> is pointing on the run method of the <em>Function</em> class; where the <em>Azure Function</em> is defined.</li><li>The first element in the¬†<code>bindings</code> array is the <strong>HTTP Trigger</strong>. The <code>type</code>¬†and¬†<code>direction</code>¬†properties identify the trigger. The¬†<code>name</code> property identifies the function parameter that receives the request content. The methods array will list the <strong>HTTP</strong> verbs that are identifying the <strong>HTTP Request</strong>. The second element in the <code>bindings</code> array is the <strong>HTTP output binding</strong>. The <code>type</code>¬†and¬†<code>direction</code>¬†properties identify the binding. The¬†<code>name</code> property specifies how the function provides the response, in this case by using the function return value. This means, when we do a <code>return "Hello World";</code> this String will be emitted as an <strong>HTTP Response</strong>.</li></ul><h4 id=running--deploying-the-azure-functions-application>Running & deploying the Azure Functions Application<a hidden class=anchor aria-hidden=true href=#running--deploying-the-azure-functions-application>#</a></h4><p>To run the project locally just do: <code>mvn azure-functions:run</code></p><p>To deploy the project to your Azure Subscription: <code>mvn azure-functions:deploy</code></p><blockquote><p>The <strong>azure-functions:deploy</strong> command needs that your Azure CLI have to be authenticated to your subscription ü§ì</p></blockquote><h2 id=triggers-and-bindings>Triggers and bindings<a hidden class=anchor aria-hidden=true href=#triggers-and-bindings>#</a></h2><p><strong>Triggers</strong>¬†are what cause a function to run. A¬†<strong>trigger</strong>¬†defines how a function is invoked and a function must have exactly one¬†<strong>trigger</strong>.¬†<strong>Triggers</strong>¬†have associated data, which is often provided as the payload of the function.</p><p><strong>Binding</strong>¬†to a function is a way of declaratively connecting another resource to the function;¬†<strong>bindings</strong>¬†may be connected as¬†<em>input bindings</em>,¬†<em>output bindings</em>, or both. Data from¬†<strong>bindings</strong>¬†is provided to the function as parameters.</p><p>We can mix and match different <strong>bindings</strong>¬†to suit your needs.¬†<strong>Bindings</strong>¬†are optional and a function might have one or multiple input and/or output¬†<strong>bindings</strong>.</p><p>With <strong>Triggers</strong>¬†and¬†<strong>bindings</strong>, we can avoid hardcoding access to other services. Our function receives data (for example, the content of a queue message) in function parameters. We send data (for example, to create a queue message) by using the return value of the function.</p><h3 id=how-works-the-triggers-and-bindings-->How works the triggers and Bindings ? ü§î<a hidden class=anchor aria-hidden=true href=#how-works-the-triggers-and-bindings-->#</a></h3><p>I found a great <em>animated GIF</em> in the <strong>Azure Functions</strong> documentation that describes how <strong>Triggers</strong> and <strong>Bindings</strong> work ?</p><p><img loading=lazy src=../images/how-azure-functions-work.gif alt="Diagram showing how Triggers and Bindings work"></p><p>In Azure Functions, <a href=https://docs.microsoft.com/en-us/azure/azure-functions/functions-triggers-bindings>bindings</a> are available as separate packages from the functions runtime. Extension bundles allow other functions access to all bindings through a configuration setting. HTTP and timer triggers are supported by default and don&rsquo;t require an extension.</p><h2 id=extension-bundles-for-local-development>Extension bundles for local development<a hidden class=anchor aria-hidden=true href=#extension-bundles-for-local-development>#</a></h2><p>Extension bundles is a local development technology that helps us to add a compatible set of Functions binding extensions to our Azure Functions project.</p><p>When used, these extension packages will be included in the deployment package when we deploy it to Azure. To avoid conflicts between packages, the Bundles guarantee that¬† the packaged extension inside are compatible with each other.</p><blockquote><p>To develop Azure Functions application locally, we need to have the latest version of <a href=https://docs.microsoft.com/en-us/azure/azure-functions/functions-run-local#v2>Azure Functions Core Tools</a>, which provide a local development experience for creating, developing, testing, running, and debugging Azure Functions locally.</p></blockquote><p>The <em>host.json</em> file included in the generated project skull enables the <em>Extension Bundle</em>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;2.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;extensionBundle&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;Microsoft.Azure.Functions.ExtensionBundle&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;[1.*, 2.0.0)&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>This Extension Bundle includes these extensions:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;Microsoft.Azure.WebJobs.Extensions.Storage&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;3.0.4&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;Microsoft.Azure.WebJobs.Extensions.ServiceBus&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;3.0.3&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;Microsoft.Azure.WebJobs.Extensions.EventHubs&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;3.0.3&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;Microsoft.Azure.WebJobs.Extensions.SendGrid&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;3.0.0&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;Microsoft.Azure.WebJobs.Extensions.DurableTask&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;1.8.3&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;Microsoft.Azure.WebJobs.Extensions.EventGrid&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;2.0.0&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;Microsoft.Azure.WebJobs.Extensions.CosmosDB&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;3.0.3&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;Microsoft.Azure.WebJobs.Extensions.Twilio&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;3.0.0&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;Microsoft.Azure.WebJobs.Extensions.SignalRService&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;1.0.0&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p>Great ! Now, we saw how things work and what is the idea behind the Azure Functions?</p><p>Now, we will discuss our demo scenario.</p><h2 id=the-demo-scenario>The demo scenario<a hidden class=anchor aria-hidden=true href=#the-demo-scenario>#</a></h2><p>In our demo will be dealing with Azure Functions that are dealing with Cosmos DB and Service Bus.</p><p>For development cycles, we will be based <a href=https://blog.nebrass.fr/playing-with-java-in-azure-functions-and-azure-devops/>on Azure DevOps as mentioned in this post</a>.</p><div align=center><p><img loading=lazy src=../images/azure-functions-scenario-1024x746.webp alt=azure-functions-scenario></p></div><p>In the next steps, we will create:</p><ul><li>a <strong>Cosmos DB</strong> account</li><li>a <strong>Storage</strong> account</li><li>a <strong>Service Bus</strong> namespace</li></ul><h2 id=create-azure-cosmos-db-account>Create Azure Cosmos DB Account<a hidden class=anchor aria-hidden=true href=#create-azure-cosmos-db-account>#</a></h2><p>We need to create a CosmosDB account:</p><div align=center><p><img loading=lazy src=../images/azure-monitor-cosmos-db-creation-1024x959.webp alt></p></div><p>Click on <strong>Review + create</strong> and confirm the creation.</p><p>After creating the <strong>CosmosDB account</strong>, we need to create our <strong>Database</strong> and our <strong>Container</strong> (some thing like the SQL Table üòÅ )</p><p>To do that, we need to go to the Overview section of the recently <strong>Cosmos DB Account</strong>, and click <strong>Add Container</strong>:</p><div align=center><p><img loading=lazy src=../images/azure-cosmos-db-create-container.webp alt></p></div><p>Next, fill the creation form :</p><ul><li>Database id: <strong>university</strong></li><li>Container id: <strong>students</strong></li><li>Partition key: <strong>/id</strong></li></ul><div align=center><p><img loading=lazy src=../images/azure-cosmos-db-create-container-form.webp alt></p></div><p>Now, we need to plug the <strong>Cosmos DB connection</strong> to our application.</p><p>First of all, we need to get the <strong>Cosmos DB Connection Key</strong> and next we will plug it in two locations:</p><ol><li>in the <em>Azure Function Application</em> portal</li><li>in the <em>local development</em> project</li></ol><p>Okey üòÅ let&rsquo;s do that !</p><h3 id=getting-the-cosmos-db-connection-key>getting the <strong>Cosmos DB Connection key</strong><a hidden class=anchor aria-hidden=true href=#getting-the-cosmos-db-connection-key>#</a></h3><p>First of all, we need to go to the <strong>Keys</strong> menu, next choose the <strong>Read-write Keys</strong> section and copy the <strong><em>Primary Connection String</em></strong>, this property will be used in the <strong>Azure Function Application</strong> to access the <strong>Cosmos DB</strong>:</p><div align=center><p><img loading=lazy src=../images/azure-cosmos-db-keys-1024x416.webp alt></p></div><p>Next, we will use this <strong>connection key</strong> in the next steps..</p><h3 id=1-plug-the-connection-key-to-the-azure-function-application-portal>1) Plug the connection Key to the Azure Function Application portal<a hidden class=anchor aria-hidden=true href=#1-plug-the-connection-key-to-the-azure-function-application-portal>#</a></h3><p>To plug the <strong>Connection Key</strong> to the <strong>Azure Function Application</strong>, we need to go to our <strong>Azure Function</strong> <strong>dashboard</strong>, and click on the <strong>Configuration</strong> menu:</p><div align=center><p><img loading=lazy src=../images/function-app-dashboard-configuration-1024x558.webp alt></p></div><p>Next, we will access the <strong>Configuration listing</strong>:</p><div align=center><p><img loading=lazy src=../images/function-app-configuration-listing.webp alt></p></div><p>Now, click on the <strong>New application setting</strong> and paste the <strong>Connection Key</strong> to the form :</p><div align=center><p><img loading=lazy src=../images/function-app-configuration-new-application-setting.webp alt></p></div><p>After filling the form and validating the creation, you will be back to the <strong>Configuration listing</strong>, you need to click on <strong>Save</strong> to confirm the creation.</p><h3 id=2-plug-the-connection-key-to-the-local-development-project>2) Plug the connection Key to the local development project<a hidden class=anchor aria-hidden=true href=#2-plug-the-connection-key-to-the-local-development-project>#</a></h3><p>We will go back to the source code project. We will add this Connection Key to the l_ocal.settings.json_ file. The file will look like:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;IsEncrypted&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;Values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;AzureWebJobsStorage&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;CosmosDbConnection&#34;</span><span class=p>:</span> <span class=s2>&#34;AccountEndpoint=https://hello-world-cosmos-db-account.documents.azure.com:443/;AccountKey=GHXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX==;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;FUNCTIONS_WORKER_RUNTIME&#34;</span><span class=p>:</span> <span class=s2>&#34;java&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>That&rsquo;s all for the <strong>Cosmos DB</strong> configuration part ! üòÅ</p><p>As you see, we have already an <strong>AzureWebJobsStorage</strong> entry that did not have a value, but in <strong>the Configuration listing</strong> we have already this entry in the <strong>Application Settings</strong>; just click on¬† the <strong>Show values</strong> button to show the values. Next, we need to copy this value and past it into the l_ocal.settings.json_ file:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;IsEncrypted&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;Values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;AzureWebJobsStorage&#34;</span><span class=p>:</span> <span class=s2>&#34;DefaultEndpointsProtocol=https;AccountName=helloworldexamplestorage;AccountKey=vs3aXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX==;EndpointSuffix=core.windows.net&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;CosmosDbConnection&#34;</span><span class=p>:</span> <span class=s2>&#34;AccountEndpoint=https://hello-world-cosmos-db-account.documents.azure.com:443/;AccountKey=GHXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX==;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;FUNCTIONS_WORKER_RUNTIME&#34;</span><span class=p>:</span> <span class=s2>&#34;java&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Great ! But from where comes this value? Why it did come automatically ?</p><p>If you go back and look to the <strong>Azure Function creation form</strong>, you will notice that there already a <strong>Storage creation</strong> element in the form:</p><div align=center><p><img loading=lazy src=../images/azure-create-function-step1.webp alt></p></div><p>So the <strong>AzureWebJobsStorage</strong> entry comes from the create Azure Storage account.</p><p>Now, we need to move to creating the <strong>Azure Service Bus namespace</strong> üòé</p><h2 id=create-azure-service-bus-namespace>Create Azure Service bus namespace<a hidden class=anchor aria-hidden=true href=#create-azure-service-bus-namespace>#</a></h2><p>We need to create a new <strong>Azure Service Bus namespace</strong>:</p><div align=center><p><img loading=lazy src=../images/azure-monitor-service-bus-home-1024x607.webp alt></p></div><p>Click on <strong>Add</strong> or <strong>Create namespace</strong> to go to the creation form:</p><div align=center><p><img loading=lazy src=../images/azure-monitor-service-bus-ns-creation-186x300.webp alt></p></div><p>Click on <strong>Create</strong> and confirm the creation.</p><p>Next, we will create a <strong>Queue</strong> on which we will be sending some messages.¬† To do that, we need to click on <strong>+ Queue:</strong></p><div align=center><p><img loading=lazy src=../images/azure-service-bus-dashboard.webp alt></p></div><p>The <strong>Queue</strong> creation form:</p><div align=center><p><img loading=lazy src=../images/azure-bus-create-queue-hello-world-app.webp alt></p></div><ul><li>Name: <strong>hello-world-app-queue</strong></li><li>Max queue size: <strong>1 GB</strong></li><li>Time To Live: <strong>14 Days</strong></li><li>We need to enable:<ul><li><strong>Enable dead lettering on message expiration</strong> ‚ÑπÔ∏è Dead lettering messages involves holding messages that cannot be successfully delivered to any receiver to a separate queue after they have expired. Messages do not expire in the dead letter queue, and it supports peek-lock delivery and all transactional operations.</li></ul></li></ul><blockquote><p><strong>A dedicated tutorial about sessions will come soon üòé</strong> ‚ÑπÔ∏è Service bus sessions allow ordered handling of unbounded sequences of related messages. With sessions enabled a queue can guarantee first-in-first-out delivery of messages.</p></blockquote><p>Now, we need to connect our <strong>Azure Functions</strong> with the <strong>Service Bus</strong>. To do that, we will do as we did with the <strong>Cosmos DB</strong> and the <strong>Storage Account</strong>: on the <strong>Service Bus Namespace</strong> dashboard, we need to go to the <strong>Shared access policies</strong>. Next, double click on the <strong>RootManageSharedAccessKey</strong> policy to show the keys window.</p><div align=center><p><img loading=lazy src=../images/azure-service-bus-shared-access-keys.webp alt></p></div><p>In this window, just click on the <strong>Copy button</strong> of the <strong>Primary Connection String</strong>.</p><p>Next, go back to the <strong>Configuration listing</strong> menu of our <strong>Azure Functions Application</strong>. We will add the <strong>Connection String</strong> as a setting called <strong>ServiceBusConnection</strong>:</p><div align=center><p><img loading=lazy src=../images/azure-service-bus-connection-form.webp alt></p></div><p>Next, we will need to add this same setting to our <em>local.settings.json</em>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;IsEncrypted&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;Values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;AzureWebJobsStorage&#34;</span><span class=p>:</span> <span class=s2>&#34;DefaultEndpointsProtocol=https;AccountName=helloworldexamplestorage;AccountKey=vsXXXXXXXXXXXXXXXXXXXX==;EndpointSuffix=core.windows.net&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;CosmosDbConnection&#34;</span><span class=p>:</span> <span class=s2>&#34;AccountEndpoint=https://hello-world-cosmos-db-account.documents.azure.com:443/;AccountKey=GHXXXXXXXXXXXXXXXXXXXX==;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ServiceBusConnection&#34;</span><span class=p>:</span> <span class=s2>&#34;Endpoint=sb://hello-world-app-example.servicebus.windows.net/;SharedAccessKeyName=RootManageSharedAccessKey;SharedAccessKey=wc0XXXXXXXXXXXXXXXXXXXX=&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;FUNCTIONS_WORKER_RUNTIME&#34;</span><span class=p>:</span> <span class=s2>&#34;java&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Perfect ! Let&rsquo;s go back to do some Java üòÅ</p><p>If we look again to our scenario diagram, we need to write 3 functions:</p><ul><li><strong>HTTP to Cosmos DB function</strong></li><li><strong>HTTP to Service Bus function</strong></li><li><strong>Service Bus Message to Cosmos DB function</strong></li></ul><p>In our sample project, we will be inserting a <strong>Student</strong> record into <strong>Cosmos DB</strong> and we will be pushing a <strong>Student</strong> message to <strong>Service Bus</strong>.</p><p>The <strong>Student</strong> class will look like:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Student</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>id</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>name</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>email</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>Student</span><span class=o>(</span><span class=n>String</span> <span class=n>id</span><span class=o>,</span> <span class=n>String</span> <span class=n>name</span><span class=o>,</span> <span class=n>String</span> <span class=n>email</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>id</span> <span class=o>=</span> <span class=n>id</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>name</span> <span class=o>=</span> <span class=n>name</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>email</span> <span class=o>=</span> <span class=n>email</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getId</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>id</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setId</span><span class=o>(</span><span class=n>String</span> <span class=n>id</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>id</span> <span class=o>=</span> <span class=n>id</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getName</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>name</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setName</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>name</span> <span class=o>=</span> <span class=n>name</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getEmail</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>email</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setEmail</span><span class=o>(</span><span class=n>String</span> <span class=n>email</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>email</span> <span class=o>=</span> <span class=n>email</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s>&#34;{\&#34;id\&#34;:\&#34;&#34;</span> <span class=o>+</span> <span class=n>id</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>                <span class=s>&#34;\&#34;, \&#34;name\&#34;:\&#34;&#34;</span> <span class=o>+</span> <span class=n>name</span> <span class=o>+</span> <span class=s>&#34;\&#34;, \&#34;email\&#34;:\&#34;&#34;</span> <span class=o>+</span> <span class=n>email</span> <span class=o>+</span> <span class=s>&#34;\&#34;}&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=http-to-cosmos-db-function>HTTP to Cosmos DB function<a hidden class=anchor aria-hidden=true href=#http-to-cosmos-db-function>#</a></h3><p>This function will have as input a <em><strong>Name</strong></em> and <strong><em>Email address</em></strong>, requested using the <strong>HTTP Post verb</strong>.¬† After parsing the request payload, this function will create a record of a <strong>Student</strong> in <strong>Cosmos DB</strong>.</p><p>The sample <strong>HTTP Hello World Function</strong> shown in the beginning of this tutorial, will be a good starting point:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Azure Functions with HTTP Trigger.
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Function</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@FunctionName</span><span class=o>(</span><span class=s>&#34;HttpTrigger-Java&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>HttpResponseMessage</span> <span class=nf>run</span><span class=o>(</span>
</span></span><span class=line><span class=cl>            <span class=nd>@HttpTrigger</span><span class=o>(</span><span class=n>name</span> <span class=o>=</span> <span class=s>&#34;req&#34;</span><span class=o>,</span> 
</span></span><span class=line><span class=cl>                        <span class=n>methods</span> <span class=o>=</span> <span class=o>{</span><span class=n>HttpMethod</span><span class=o>.</span><span class=na>GET</span><span class=o>,</span> <span class=n>HttpMethod</span><span class=o>.</span><span class=na>POST</span><span class=o>},</span> 
</span></span><span class=line><span class=cl>                        <span class=n>authLevel</span> <span class=o>=</span> <span class=n>AuthorizationLevel</span><span class=o>.</span><span class=na>FUNCTION</span><span class=o>)</span> <span class=n>HttpRequestMessage</span><span class=o>&lt;</span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;&gt;</span> <span class=n>request</span><span class=o>,</span>
</span></span><span class=line><span class=cl>            <span class=kd>final</span> <span class=n>ExecutionContext</span> <span class=n>context</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>context</span><span class=o>.</span><span class=na>getLogger</span><span class=o>().</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;Java HTTP trigger processed a request.&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Parse query parameter
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>String</span> <span class=n>query</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=na>getQueryParameters</span><span class=o>().</span><span class=na>get</span><span class=o>(</span><span class=s>&#34;name&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>String</span> <span class=n>name</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=na>getBody</span><span class=o>().</span><span class=na>orElse</span><span class=o>(</span><span class=n>query</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>name</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>request</span>
</span></span><span class=line><span class=cl>                    <span class=o>.</span><span class=na>createResponseBuilder</span><span class=o>(</span><span class=n>HttpStatus</span><span class=o>.</span><span class=na>BAD_REQUEST</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                    <span class=o>.</span><span class=na>body</span><span class=o>(</span><span class=s>&#34;Please pass a name on the query string or in the request body&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                    <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>request</span>
</span></span><span class=line><span class=cl>                    <span class=o>.</span><span class=na>createResponseBuilder</span><span class=o>(</span><span class=n>HttpStatus</span><span class=o>.</span><span class=na>OK</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                    <span class=o>.</span><span class=na>body</span><span class=o>(</span><span class=s>&#34;Hello, &#34;</span> <span class=o>+</span> <span class=n>name</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                    <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>In the <code>run()</code> method, we will add an other parameter: the <strong>Cosmos DB Binding</strong> üòÅ the Azure Functions connector to <strong>Cosmos DB</strong> ü§ì</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@FunctionName</span><span class=o>(</span><span class=s>&#34;CosmosDBStoreBinding&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=n>HttpResponseMessage</span> <span class=nf>run</span><span class=o>(</span>
</span></span><span class=line><span class=cl>    <span class=nd>@HttpTrigger</span><span class=o>(</span>
</span></span><span class=line><span class=cl>        <span class=n>name</span> <span class=o>=</span> <span class=s>&#34;req&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>        <span class=n>methods</span> <span class=o>=</span> <span class=o>{</span><span class=n>HttpMethod</span><span class=o>.</span><span class=na>POST</span><span class=o>},</span> <span class=n>1Ô∏è</span><span class=err>‚É£</span>
</span></span><span class=line><span class=cl>        <span class=n>authLevel</span> <span class=o>=</span> <span class=n>AuthorizationLevel</span><span class=o>.</span><span class=na>FUNCTION</span><span class=o>)</span> 
</span></span><span class=line><span class=cl>    <span class=n>HttpRequestMessage</span><span class=o>&lt;</span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;&gt;</span> <span class=n>request</span><span class=o>,</span>
</span></span><span class=line><span class=cl>    <span class=nd>@CosmosDBOutput</span><span class=o>(</span>
</span></span><span class=line><span class=cl>        <span class=n>name</span> <span class=o>=</span> <span class=s>&#34;database&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>        <span class=n>databaseName</span> <span class=o>=</span> <span class=s>&#34;university&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>        <span class=n>collectionName</span> <span class=o>=</span> <span class=s>&#34;students&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>        <span class=n>connectionStringSetting</span> <span class=o>=</span> <span class=s>&#34;CosmosDbConnection&#34;</span><span class=o>)</span> <span class=n>2Ô∏è</span><span class=err>‚É£</span>
</span></span><span class=line><span class=cl>    <span class=n>OutputBinding</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>outputItem</span><span class=o>,</span>
</span></span><span class=line><span class=cl>    <span class=kd>final</span> <span class=n>ExecutionContext</span> <span class=n>context</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=o>...</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>1Ô∏è‚É£ I only kept the <strong>HTTP Post</strong> verb - I don&rsquo;t want that the function get called using the <strong>HTTP Get</strong> verb.</p><p>2Ô∏è‚É£ Here we are defining an <strong>OutputBinding parameter</strong>, that will hold the computing result to <strong>Cosmos DB</strong>. That&rsquo;s why this parameter is annotated using the <code>@CosmosDBOutput</code>.</p><p>The <code>@CosmosDBOutput</code> annotation has these main attributes:</p><ul><li><strong>name</strong>: The variable name used in function.json üëâ Here we will use &ldquo;<strong>database</strong>&rdquo;</li><li><strong>databaseName</strong>: Defines the database name of the CosmosDB to which to write üëâ Here we will use &ldquo;<strong>university</strong>&rdquo;</li><li><strong>collectionName</strong>: Defines the collection name of the CosmosDB to which to write üëâ Here we will use &ldquo;<strong>students</strong>&rdquo;</li><li><strong>connectionStringSetting</strong>: Defines the app setting name that contains the CosmosDB connection string- This is the same attribute that we already defined in the <em>local.settings.json</em> and also in the Configuration section of the Azure Function in the Azure Subscription üëâ Here we will use &ldquo;<strong>CosmosDbConnection</strong>&rdquo;</li></ul><p>Next, in the method body, we will proceed to</p><ol><li>extract the request parameters</li><li>create a <strong>Student</strong> record</li><li>convert the record to JSON</li><li>set its value to the <strong>OutputBinding</strong></li><li>make an <strong>HTTP Response</strong> to the caller</li></ol><p>The complete method will look like:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@FunctionName</span><span class=o>(</span><span class=s>&#34;CosmosDBStoreBinding&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=n>HttpResponseMessage</span> <span class=nf>run</span><span class=o>(</span>
</span></span><span class=line><span class=cl>        <span class=nd>@HttpTrigger</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                <span class=n>name</span> <span class=o>=</span> <span class=s>&#34;req&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                <span class=n>methods</span> <span class=o>=</span> <span class=o>{</span><span class=n>HttpMethod</span><span class=o>.</span><span class=na>POST</span><span class=o>},</span>
</span></span><span class=line><span class=cl>                <span class=n>authLevel</span> <span class=o>=</span> <span class=n>AuthorizationLevel</span><span class=o>.</span><span class=na>FUNCTION</span><span class=o>)</span> <span class=n>HttpRequestMessage</span><span class=o>&lt;</span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;&gt;</span> <span class=n>request</span><span class=o>,</span>
</span></span><span class=line><span class=cl>        <span class=nd>@CosmosDBOutput</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                <span class=n>name</span> <span class=o>=</span> <span class=s>&#34;database&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                <span class=n>databaseName</span> <span class=o>=</span> <span class=s>&#34;university&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                <span class=n>collectionName</span> <span class=o>=</span> <span class=s>&#34;students&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                <span class=n>connectionStringSetting</span> <span class=o>=</span> <span class=s>&#34;CosmosDbConnection&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=n>OutputBinding</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>outputItem</span><span class=o>,</span>
</span></span><span class=line><span class=cl>        <span class=kd>final</span> <span class=n>ExecutionContext</span> <span class=n>context</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>context</span><span class=o>.</span><span class=na>getLogger</span><span class=o>().</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;Java HTTP trigger processed a request.&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>name</span> <span class=o>=</span> <span class=s>&#34;empty&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>email</span> <span class=o>=</span> <span class=s>&#34;empty&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Parse query parameter
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=o>(</span><span class=n>request</span><span class=o>.</span><span class=na>getBody</span><span class=o>().</span><span class=na>isPresent</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>JSONObject</span> <span class=n>jsonObject</span> <span class=o>=</span> <span class=k>new</span> <span class=n>JSONObject</span><span class=o>(</span><span class=n>request</span><span class=o>.</span><span class=na>getBody</span><span class=o>().</span><span class=na>get</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>name</span> <span class=o>=</span> <span class=n>jsonObject</span><span class=o>.</span><span class=na>getString</span><span class=o>(</span><span class=s>&#34;name&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>email</span> <span class=o>=</span> <span class=n>jsonObject</span><span class=o>.</span><span class=na>getString</span><span class=o>(</span><span class=s>&#34;email&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Generate random ID
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>final</span> <span class=n>String</span> <span class=n>id</span> <span class=o>=</span> <span class=n>String</span><span class=o>.</span><span class=na>valueOf</span><span class=o>(</span><span class=n>Math</span><span class=o>.</span><span class=na>abs</span><span class=o>(</span><span class=k>new</span> <span class=n>Random</span><span class=o>().</span><span class=na>nextInt</span><span class=o>()));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Generate document
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>Student</span> <span class=n>student</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Student</span><span class=o>(</span><span class=n>id</span><span class=o>,</span> <span class=n>name</span><span class=o>,</span> <span class=n>email</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>final</span> <span class=n>String</span> <span class=n>database</span> <span class=o>=</span> <span class=n>JSONWriter</span><span class=o>.</span><span class=na>valueToString</span><span class=o>(</span><span class=n>student</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>context</span><span class=o>.</span><span class=na>getLogger</span><span class=o>().</span><span class=na>info</span><span class=o>(</span><span class=n>String</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;Document to be saved in DB: %s&#34;</span><span class=o>,</span> <span class=n>database</span><span class=o>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>outputItem</span><span class=o>.</span><span class=na>setValue</span><span class=o>(</span><span class=n>database</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// return the document to calling client.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=n>request</span><span class=o>.</span><span class=na>createResponseBuilder</span><span class=o>(</span><span class=n>HttpStatus</span><span class=o>.</span><span class=na>OK</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>body</span><span class=o>(</span><span class=n>database</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Here, we used the <strong>Bindings</strong> explicitly, we can do the same thing, just by annotating the Function itself using the <code>@OutputBinding</code> - as we will not have an <strong>OutputBinding</strong> object to assign the value to it; we will have to return the value that we want to insert into <strong>Cosmos DB</strong> as a return value of <code>run()</code> method. The function can be written like this:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@FunctionName</span><span class=o>(</span><span class=s>&#34;CosmosDBStoreAnnotation&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nd>@CosmosDBOutput</span><span class=o>(</span>
</span></span><span class=line><span class=cl>        <span class=n>name</span> <span class=o>=</span> <span class=s>&#34;database&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>        <span class=n>databaseName</span> <span class=o>=</span> <span class=s>&#34;university&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>        <span class=n>collectionName</span> <span class=o>=</span> <span class=s>&#34;students&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>        <span class=n>connectionStringSetting</span> <span class=o>=</span> <span class=s>&#34;CosmosDbConnection&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=n>String</span> <span class=nf>run</span><span class=o>(</span>
</span></span><span class=line><span class=cl>        <span class=nd>@HttpTrigger</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                <span class=n>name</span> <span class=o>=</span> <span class=s>&#34;req&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                <span class=n>methods</span> <span class=o>=</span> <span class=o>{</span><span class=n>HttpMethod</span><span class=o>.</span><span class=na>POST</span><span class=o>},</span>
</span></span><span class=line><span class=cl>                <span class=n>authLevel</span> <span class=o>=</span> <span class=n>AuthorizationLevel</span><span class=o>.</span><span class=na>FUNCTION</span><span class=o>)</span> <span class=n>HttpRequestMessage</span><span class=o>&lt;</span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;&gt;</span> <span class=n>request</span><span class=o>,</span>
</span></span><span class=line><span class=cl>        <span class=kd>final</span> <span class=n>ExecutionContext</span> <span class=n>context</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>context</span><span class=o>.</span><span class=na>getLogger</span><span class=o>().</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;Java HTTP trigger processed a request.&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>name</span> <span class=o>=</span> <span class=s>&#34;empty&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>email</span> <span class=o>=</span> <span class=s>&#34;empty&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Parse query parameter
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=o>(</span><span class=n>request</span><span class=o>.</span><span class=na>getBody</span><span class=o>().</span><span class=na>isPresent</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>JSONObject</span> <span class=n>jsonObject</span> <span class=o>=</span> <span class=k>new</span> <span class=n>JSONObject</span><span class=o>(</span><span class=n>request</span><span class=o>.</span><span class=na>getBody</span><span class=o>().</span><span class=na>get</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>name</span> <span class=o>=</span> <span class=n>jsonObject</span><span class=o>.</span><span class=na>getString</span><span class=o>(</span><span class=s>&#34;name&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>email</span> <span class=o>=</span> <span class=n>jsonObject</span><span class=o>.</span><span class=na>getString</span><span class=o>(</span><span class=s>&#34;email&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Generate random ID
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>final</span> <span class=n>String</span> <span class=n>id</span> <span class=o>=</span> <span class=n>String</span><span class=o>.</span><span class=na>valueOf</span><span class=o>(</span><span class=n>Math</span><span class=o>.</span><span class=na>abs</span><span class=o>(</span><span class=k>new</span> <span class=n>Random</span><span class=o>().</span><span class=na>nextInt</span><span class=o>()));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Generate document
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>Student</span> <span class=n>student</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Student</span><span class=o>(</span><span class=n>id</span><span class=o>,</span> <span class=n>name</span><span class=o>,</span> <span class=n>email</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>final</span> <span class=n>String</span> <span class=n>database</span> <span class=o>=</span> <span class=k>new</span> <span class=n>JSONObject</span><span class=o>(</span><span class=n>student</span><span class=o>).</span><span class=na>toString</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>context</span><span class=o>.</span><span class=na>getLogger</span><span class=o>().</span><span class=na>info</span><span class=o>(</span><span class=n>String</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;Document to be saved in DB: %s&#34;</span><span class=o>,</span> <span class=n>database</span><span class=o>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>database</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>These two possible formats of the function will give the same result - just in the second one, we will not be able to define the <strong>HTTP Response</strong> to the caller client.</p><p>‚ö†Ô∏è‚ö†Ô∏è At this level, the insertion in the <strong>Cosmos DB</strong> is not effective yet; at this stage, we don&rsquo;t know if the creation will be done or may fail whatever the reason. This is why the Azure Functions have a verbose logging that will help us understand if things are going in the correct way or not.</p><p>When you run the functions locally you can have these logs on your console:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ mvn azure-functions:run
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Scanning <span class=k>for</span> projects...
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> 
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> -------------&lt; com.helloworld.group:helloworld-functions &gt;--------------
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Building Azure Java Functions 1.0-SNAPSHOT
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> --------------------------------<span class=o>[</span> jar <span class=o>]</span>---------------------------------
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> 
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> --- azure-functions-maven-plugin:1.3.4:run <span class=o>(</span>default-cli<span class=o>)</span> @ helloworld-functions ---
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Azure Function App<span class=s1>&#39;s staging directory found at: /Users/nebrass/azure/helloworld-functions/target/azure-functions/hello-world-app-example
</span></span></span><span class=line><span class=cl><span class=s1>[INFO] Azure Functions Core Tools found.
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>                  %%%%%%
</span></span></span><span class=line><span class=cl><span class=s1>                 %%%%%%
</span></span></span><span class=line><span class=cl><span class=s1>            @   %%%%%%    @
</span></span></span><span class=line><span class=cl><span class=s1>          @@   %%%%%%      @@
</span></span></span><span class=line><span class=cl><span class=s1>       @@@    %%%%%%%%%%%    @@@
</span></span></span><span class=line><span class=cl><span class=s1>     @@      %%%%%%%%%%        @@
</span></span></span><span class=line><span class=cl><span class=s1>       @@         %%%%       @@
</span></span></span><span class=line><span class=cl><span class=s1>         @@      %%%       @@
</span></span></span><span class=line><span class=cl><span class=s1>           @@    %%      @@
</span></span></span><span class=line><span class=cl><span class=s1>                %%
</span></span></span><span class=line><span class=cl><span class=s1>                %
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>Azure Functions Core Tools (2.7.1704 Commit hash: fbab3b9c1de5ab95e3b4b6a471ead62c4f37e89c)
</span></span></span><span class=line><span class=cl><span class=s1>Function Runtime Version: 2.0.12742.0
</span></span></span><span class=line><span class=cl><span class=s1>...
</span></span></span><span class=line><span class=cl><span class=s1>[19/10/2019 17:20:13] Host initialized (201ms)
</span></span></span><span class=line><span class=cl><span class=s1>[19/10/2019 17:20:13] Host started (236ms)
</span></span></span><span class=line><span class=cl><span class=s1>[19/10/2019 17:20:13] Job host started
</span></span></span><span class=line><span class=cl><span class=s1>Hosting environment: Production
</span></span></span><span class=line><span class=cl><span class=s1>Content root path: /Users/nebrass/azure/helloworld-functions/target/azure-functions/hello-world-app-example
</span></span></span><span class=line><span class=cl><span class=s1>Now listening on: http://0.0.0.0:7071
</span></span></span><span class=line><span class=cl><span class=s1>Application started. Press Ctrl+C to shut down.
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>Http Functions:
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>	CosmosDBStoreAnnotation: [POST] http://localhost:7071/api/CosmosDBStoreAnnotation
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>	CosmosDBStoreBinding: [POST] http://localhost:7071/api/CosmosDBStoreBinding
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>[19/10/2019 17:20:18] Host lock lease acquired by instance ID &#39;</span>0000000000000000000000009DB0E06C<span class=err>&#39;</span>.
</span></span></code></pre></td></tr></table></div></div><p>Now, if we call one of the two available functions, the log will be displayed on the console.</p><p>We can call the CosmosDBStoreAnnotation function using the curl tool:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ curl -i -d <span class=s1>&#39;{&#34;name&#34;:&#34;nebrass&#34;, &#34;email&#34;:&#34;lnibrass@gmail.com&#34;}&#39;</span> -H <span class=s2>&#34;Content-Type: application/json&#34;</span> -X POST http://localhost:7071/api/CosmosDBStoreAnnotation
</span></span></code></pre></td></tr></table></div></div><p>The <code>curl</code> reponse will look like:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>{</span><span class=s2>&#34;id&#34;</span>:<span class=s2>&#34;1465275753&#34;</span>, <span class=s2>&#34;name&#34;</span>:<span class=s2>&#34;nebrass&#34;</span>, <span class=s2>&#34;email&#34;</span>:<span class=s2>&#34;lnibrass@gmail.com&#34;</span><span class=o>}</span>%
</span></span></code></pre></td></tr></table></div></div><p>In the console, we will find some thing that looks like this:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>19/10/2019...<span class=o>]</span> Executing HTTP request: <span class=o>{</span>
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019...<span class=o>]</span>   <span class=s2>&#34;requestId&#34;</span>: <span class=s2>&#34;647ca147-3917-4323-951b-b0744c0e2367&#34;</span>,
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019...<span class=o>]</span>   <span class=s2>&#34;method&#34;</span>: <span class=s2>&#34;POST&#34;</span>,
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019...<span class=o>]</span>   <span class=s2>&#34;uri&#34;</span>: <span class=s2>&#34;/api/CosmosDBStoreAnnotation&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019...<span class=o>]</span> <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019...<span class=o>]</span> Executing <span class=s1>&#39;Functions.CosmosDBStoreAnnotation&#39;</span> <span class=o>(</span><span class=nv>Reason</span><span class=o>=</span><span class=s1>&#39;This function was programmatically called via the host APIs.&#39;</span>, <span class=nv>Id</span><span class=o>=</span>7582d976-d517-4d43-9b12-f645464705e2<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019...<span class=o>]</span> Java HTTP trigger processed a request.
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019...<span class=o>]</span> Document to be saved in DB: <span class=o>{</span><span class=s2>&#34;id&#34;</span>:<span class=s2>&#34;1465275753&#34;</span>, <span class=s2>&#34;name&#34;</span>:<span class=s2>&#34;nebrass&#34;</span>, <span class=s2>&#34;email&#34;</span>:<span class=s2>&#34;lnibrass@gmail.com&#34;</span><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019...<span class=o>]</span> Function <span class=s2>&#34;CosmosDBStoreAnnotation&#34;</span> <span class=o>(</span>Id: 7582d976-d517-4d43-9b12-f645464705e2<span class=o>)</span> invoked by Java Worker
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019...<span class=o>]</span> Executed <span class=s1>&#39;Functions.CosmosDBStoreAnnotation&#39;</span> <span class=o>(</span>Succeeded, <span class=nv>Id</span><span class=o>=</span>7582d976-d517-4d43-9b12-f645464705e2<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019...<span class=o>]</span> Executed HTTP request: <span class=o>{</span>
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019...<span class=o>]</span>   <span class=s2>&#34;requestId&#34;</span>: <span class=s2>&#34;647ca147-3917-4323-951b-b0744c0e2367&#34;</span>,
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019...<span class=o>]</span>   <span class=s2>&#34;method&#34;</span>: <span class=s2>&#34;POST&#34;</span>,
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019...<span class=o>]</span>   <span class=s2>&#34;uri&#34;</span>: <span class=s2>&#34;/api/CosmosDBStoreAnnotation&#34;</span>,
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019...<span class=o>]</span>   <span class=s2>&#34;identities&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019...<span class=o>]</span>     <span class=o>{</span>
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019...<span class=o>]</span>       <span class=s2>&#34;type&#34;</span>: <span class=s2>&#34;WebJobsAuthLevel&#34;</span>,
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019...<span class=o>]</span>       <span class=s2>&#34;level&#34;</span>: <span class=s2>&#34;Admin&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019...<span class=o>]</span>     <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019...<span class=o>]</span>   <span class=o>]</span>,
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019...<span class=o>]</span>   <span class=s2>&#34;status&#34;</span>: 200,
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019...<span class=o>]</span>   <span class=s2>&#34;duration&#34;</span>: <span class=m>1161</span>
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019...<span class=o>]</span> <span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>In this case; we see that everything is going well.</p><p>But, if there is a problem, we will not get a response for the <code>curl</code> command and in the log we will get something like:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span> Executing HTTP request: <span class=o>{</span>
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span>   <span class=s2>&#34;requestId&#34;</span>: <span class=s2>&#34;28cb88b7-3a7a-4c96-bacc-f70349d30cd9&#34;</span>,
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span>   <span class=s2>&#34;method&#34;</span>: <span class=s2>&#34;POST&#34;</span>,
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span>   <span class=s2>&#34;uri&#34;</span>: <span class=s2>&#34;/api/CosmosDBStoreAnnotation&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span> <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span> Executing <span class=s1>&#39;Functions.CosmosDBStoreAnnotation&#39;</span> <span class=o>(</span><span class=nv>Reason</span><span class=o>=</span><span class=s1>&#39;This function was programmatically called via the host APIs.&#39;</span>, <span class=nv>Id</span><span class=o>=</span>627d4d5d-6064-4322-aa2d-5ee1050f9a89<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span> Java HTTP trigger processed a request.
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span> Document to be saved in DB: <span class=o>{</span><span class=s2>&#34;id&#34;</span>:<span class=s2>&#34;1234769986&#34;</span>, <span class=s2>&#34;name&#34;</span>:<span class=s2>&#34;nebrass&#34;</span>, <span class=s2>&#34;email&#34;</span>:<span class=s2>&#34;lnibrass@gmail.com&#34;</span><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span> Function <span class=s2>&#34;CosmosDBStoreAnnotation&#34;</span> <span class=o>(</span>Id: 627d4d5d-6064-4322-aa2d-5ee1050f9a89<span class=o>)</span> invoked by Java Worker
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span> Executed <span class=s1>&#39;Functions.CosmosDBStoreAnnotation&#39;</span> <span class=o>(</span>Failed, <span class=nv>Id</span><span class=o>=</span>627d4d5d-6064-4322-aa2d-5ee1050f9a89<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span> System.Private.CoreLib: Exception <span class=k>while</span> executing <span class=k>function</span>: Functions.CosmosDBStoreAnnotation. System.Private.CoreLib: The input is not a valid Base-64 string as it contains a non-base <span class=m>64</span> character, more than two padding characters, or an illegal character among the padding characters.
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span> Executed HTTP request: <span class=o>{</span>
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span>   <span class=s2>&#34;requestId&#34;</span>: <span class=s2>&#34;28cb88b7-3a7a-4c96-bacc-f70349d30cd9&#34;</span>,
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span>   <span class=s2>&#34;method&#34;</span>: <span class=s2>&#34;POST&#34;</span>,
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span>   <span class=s2>&#34;uri&#34;</span>: <span class=s2>&#34;/api/CosmosDBStoreAnnotation&#34;</span>,
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span>   <span class=s2>&#34;identities&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span>     <span class=o>{</span>
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span>       <span class=s2>&#34;type&#34;</span>: <span class=s2>&#34;WebJobsAuthLevel&#34;</span>,
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span>       <span class=s2>&#34;level&#34;</span>: <span class=s2>&#34;Admin&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span>     <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span>   <span class=o>]</span>,
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span>   <span class=s2>&#34;status&#34;</span>: 500,
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span>   <span class=s2>&#34;duration&#34;</span>: <span class=m>14</span>
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span> <span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>We can easily notice that there is a problem in the execution, and even there is a <strong>{<em>status: 500</em>}</strong> for the <strong>HTTP Request,</strong> which is the same headers sent back to the <code>curl</code> command.</p><p>Great ! Let&rsquo;s continue our trip ! ü§©</p><h3 id=http-to-service-bus-function>HTTP to Service Bus function<a hidden class=anchor aria-hidden=true href=#http-to-service-bus-function>#</a></h3><p>Based on the previous section, the <strong>HTTP to Service Bus Function</strong> will look like:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@FunctionName</span><span class=o>(</span><span class=s>&#34;ServiceBusStoreAnnotation&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nd>@ServiceBusQueueOutput</span><span class=o>(</span>
</span></span><span class=line><span class=cl>        <span class=n>name</span> <span class=o>=</span> <span class=s>&#34;hello-world-app-queue-output&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>        <span class=n>queueName</span> <span class=o>=</span> <span class=s>&#34;hello-world-app-queue&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>        <span class=n>connection</span> <span class=o>=</span> <span class=s>&#34;ServiceBusConnection&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=n>String</span> <span class=nf>run</span><span class=o>(</span>
</span></span><span class=line><span class=cl>        <span class=nd>@HttpTrigger</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                <span class=n>name</span> <span class=o>=</span> <span class=s>&#34;req&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                <span class=n>methods</span> <span class=o>=</span> <span class=o>{</span><span class=n>HttpMethod</span><span class=o>.</span><span class=na>POST</span><span class=o>},</span>
</span></span><span class=line><span class=cl>                <span class=n>authLevel</span> <span class=o>=</span> <span class=n>AuthorizationLevel</span><span class=o>.</span><span class=na>FUNCTION</span><span class=o>)</span> <span class=n>HttpRequestMessage</span><span class=o>&lt;</span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;&gt;</span> <span class=n>request</span><span class=o>,</span>
</span></span><span class=line><span class=cl>        <span class=kd>final</span> <span class=n>ExecutionContext</span> <span class=n>context</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>context</span><span class=o>.</span><span class=na>getLogger</span><span class=o>().</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;Java HTTP trigger processed a request.&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>name</span> <span class=o>=</span> <span class=n>EMPTY</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>email</span> <span class=o>=</span> <span class=n>EMPTY</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Parse query parameter
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=o>(</span><span class=n>request</span><span class=o>.</span><span class=na>getBody</span><span class=o>().</span><span class=na>isPresent</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>JSONObject</span> <span class=n>jsonObject</span> <span class=o>=</span> <span class=k>new</span> <span class=n>JSONObject</span><span class=o>(</span><span class=n>request</span><span class=o>.</span><span class=na>getBody</span><span class=o>().</span><span class=na>get</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>name</span> <span class=o>=</span> <span class=n>jsonObject</span><span class=o>.</span><span class=na>getString</span><span class=o>(</span><span class=s>&#34;name&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>email</span> <span class=o>=</span> <span class=n>jsonObject</span><span class=o>.</span><span class=na>getString</span><span class=o>(</span><span class=s>&#34;email&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Generate random ID
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>final</span> <span class=n>String</span> <span class=n>id</span> <span class=o>=</span> <span class=n>String</span><span class=o>.</span><span class=na>valueOf</span><span class=o>(</span><span class=k>new</span> <span class=n>Random</span><span class=o>().</span><span class=na>nextInt</span><span class=o>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Generate Student
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>Student</span> <span class=n>student</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Student</span><span class=o>(</span><span class=n>id</span><span class=o>,</span> <span class=n>name</span><span class=o>,</span> <span class=n>email</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>final</span> <span class=n>String</span> <span class=n>message</span> <span class=o>=</span> <span class=n>student</span><span class=o>.</span><span class=na>toString</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>context</span><span class=o>.</span><span class=na>getLogger</span><span class=o>().</span><span class=na>info</span><span class=o>(</span><span class=n>String</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;Document to be sent to Queue: %s&#34;</span><span class=o>,</span> <span class=n>message</span><span class=o>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>message</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>When called, the log of this function will look like:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span> Executing HTTP request: <span class=o>{</span>
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span>   <span class=s2>&#34;requestId&#34;</span>: <span class=s2>&#34;a36738f3-e1fa-4c78-8600-7b4039382703&#34;</span>,
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span>   <span class=s2>&#34;method&#34;</span>: <span class=s2>&#34;POST&#34;</span>,
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span>   <span class=s2>&#34;uri&#34;</span>: <span class=s2>&#34;/api/ServiceBusStoreAnnotation&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span> <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span> Executing <span class=s1>&#39;Functions.ServiceBusStoreAnnotation&#39;</span> <span class=o>(</span><span class=nv>Reason</span><span class=o>=</span><span class=s1>&#39;This function was programmatically called via the host APIs.&#39;</span>, <span class=nv>Id</span><span class=o>=</span>149530e6-d0c9-4c90-b582-726c6cac7cc0<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span> Java HTTP trigger processed a request.
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span> Document to be sent to Queue: <span class=o>{</span><span class=s2>&#34;id&#34;</span>:<span class=s2>&#34;954440360&#34;</span>, <span class=s2>&#34;name&#34;</span>:<span class=s2>&#34;nebrass&#34;</span>, <span class=s2>&#34;email&#34;</span>:<span class=s2>&#34;lnibrass@gmail.com&#34;</span><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span> Function <span class=s2>&#34;ServiceBusStoreAnnotation&#34;</span> <span class=o>(</span>Id: 149530e6-d0c9-4c90-b582-726c6cac7cc0<span class=o>)</span> invoked by Java Worker
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span> Executed <span class=s1>&#39;Functions.ServiceBusStoreAnnotation&#39;</span> <span class=o>(</span>Succeeded, <span class=nv>Id</span><span class=o>=</span>149530e6-d0c9-4c90-b582-726c6cac7cc0<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span> Executed HTTP request: <span class=o>{</span>
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span>   <span class=s2>&#34;requestId&#34;</span>: <span class=s2>&#34;a36738f3-e1fa-4c78-8600-7b4039382703&#34;</span>,
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span>   <span class=s2>&#34;method&#34;</span>: <span class=s2>&#34;POST&#34;</span>,
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span>   <span class=s2>&#34;uri&#34;</span>: <span class=s2>&#34;/api/ServiceBusStoreAnnotation&#34;</span>,
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span>   <span class=s2>&#34;identities&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span>     <span class=o>{</span>
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span>       <span class=s2>&#34;type&#34;</span>: <span class=s2>&#34;WebJobsAuthLevel&#34;</span>,
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span>       <span class=s2>&#34;level&#34;</span>: <span class=s2>&#34;Admin&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span>     <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span>   <span class=o>]</span>,
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span>   <span class=s2>&#34;status&#34;</span>: 200,
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span>   <span class=s2>&#34;duration&#34;</span>: <span class=m>1300</span>
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span> <span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Everything is good ! <strong>No Bad News Is Good News</strong>¬†! As there is no errors means every thing is working like a charm ü•≥</p><p>We can check on the <strong>Azure Portal</strong> that there is a <strong>Message</strong> on the <strong>Service Bus Queue</strong>:</p><div align=center><p><img loading=lazy src=../images/azure-service-bus-queue-message-1024x399.webp alt="azure service bus queue message"></p></div><h3 id=service-bus-message-to-cosmos-db-function>Service Bus Message to Cosmos DB function<a hidden class=anchor aria-hidden=true href=#service-bus-message-to-cosmos-db-function>#</a></h3><p>Now, we will create the function that will be triggered by a message in the <strong>Service Bus Queue</strong> and will insert data to <strong>Cosmos DB</strong>. The function will look like:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@FunctionName</span><span class=o>(</span><span class=s>&#34;ServiceBusMessageToCosmosDb&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kt>void</span> <span class=nf>run</span><span class=o>(</span>
</span></span><span class=line><span class=cl>        <span class=nd>@ServiceBusQueueTrigger</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                <span class=n>name</span> <span class=o>=</span> <span class=s>&#34;messageTrigger&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                <span class=n>queueName</span> <span class=o>=</span> <span class=s>&#34;hello-world-app-queue&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                <span class=n>connection</span> <span class=o>=</span> <span class=s>&#34;ServiceBusConnection&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>)</span> <span class=n>String</span> <span class=n>student</span><span class=o>,</span>
</span></span><span class=line><span class=cl>        <span class=nd>@CosmosDBOutput</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                <span class=n>name</span> <span class=o>=</span> <span class=s>&#34;database&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                <span class=n>databaseName</span> <span class=o>=</span> <span class=s>&#34;university&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                <span class=n>collectionName</span> <span class=o>=</span> <span class=s>&#34;students&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                <span class=n>connectionStringSetting</span> <span class=o>=</span> <span class=s>&#34;CosmosDbConnection&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=n>OutputBinding</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>outputItem</span><span class=o>,</span>
</span></span><span class=line><span class=cl>        <span class=kd>final</span> <span class=n>ExecutionContext</span> <span class=n>context</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>context</span><span class=o>.</span><span class=na>getLogger</span><span class=o>().</span><span class=na>info</span><span class=o>(</span><span class=n>String</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;Service Bus message trigger processed a request: %s&#34;</span><span class=o>,</span> <span class=n>student</span><span class=o>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// This line will be used to validate the received JSON
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>String</span> <span class=n>jsonValue</span> <span class=o>=</span> <span class=k>new</span> <span class=n>JSONObject</span><span class=o>(</span><span class=n>student</span><span class=o>).</span><span class=na>toString</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>context</span><span class=o>.</span><span class=na>getLogger</span><span class=o>().</span><span class=na>info</span><span class=o>(</span><span class=n>String</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;Document to be saved in DB: %s&#34;</span><span class=o>,</span> <span class=n>jsonValue</span><span class=o>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>outputItem</span><span class=o>.</span><span class=na>setValue</span><span class=o>(</span><span class=n>jsonValue</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>When we run our <strong>Functions Application</strong>, the <strong>Message</strong> that is already in the <strong>Service Bus Queue</strong> will be consumed - the execution log:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span> Executing <span class=s1>&#39;Functions.ServiceBusMessageToCosmosDb&#39;</span> <span class=o>(</span><span class=nv>Reason</span><span class=o>=</span><span class=s1>&#39;New ServiceBus message detected on &#39;</span>hello-world-app-queue<span class=s1>&#39;.&#39;</span>, <span class=nv>Id</span><span class=o>=</span>dcb8e81d-f09e-48ee-a236-49542ae2e34d<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span> Trigger Details: MessageId: f5a0a1d6e5e94fc790aed052217dda5a, DeliveryCount: 1, EnqueuedTime: 19/10/2019 17:47:39, LockedUntil: 19/10/2019 18:00:44
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span> Service Bus message trigger processed a request: <span class=o>{</span>
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span>   <span class=s2>&#34;id&#34;</span>: <span class=s2>&#34;954440360&#34;</span>,
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span>   <span class=s2>&#34;name&#34;</span>: <span class=s2>&#34;nebrass&#34;</span>,
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span>   <span class=s2>&#34;email&#34;</span>: <span class=s2>&#34;lnibrass@gmail.com&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span> <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span> Document to be saved in DB: <span class=o>{</span><span class=s2>&#34;name&#34;</span>:<span class=s2>&#34;nebrass&#34;</span>,<span class=s2>&#34;id&#34;</span>:<span class=s2>&#34;954440360&#34;</span>,<span class=s2>&#34;email&#34;</span>:<span class=s2>&#34;lnibrass@gmail.com&#34;</span><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span> Function <span class=s2>&#34;ServiceBusMessageToCosmosDb&#34;</span> <span class=o>(</span>Id: dcb8e81d-f09e-48ee-a236-49542ae2e34d<span class=o>)</span> invoked by Java Worker
</span></span><span class=line><span class=cl><span class=o>[</span>19/10/2019..<span class=o>]</span> Executed <span class=s1>&#39;Functions.ServiceBusMessageToCosmosDb&#39;</span> <span class=o>(</span>Succeeded, <span class=nv>Id</span><span class=o>=</span>dcb8e81d-f09e-48ee-a236-49542ae2e34d<span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><p>Yooppi ü•≥ every thing is working like a charm ! ü•∞</p><p>Now, we will see <strong>how to debug</strong> our <strong>Azure Functions Java Application</strong> üòÅ</p><h4 id=debugging-the-azure-functions-application-locally>DEBUGGING the Azure Functions Application Locally<a hidden class=anchor aria-hidden=true href=#debugging-the-azure-functions-application-locally>#</a></h4><p>To debug the application locally just do: <code>mvn clean package azure-functions:run -DenableDebug</code> to run the <strong>Azure Functions</strong> application in the <strong>Debugging Mode</strong>.</p><p>In you IDE, you need to attach a debugger to the <strong>Host: localhost</strong> and the <strong>Port: 5005</strong>.</p><ol><li><p><strong>For NetBeans</strong> In the <strong>Debug</strong> menu, click on <strong>Attach Debugger</strong>:</p><div align=center><p><img loading=lazy src=../images/azure-functions-netbeans-attach-1024x509.webp alt></p></div><p>Next, in the Attach Debugger window, we need to make <strong>localhost as Host</strong> and <strong>5005 as Port</strong>:</p><div align=center><p><img loading=lazy src=../images/azure-functions-netbeans-attach-form.webp alt></p></div><p>Next, try to put a breakpoint and call your application, you will see your application pause on your breakpoint:</p><div align=center><p><img loading=lazy src=../images/azure-functions-netbeans-debugging-1024x512.webp alt></p></div></li><li><p><strong>For IntelliJ</strong> In the <strong>Run</strong> menu, select <strong>Edit Configurations</strong>, next click on the <strong>(+)</strong> button..
On the Configuration section:</p><ul><li><strong>Host:</strong> localhost</li><li><strong>Port:</strong> 5005</li><li><strong>Cmd line arguments:</strong> <code>-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5005</code></li></ul><div align=center><p><img loading=lazy src=../images/azure-functions-intellij-debug-configuration.webp alt></p></div><p>Now, you can put a breakpoint in your code, start the application in <strong>Debug Mode</strong>, run the <strong>Remote Debug configuration</strong> that you just created in IntelliJ. When you invoke one of the functions, you will see the application pause on the breakpoint.</p><div align=center><p><img loading=lazy src=../images/azure-functions-intellij-debugging-breakpoint-1024x719.webp alt></p></div></li></ol><p>Cool ! Let&rsquo;s move to the deployment part ! ü§©</p><h2 id=deploying-the-azure-functions-java-application>Deploying the Azure Functions Java Application<a hidden class=anchor aria-hidden=true href=#deploying-the-azure-functions-java-application>#</a></h2><p>Let&rsquo;s deploy our <strong>Azure Functions Application</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ mvn package azure-functions:deploy
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> --- azure-functions-maven-plugin:1.3.4:deploy <span class=o>(</span>default-cli<span class=o>)</span> @ helloworld-functions ---
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Authenticate with Azure CLI 2.0
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Updating the specified <span class=k>function</span> app...
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Java version of <span class=k>function</span> host : 1.8
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Set <span class=k>function</span> worker runtime to java
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Successfully updated the <span class=k>function</span> app.hello-world-app-example
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Trying to deploy the <span class=k>function</span> app...
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Trying to deploy artifact to hello-world-app-example...
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Successfully deployed the artifact to https://hello-world-app-example.azurewebsites.net
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Successfully deployed the <span class=k>function</span> app at https://hello-world-app-example.azurewebsites.net
</span></span><span class=line><span class=cl>...
</span></span></code></pre></td></tr></table></div></div><p>Great! Our application is deployed ! ü•≥ü•≥</p><p>Let&rsquo;s enjoy our functions ! ü§©</p><h2 id=consuming-the-deployed-azure-functions-application>Consuming the Deployed Azure Functions Application<a hidden class=anchor aria-hidden=true href=#consuming-the-deployed-azure-functions-application>#</a></h2><p>In the deployment log, we see that our Functions App is deployed to <code>https://hello-world-app-example.azurewebsites.net</code>¬†.</p><p>Let&rsquo;s try our curl command on this host:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ curl -i -X POST https://hello-world-app-example.azurewebsites.net/api/ServiceBusStoreAnnotation
</span></span><span class=line><span class=cl>       -d <span class=s1>&#39;{&#34;name&#34;:&#34;nebrass&#34;, &#34;email&#34;:&#34;lnibrass@gmail.com&#34;}&#39;</span> 
</span></span></code></pre></td></tr></table></div></div><p>We will get something like:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span> <span class=m>401</span> <span class=ne>Unauthorized</span>
</span></span><span class=line><span class=cl><span class=n>Set-Cookie</span><span class=o>:</span> <span class=l>ARRAffinity=8ba760adb9686d1725150fb81799ab65bc89ea938e47cc3c421bf92dc2df040a;Path=/;HttpOnly;Domain=hello-world-app-example.azurewebsites.net</span>
</span></span><span class=line><span class=cl><span class=n>Request-Context</span><span class=o>:</span> <span class=l>appId=cid-v1:e3232f0f-c61a-48c2-92b8-537739c295b6</span>
</span></span><span class=line><span class=cl><span class=n>Set-Cookie</span><span class=o>:</span> <span class=l>ARRAffinity=5d57fdaf326a15958b2bfa6786e779beb79860d9cad630e44e1343796e5fac76;Path=/;HttpOnly;Domain=hello-world-app-example.azurewebsites.net</span>
</span></span><span class=line><span class=cl><span class=n>Date</span><span class=o>:</span> <span class=l>Sat, 19 Oct 2019 18:20:29 GMT</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>0</span>
</span></span></code></pre></td></tr></table></div></div><p>HTTP 401 Unauthorized üò≥üò±üò≠üò∞üò£üò´ !!!</p><p>But from where comes the Authorization ? Did we secured our Functions ??</p><p>Actually, yes and this comes in the generated function sample. In the method signature, there is a <code>@HttpTrigger</code>¬† annotation with an attribute <code>authLevel=AuthorizationLevel.FUNCTION</code>¬†. In the <em>Javadoc</em> of this annotation, we see that <strong>authLevel</strong> determines what keys, if any, need to be present on the request in order to invoke the function. The authorization level can be one of the following values:</p><ul><li><strong>anonymous</strong>: No API key is required.</li><li><strong>function</strong>: A function-specific API key is required. This is the default value if none is provided.</li><li><strong>admin</strong>: The master key is required.</li></ul><p>Good ! So we need to have an API Key to be able to consume our Functions. Great, but from where we can get that? ü§ì</p><p>KEEP CALM ! üò§ Everything is easy to find in the Azure Portal üòÅ</p><p>Go to the <strong>Azure Functions Application</strong>, then click on <strong>Function App Settings</strong>:</p><div align=center><p><img loading=lazy src=../images/azure-functions-app-settings-1024x390.webp alt></p></div><p>Next, in this window, you will find the default <strong>Host Keys</strong>:</p><div align=center><p><img loading=lazy src=../images/azure-functions-app-settings-listing-1024x681.webp alt></p></div><blockquote><p>The <strong>Azure Functions API keys</strong> can be either:</p><ul><li>a <strong><em>Host Key</em></strong> : an API Key that can be used with all the functions in the same application</li><li>a <em><strong>Function Key</strong></em>: an API Key that can be used for only an assigned the function</li></ul></blockquote><p>Based on this definition, if we want to generate a <strong>Function Key</strong>, we need to go to the <strong>Function</strong>, next, click on <strong>Manage</strong>:</p><div align=center><p><img loading=lazy src=../images/azure-functions-app-settings-function-manage-1024x628.webp alt="azure functions app settings function manage"></p></div><p>Next, after you copy the Key, you need to include it to the request. We can do that in several ways:</p><ul><li>in the URL: https://APP_URL/api/CosmosDBStoreAnnotation?code=XXXXXXXXXXXXXXXXXXXXXXX</li><li>in the headers, in a format: <strong>Key</strong>=x-functions-key and <strong>Value</strong>=XXXXXXXXXXXXXXXXXXXXXXX</li></ul><p>Great ! Let&rsquo;s test the <code>curl</code> again:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ curl -i -X POST https://hello-world-app-example.azurewebsites.net/api/ServiceBusStoreAnnotation?code<span class=o>=</span><span class=nv>XXXXXXXXXXXXXXXXXXX</span><span class=o>==</span>
</span></span><span class=line><span class=cl>        -d <span class=s1>&#39;{&#34;name&#34;:&#34;nebrass&#34;, &#34;email&#34;:&#34;lnibrass@gmail.com&#34;}&#39;</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span> <span class=m>200</span> <span class=ne>OK</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>68</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>text/plain; charset=utf-8</span>
</span></span><span class=line><span class=cl><span class=n>Set-Cookie</span><span class=o>:</span> <span class=l>ARRAffinity=aaaaaabbbbbbbbcccccccdddddeeeeeefffffff;Path=/;HttpOnly;Domain=hello-world-app-example.azurewebsites.net</span>
</span></span><span class=line><span class=cl><span class=n>Request-Context</span><span class=o>:</span> <span class=l>appId=cid-v1:12345678-abcd-efgh-xywz-537739c295b6</span>
</span></span><span class=line><span class=cl><span class=n>Set-Cookie</span><span class=o>:</span> <span class=l>ARRAffinity=wwwwwwxxxxxxxxvvvvvvvuuuuuiiiiiihhhhhhh;Path=/;HttpOnly;Domain=hello-world-app-example.azurewebsites.net</span>
</span></span><span class=line><span class=cl><span class=n>Date</span><span class=o>:</span> <span class=l>Sat, 19 Oct 2019 20:03:48 GMT</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>{&#34;id&#34;:&#34;1251989744&#34;,</span> <span class=err>&#34;name&#34;:&#34;nebrass&#34;,</span> <span class=err>&#34;email&#34;:&#34;lnibrass@gmail.com&#34;}%</span>
</span></span></code></pre></td></tr></table></div></div><p>Youuppiiii !!! üòÅ</p><h2 id=monitoring-the-azure-functions-application>Monitoring the Azure Functions Application<a hidden class=anchor aria-hidden=true href=#monitoring-the-azure-functions-application>#</a></h2><p>When we created our application, we created an <strong>Application Insights account</strong>. To access the <strong>Azure Functions Monitoring</strong>, you need to go to the <strong>Function</strong>, next you click on the <strong>Monitor menu</strong>. Here you will find the latest requests with a small stats about the successful and failing ones:</p><div align=center><p><img loading=lazy src=../images/azure-functions-app-settings-function-monitoring-1024x456.webp alt></p></div><p>To check more, you can click on a request to see more details. Or even you can click on:</p><ul><li><strong>Live app metrics</strong> to access the Metrics dashboard for our Functions application.</li></ul><div align=center><p><img loading=lazy src=../images/azure-functions-app-settings-function-metrics-1024x469.webp alt></p></div><ul><li><strong>Run in Application Insights</strong> to access the detailed Logs and Log Analytics platform for our Functions application.</li></ul><div align=center><p><img loading=lazy src=../images/azure-functions-app-settings-function-log-analytics-1024x480.webp alt></p></div><p>Cool ! As you see, we can do many crazy things easily with the <strong>Azure Functions</strong>, in a very efficient way. No hard configuration, no crazy yaml configuration files..</p><p>The <strong>Azure Functions</strong> is one of the most wonderful products that I like in the <strong>Azure world</strong> ü§© I really will try to go deep more and more in this great service. I will try to write an other tutorial when needed.</p><p>Feel free to try in deep this tutorial and I will be interested to get your feedback. If you have a request or any inquiry, feel free to get in touch with me üòÑ</p></div><footer class=post-footer><ul class=post-tags></ul><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Playing with Java in Azure Functions - New Release on twitter" href="https://twitter.com/intent/tweet/?text=Playing%20with%20Java%20in%20Azure%20Functions%20-%20New%20Release&url=https%3a%2f%2fblog.nebrass.fr%2fplaying-with-java-in-azure-functions-new-release%2f&hashtags="><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Playing with Java in Azure Functions - New Release on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fblog.nebrass.fr%2fplaying-with-java-in-azure-functions-new-release%2f&title=Playing%20with%20Java%20in%20Azure%20Functions%20-%20New%20Release&summary=Playing%20with%20Java%20in%20Azure%20Functions%20-%20New%20Release&source=https%3a%2f%2fblog.nebrass.fr%2fplaying-with-java-in-azure-functions-new-release%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Playing with Java in Azure Functions - New Release on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fblog.nebrass.fr%2fplaying-with-java-in-azure-functions-new-release%2f&title=Playing%20with%20Java%20in%20Azure%20Functions%20-%20New%20Release"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Playing with Java in Azure Functions - New Release on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.nebrass.fr%2fplaying-with-java-in-azure-functions-new-release%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Playing with Java in Azure Functions - New Release on whatsapp" href="https://api.whatsapp.com/send?text=Playing%20with%20Java%20in%20Azure%20Functions%20-%20New%20Release%20-%20https%3a%2f%2fblog.nebrass.fr%2fplaying-with-java-in-azure-functions-new-release%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Playing with Java in Azure Functions - New Release on telegram" href="https://telegram.me/share/url?text=Playing%20with%20Java%20in%20Azure%20Functions%20-%20New%20Release&url=https%3a%2f%2fblog.nebrass.fr%2fplaying-with-java-in-azure-functions-new-release%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://blog.nebrass.fr>Nebrass Homepage</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script></body></html>