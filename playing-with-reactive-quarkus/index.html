<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Playing with Reactive Quarkus | Nebrass Homepage</title>
<meta name=keywords content>
<meta name=description content="Here we go again for a new post üòÅ After publishing my Quarkus book last September, I got many requests about creating reactive applications with the Quarkus Framework.
Today, I will show you how to make a Reactive CRUD Application with the Quarkus Framework and backed by a PostgreSQL Database.
Building our the Reactive Quarkus Application The full source code is available on my Github.
We will generate our project using the code.">
<meta name=author content>
<link rel=canonical href=https://blog.nebrass.fr/playing-with-reactive-quarkus/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.9aeab43847eb11aca320bfadedfe191ed6516dd768bf1314b534c4992aac901a.css integrity="sha256-muq0OEfrEayjIL+t7f4ZHtZRbddovxMUtTTEmSqskBo=" rel="preload stylesheet" as=style>
<script src=/js/prism.min.js></script>
<link rel=stylesheet href=/css/prism.min.css>
<link rel=icon href=https://blog.nebrass.fr/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://blog.nebrass.fr/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://blog.nebrass.fr/favicon-32x32.png>
<link rel=apple-touch-icon href=https://blog.nebrass.fr/apple-touch-icon.png>
<link rel=mask-icon href=https://blog.nebrass.fr/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<style amp-custom>.main,.footer,.nav{max-width:calc(var(--main-width) + var(--gap) * 15)}</style>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-111781986-1','auto'),ga('send','pageview'))</script><meta property="og:title" content="Playing with Reactive Quarkus">
<meta property="og:description" content="Here we go again for a new post üòÅ After publishing my Quarkus book last September, I got many requests about creating reactive applications with the Quarkus Framework.
Today, I will show you how to make a Reactive CRUD Application with the Quarkus Framework and backed by a PostgreSQL Database.
Building our the Reactive Quarkus Application The full source code is available on my Github.
We will generate our project using the code.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://blog.nebrass.fr/playing-with-reactive-quarkus/">
<meta property="og:image" content="https://blog.nebrass.fr/images/playing-with-reactive-quarkus.webp"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-05-27T00:00:00+00:00">
<meta property="article:modified_time" content="2022-05-27T00:00:00+00:00">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://blog.nebrass.fr/images/playing-with-reactive-quarkus.webp">
<meta name=twitter:title content="Playing with Reactive Quarkus">
<meta name=twitter:description content="Here we go again for a new post üòÅ After publishing my Quarkus book last September, I got many requests about creating reactive applications with the Quarkus Framework.
Today, I will show you how to make a Reactive CRUD Application with the Quarkus Framework and backed by a PostgreSQL Database.
Building our the Reactive Quarkus Application The full source code is available on my Github.
We will generate our project using the code.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://blog.nebrass.fr/posts/"},{"@type":"ListItem","position":3,"name":"Playing with Reactive Quarkus","item":"https://blog.nebrass.fr/playing-with-reactive-quarkus/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Playing with Reactive Quarkus","name":"Playing with Reactive Quarkus","description":"Here we go again for a new post üòÅ After publishing my Quarkus book last September, I got many requests about creating reactive applications with the Quarkus Framework.\nToday, I will show you how to make a Reactive CRUD Application with the Quarkus Framework and backed by a PostgreSQL Database.\nBuilding our the Reactive Quarkus Application The full source code is available on my Github.\nWe will generate our project using the code.","keywords":[],"articleBody":"Here we go again for a new post üòÅ After publishing my Quarkus book last September, I got many requests about creating reactive applications with the Quarkus Framework.\nToday, I will show you how to make a Reactive CRUD Application with the Quarkus Framework and backed by a PostgreSQL Database.\nBuilding our the Reactive Quarkus Application The full source code is available on my Github.\nWe will generate our project using the code.quarkus.io. Our application will need 8 extensions from the portal:\n RESTEasy Reactive RESTEasy Reactive Jackson Hibernate Reactive with Panache Hibernate Validator Reactive PostgreSQL client JDBC Driver - PostgreSQL Flyway SmallRye OpenAPI   Other than these dependencies, we will need some more:\n Lombok for simplifying the code and avoiding all boilerplate stuff like getters/setter, constructors, etc. Mapstruct is used to implement a simplified mapping mechanism between JPA entities and DTOs. Testcontainers is used to provide lightweight database instances for JUnit Tests.  We will need manually to the pom.xml:\n1 2 3 4 5 6 7 8 9 10   org.projectlombok lombok 1.18.22   org.mapstruct mapstruct 1.4.2.Final    We will need also Test scope dependencies:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15   org.testcontainers junit-jupiter test   org.testcontainers testcontainers test   org.testcontainers postgresql test    In this tutorial, we will use a great feature available in Quarkus called DevServices,¬†which helps you to provision sevices (like DB, Keycloak, Cache Engines, Kafka, etc.) for Dev and Test purposes.\nBased on the Quarkus Guides:\n Quarkus supports the automatic provisioning of unconfigured services in development and test mode. We refer to this capability as Dev Services. From a developer‚Äôs perspective this means that if you include an extension and don‚Äôt configure it then Quarkus will automatically start the relevant service (usually using¬†Testcontainers¬†behind the scenes) and wire up your application to use this service.\n‚Äì Quarkus - Dev Services Overview\n ‚ö†Ô∏è ‚ö†Ô∏è You need to have Docker installed in order to enjoy the Quarkus Dev Services capability.\nWe will start by configuring DevServices in the application.properties :\n1 2 3 4 5 6 7 8 9 10 11  quarkus.datasource.db-kind=postgresql quarkus.datasource.devservices.enabled=true quarkus.datasource.devservices.image-name=postgres:13 quarkus.datasource.devservices.port=5432 quarkus.datasource.username=postgresx quarkus.datasource.password=postgresx quarkus.datasource.jdbc=false quarkus.flyway.migrate-at-start=false quarkus.datasource.reactive.url=postgresql://localhost:5432/postgres quarkus.datasource.reactive.max-size=20   The line(s):\n 2, 3 and 4 will activate the DevServices capability for the Datasource, and define the container image as postgres:13 and define the container port to 5432. 5 and 6 will define the Database container credentials 7 will disable the JDBC access to the database 8 will disable the automatic Flyway migration at startup as it‚Äôs not correctly working in the reactive mode. There is already an issue Hibernate reactive + Flyway extension causes UnsatisfiedResolutionException ¬∑ Issue #10716 ¬∑ quarkusio/quarkus (github.com) 10 and 11 will configure the reactive database connection URL and properties  We will be developing a Reactive version of our famous Books CRUD Application. Our Book entity looks like:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22  @Data @NoArgsConstructor @Entity @Table(name = \"books\") public class Book { @Id @GeneratedValue(strategy = GenerationType.AUTO) private Long id; private String title; @Size(min = 13, max = 20) private String isbn; private String author; @DecimalMin(\"0.0\") private BigDecimal price; public Book(String title, String isbn, String author, BigDecimal price) { this.title = title; this.isbn = isbn; this.author = author; this.price = price; } }   We will start by defining the initial Flyway migration script in the resources/db/migration folder:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  CREATESEQUENCEhibernate_sequenceSTARTWITH1INCREMENTBY1;CREATETABLEbooks(idBIGINTNOTNULLPRIMARYKEYDEFAULTnextval('hibernate_sequence'),titleVARCHAR(100),isbnVARCHAR(20)CONSTRAINTisbn_size_between_13_20CHECK(char_length(isbn)=13),authorVARCHAR(100),priceNUMERIC(6,2)CONSTRAINTpositive_priceCHECK(price=0));INSERTINTObooks(title,isbn,author,price)VALUES('Pairing Apache Shiro and Java EE 7','978-1-365-12404-4','Nebrass Lamouchi',0);INSERTINTObooks(title,isbn,author,price)VALUES('Playing with Java Microservices on Kubernetes and OpenShift','9782956428510','Nebrass Lamouchi',9.18);INSERTINTObooks(title,isbn,author,price)VALUES('Pro Java Microservices with Quarkus and Kubernetes','9781484271698','Nebrass Lamouchi',65);  Then, we need to create a Flyway migration component that will use the DevServices credentials to load this script to our Database:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  @ApplicationScoped public class FlywayMigrationService { @ConfigProperty(name = \"quarkus.datasource.reactive.url\") String dbUrl; @ConfigProperty(name = \"quarkus.datasource.username\") String dbUsername; @ConfigProperty(name = \"quarkus.datasource.password\") String dbPassword; public void runFlywayMigration(@Observes StartupEvent event) { Flyway flyway = Flyway.configure() .dataSource(\"jdbc:\" + dbUrl, dbUsername, dbPassword) .load(); flyway.migrate(); } }   The FlywayMigrationService will grab the DevService Database credentials and will load all the migration scripts stored in the Flyway directory.\nNext, we will create a Reactive Repository to manage our Books in our DB:\n1 2 3  @ApplicationScoped public class BookRepository implements PanacheRepositoryBaseBook, Long { }    ‚ÑπÔ∏è The PanacheRepositoryBase represents a Repository for a specific type of entity Entity. Implementing this repository will gain you similar useful methods that are on Spring Data JpaRepository like:\n  findAll() findById() persist() update() delete() etc..  Then, we will create the BookService component with an injected BookRepository:\n1 2 3 4 5  @ApplicationScoped @RequiredArgsConstructor public class BookService { private final BookRepository bookRepository; }   Then, in the Service layer, we will implement the CRUD operations thru the Repository in the Reactive mode.\nImplementing the findAll() method To grab all entities of the Book entity, we will be call the findAll() method of the BookRepository. In the PanacheRepositoryBase interface, the findAll method returns a PanacheQuery.\n ‚ÑπÔ∏è A PanacheQuery is an interface representing an entity query, which abstracts the use of paging, getting the number of results, and operating on List or Stream. The PanacheQuery interface will get its implementation based on the shipped Panache dependency that we have. In our case it will be implemented in the PanacheQueryImpl class from the io.quarkus.hibernate.reactive.panache.runtime package from the quarkus-hibernate-reactive-panache extension.\n The list() method from the PanacheQueryImpl class returns a Uni.\nBut, what is the Uni type ?\n A¬†Uni¬†is a specialized stream that emits only an item or a failure. Typically,¬†Uni¬†are great to represent asynchronous actions such as a remote procedure call, an HTTP request, or an operation producing a single result.\nUni¬†provides many operators that create, transform, and orchestrate¬†Uni sequences.\n‚Äì SmallRye Mutiny documentation\n In the BookService, we can use the list() method from the PanacheQueryImpl class to grab all the books. The findAll() will look like:\n1 2 3  public UniListBook findAll() { return bookRepository.findAll().list(); }   ‚ÑπÔ∏è Actually, there is a shortcut to the findAll().list() in the PanacheRepositoryBase interface, but I wanted to take you in a tour to show you how things are already made.\nThen, we will create the BookResource to expose the findAll() operation:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  @RequiredArgsConstructor @Produces(MediaType.APPLICATION_JSON) @Path(\"/api/books\") @RequestScoped public class BookResource { private final BookService bookService; @GET public UniResponse findAll() { return bookService.findAll() .map(data - ok(data).build()); } }   We are wrapping the List inside the Uni.\nThen, if you run the Quarkus application using the mvn quarkus:dev command, then we can test the findAll REST API using the Swagger UI available on http://localhost:8080/q/swagger-ui/:\nfindAll REST API - Swagger UI\n Implementing the save() method After implementing the findAll() method, we need to create the one that inserts records in the database üòÖ\nIn our REST API, the save() method is called with JSON Payload holding a new book details. These details can be defined as a DTO Model class that I will call BookDTO:\n1 2 3 4 5 6 7 8 9 10  @lombok.Data @lombok.NoArgsConstructor @lombok.AllArgsConstructor public class BookDTO { private Long id; private String title; private String isbn; private String author; private BigDecimal price; }   In the BookResource class we need to add a new method that is called using the HTTP Post Verb and that consumes as JSON Payload the BookDTO:\n1 2 3 4 5 6 7  @POST @Consumes(MediaType.APPLICATION_JSON) public UniResponse create(BookDTO bookDTO) { return bookService.save(bookDTO) 1 .onItem().ifNotNull().transform(book - ok(book).build()) 2 .onItem().ifNull().continueWith(status(BAD_REQUEST)::build); 3 }   The line(s):\n 1: will delegate the saving task to the bookService.save() method. 2: if the save() succeeds then we will return the created Book entry in the Response body. 3: if the save() fails then we will return an HTTP Bad Request (400) in the Response body.  Now, we need to create the save() method in the BookService. This is will be obviously calling the BookRepository save method:\n1 2 3 4 5 6 7 8  public UniBook save(BookDTO dto) { return bookRepository.persistAndFlush(new Book( dto.getTitle(), dto.getIsbn(), dto.getAuthor(), dto.getPrice() )); }   You can notice that the persistAndFlush() method returns a Uni which we already discovered in the previous part of this tutorial.\nHmm.. I have something to modify in my BookService after introducing the BookDTO class. I wonder:\n Why do I need to return the all the Book entity records in my findAll() method ? Why I dont return instead the entity records wrapped as DTO instances ? Is this will be better or it‚Äôs just an overhead ?  The RESPONSE is: THIS IS MUST BE DONE ‚öîÔ∏èüõ°‚öîÔ∏è But why ?\nThe DTO pattern is highly useful in many cases:\n Returning the plain data directly from the database to the user can be dangerous when the entity records hold sensitive data such as password, payments credentials, adresses, etc. So records mapping to DTOs is a must - as you cannot obfuscate data on the record instance itself üòÅ The DTO offers the ability to provide the data that is needed in different contexts. For example, the findAll() method in a page that needs only the books titles and prices is not the same as a page that needs the books titles and isbns only. DTOs here will be offering the possibility to create a separate DTO dedicated for each need.   üí° It‚Äôs true that in our example none of these needs are present, but I will use the DTO for learning purposes ü•π\n My findAll() method with DTOs will look like:\n1 2 3 4 5 6 7 8 9 10 11 12 13  public UniListBookDTO findAll() { return bookRepository.findAll() .stream() .map(bookEntity - new BookDTO( bookEntity.getId(), bookEntity.getTitle(), bookEntity.getIsbn(), bookEntity.getAuthor(), bookEntity.getPrice() )) .collect() .asList(); }   Hhmmmmmmmm.. in the save() method I instanciated a new Book instance and I passed the attributes to the constructor, and here I passed the attributes from the entity record to the instanciated DTO constructor. Ok this is clear, but headache and it‚Äôs not beautiful ü§Æ\nOne idea, is to create Mapping methods:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  private java.util.function.FunctionBook, BookDTO mapBookEntityToDTO() { return bookEntity - new BookDTO( bookEntity.getId(), bookEntity.getTitle(), bookEntity.getIsbn(), bookEntity.getAuthor(), bookEntity.getPrice() ); } private java.util.function.FunctionBookDTO, Book mapBookDtoToEntity() { return bookDTO - new Book( bookDTO.getTitle(), bookDTO.getIsbn(), bookDTO.getAuthor(), bookDTO.getPrice() ); }   Then my findAll() and save() methods will look like:\n1 2 3 4 5 6 7 8 9 10 11 12 13  public UniListBookDTO findAll() { return bookRepository.findAll() .stream() .map(mapBookEntityToDTO()) .collect() .asList(); } public UniBookDTO save(BookDTO dto) { return bookRepository.persistAndFlush( mapBookDtoToEntity().apply(dto)) .map(mapBookEntityToDTO()); }   Ouuuf üò© This is better, but it will be better if there are any cleaner way.. I know it will be crazy to create 2 x N methods if we will have N different DTO for each entity. The good news is that there is an excellent solution to do this: Java bean mappings utility classes !\nHmm üòí the name is no so funky ! I know ! But this is what is called. I won‚Äôt reinvent the wheel üòÅ\nImplementing the Mapping mechanism In the Java World, there are many libraries that helps to do dynamic mapping from an entity to its corresponding DTO classes. Since 2016, I was trying many of them like: MapStruct, Dozer, ModelMapper, JMapper, etc. But the best one that suited my needs is MapStruct.\nYou can read about benchmarking and performance of the different available libraries here @Baeldung: https://www.baeldung.com/java-performance-mapping-frameworks.\nTo add MapStruct to our application, we start by adding the MapStruct Maven dependency to our pom.xml:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18   ... 1.4.2.Final 0.2.0 ...  ...  ...  org.mapstruct mapstruct ${mapstruct.version}  ...    Then, in the Maven POM build section, we need to configure the compiler to take into consideration the MapStruct processor along with the Lombok processor:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31     maven-compiler-plugin ${compiler-plugin.version}   -parameters    org.mapstruct mapstruct-processor ${mapstruct.version}    org.projectlombok lombok ${lombok.version}   org.projectlombok lombok-mapstruct-binding ${lombok-mapstruct-binding.version}     ...    Now, we need to create the MapStruct Mapper class that will reference the Entity and the DTO:\n1 2 3 4 5 6 7 8 9 10  @Mapper(componentModel = \"cdi\") public interface BookMapper { BookDTO toBookDto(Book book); Book toBookEntity(BookDTO dto); ListBookDTO toBookDtoList(ListBook book); void updateBookEntityFromDto(BookDTO dto, @MappingTarget Book book); }   This interface defines:\n the generated mapper as an application-scoped CDI bean and can be retrieved via @Inject annotation. different methods that maps:  an entity to a DTO a DTO to an entity an entities list to a DTOs list an update Entity from a DTO definition    Excellent ! Now, we can add the BookMapper reference for injection in the BookService class:\n1 2 3 4 5 6 7 8 9  @ApplicationScoped @RequiredArgsConstructor public class BookService { private final BookRepository bookRepository; private final BookMapper bookMapper; ... }   Then we can use the BookMapper in our findAll() and save() methods:\n1 2 3 4 5 6 7 8 9 10 11 12 13  public UniListBookDTO findAll() { return bookRepository.findAll() .stream() .map(bookMapper::toBookDto) .collect() .asList(); } public UniBookDTO save(BookDTO book) { return bookRepository.persistAndFlush( bookMapper.toBookEntity(book)) .map(bookMapper::toBookDto); }    üí° In the save() method, we used the mapper to create a Book instance from the DTO, and then convert the stored Book record to a DTO instance.\n That‚Äôs all tale! The MapStruct will do all the magic!\nBehind the scenes, the Maven Compiler will use the MapStruct Processor to implement the MapStruct Mapper via the BookMapperImpl.java class, available after compilation, in the /target/generated-sources/annotations/ directory:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69  @Generated( value = \"org.mapstruct.ap.MappingProcessor\", date = \"2022-05-27T11:20:38+0200\", comments = \"version: 1.4.2.Final, compiler: javac, environment: Java 17.0.3 (GraalVM Community)\" ) @ApplicationScoped public class BookMapperImpl implements BookMapper { @Override public BookDTO toBookDto(Book book) { if ( book == null ) { return null; } BookDTO bookDTO = new BookDTO(); bookDTO.setId( book.getId() ); bookDTO.setTitle( book.getTitle() ); bookDTO.setIsbn( book.getIsbn() ); bookDTO.setAuthor( book.getAuthor() ); bookDTO.setPrice( book.getPrice() ); return bookDTO; } @Override public Book toBookEntity(BookDTO dto) { if ( dto == null ) { return null; } Book book = new Book(); book.setId( dto.getId() ); book.setTitle( dto.getTitle() ); book.setIsbn( dto.getIsbn() ); book.setAuthor( dto.getAuthor() ); book.setPrice( dto.getPrice() ); return book; } @Override public ListBookDTO toBookDtoList(ListBook book) { if ( book == null ) { return null; } ListBookDTO list = new ArrayListBookDTO( book.size() ); for ( Book book1 : book ) { list.add( toBookDto( book1 ) ); } return list; } @Override public void updateBookEntityFromDto(BookDTO dto, Book book) { if ( dto == null ) { return; } book.setId( dto.getId() ); book.setTitle( dto.getTitle() ); book.setIsbn( dto.getIsbn() ); book.setAuthor( dto.getAuthor() ); book.setPrice( dto.getPrice() ); } }   Great! I feel very comfortable for delegating the DTO Mapping load to MapStruct üòÅ As I always say: ‚ÄúA Good Developer is a Lazy Developer‚Äù üòÇ\nImplementing the findById, findByAuthor and deleteById methods Now, we will continue to implement our CRUD methods - like:\n findById(): find a book using a given book ID. findByAuthor(): find books using a given author name. deleteById(): delete a book using a given book ID.  The implementation looks like:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  public UniBookDTO findById(Long id) { return bookRepository.findById(id) .map(bookMapper::toBookDto); } public UniListBookDTO findByAuthor(String author) { return bookRepository .find(\"lower(author) like lower(CONCAT('%', '\" + author + \"', '%')) \") 1 .stream() .map(bookMapper::toBookDto) .collect() .asList(); } @ReactiveTransactional 2 public UniVoid deleteById(Long id) { return bookRepository.deleteById(id).replaceWithVoid(); }   The line:\n 1: defines the Hibernate Query that is used to search by author name with ignore case. 2: runs the method into a reactive Mutiny.Session.Transation.  Then, their REST APIs look like:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32  @RequiredArgsConstructor @Produces(MediaType.APPLICATION_JSON) @Path(\"/api/books\") @RequestScoped public class BookResource { private final BookService bookService; ... @GET @Path(\"/{id}\") public UniResponse findById(@PathParam(\"id\") Long id) { return bookService.findById(id) .onItem().ifNotNull().transform(book - ok(book).build()) .onItem().ifNull().continueWith(status(NOT_FOUND)::build); } @GET @Path(\"/author/{name}\") public UniResponse findByAuthor(@PathParam(\"name\") String name) { return bookService.findByAuthor(name) .onItem().ifNotNull().transform(book - ok(book).build()) .onItem().ifNull().continueWith(status(NOT_FOUND)::build); } @DELETE @Path(\"/{id}\") public UniVoid deleteById(@PathParam(\"id\") Long id) { return bookService.deleteById(id); } }   That‚Äôs all tale ! üòÅ We made our first Quarkus Reactive application ! You can now write some integration tests using RestAssured to be sure that all is working as expected ü§©\nIf you have questions, please feel free to get in touch with me üòé\n","wordCount":"2864","inLanguage":"en","image":"https://blog.nebrass.fr/images/playing-with-reactive-quarkus.webp","datePublished":"2022-05-27T00:00:00Z","dateModified":"2022-05-27T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.nebrass.fr/playing-with-reactive-quarkus/"},"publisher":{"@type":"Organization","name":"Nebrass Homepage","logo":{"@type":"ImageObject","url":"https://blog.nebrass.fr/favicon.ico"}}}</script>
</head>
<body id=top>
<script>window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://blog.nebrass.fr accesskey=h title="Nebrass Homepage (Alt + H)">Nebrass Homepage</a>
<span class=logo-switches>
</span>
</div>
<ul id=menu>
<li>
<a href=https://blog.nebrass.fr/ title=Posts>
<span>Posts</span>
</a>
</li>
<li>
<a href=https://blog.nebrass.fr/search/ title="Search (Alt + /)" accesskey=/>
<span>Search</span>
</a>
</li>
<li>
<a href=https://blog.nebrass.fr/categories/ title=Categories>
<span>Categories</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<h1 class=post-title>
Playing with Reactive Quarkus
</h1>
<div class=post-meta><span title="2022-05-27 00:00:00 +0000 UTC">May 27, 2022</span>&nbsp;¬∑&nbsp;14 min
</div>
</header>
<figure class=entry-cover><img loading=lazy src=https://blog.nebrass.fr/images/playing-with-reactive-quarkus.webp alt>
</figure>
<div class=post-content><p>Here we go again for a new post üòÅ After publishing my <a href=https://link.springer.com/book/10.1007/978-1-4842-7170-4>Quarkus book</a> last September, I got many requests about creating reactive applications with the <strong>Quarkus Framework</strong>.</p>
<p>Today, I will show you how to make a <strong>Reactive CRUD Application</strong> with the <strong>Quarkus Framework</strong> and backed by a <strong>PostgreSQL Database</strong>.</p>
<h2 id=building-our-the-reactive-quarkus-application>Building our the Reactive Quarkus Application<a hidden class=anchor aria-hidden=true href=#building-our-the-reactive-quarkus-application>#</a></h2>
<p><a href=https://github.com/nebrass/playing-with-reactive-spring-boot>The full source code is available on my Github.</a></p>
<p>We will generate our project using the <a href=https://code.quarkus.io/>code.quarkus.io</a>. Our application will need 8 extensions from the portal:</p>
<ul>
<li>RESTEasy Reactive</li>
<li>RESTEasy Reactive Jackson</li>
<li>Hibernate Reactive with Panache</li>
<li>Hibernate Validator</li>
<li>Reactive PostgreSQL client</li>
<li>JDBC Driver - PostgreSQL</li>
<li>Flyway</li>
<li>SmallRye OpenAPI</li>
</ul>
<div align=center>
<p><img loading=lazy src=../images/reactive-quarkus-generate.webp alt="Reactive Quarkus - Generate skull">
</p>
</div>
<p>Other than these dependencies, we will need some more:</p>
<ul>
<li><strong>Lombok</strong> for simplifying the code and avoiding all boilerplate stuff like getters/setter, constructors, etc.</li>
<li><strong>Mapstruct</strong> is used to implement a simplified mapping mechanism between JPA entities and DTOs.</li>
<li><strong>Testcontainers</strong> is used to provide lightweight database instances for JUnit Tests.</li>
</ul>
<p>We will need manually to the <code>pom.xml</code>:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=nt>&lt;dependency&gt;</span>
    <span class=nt>&lt;groupId&gt;</span>org.projectlombok<span class=nt>&lt;/groupId&gt;</span>
    <span class=nt>&lt;artifactId&gt;</span>lombok<span class=nt>&lt;/artifactId&gt;</span>
    <span class=nt>&lt;version&gt;</span>1.18.22<span class=nt>&lt;/version&gt;</span>
<span class=nt>&lt;/dependency&gt;</span>
<span class=nt>&lt;dependency&gt;</span>
    <span class=nt>&lt;groupId&gt;</span>org.mapstruct<span class=nt>&lt;/groupId&gt;</span>
    <span class=nt>&lt;artifactId&gt;</span>mapstruct<span class=nt>&lt;/artifactId&gt;</span>
    <span class=nt>&lt;version&gt;</span>1.4.2.Final<span class=nt>&lt;/version&gt;</span>
<span class=nt>&lt;/dependency&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>We will need also <strong>Test</strong> scope dependencies:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=nt>&lt;dependency&gt;</span>
    <span class=nt>&lt;groupId&gt;</span>org.testcontainers<span class=nt>&lt;/groupId&gt;</span>
    <span class=nt>&lt;artifactId&gt;</span>junit-jupiter<span class=nt>&lt;/artifactId&gt;</span>
    <span class=nt>&lt;scope&gt;</span>test<span class=nt>&lt;/scope&gt;</span>
<span class=nt>&lt;/dependency&gt;</span>
<span class=nt>&lt;dependency&gt;</span>
    <span class=nt>&lt;groupId&gt;</span>org.testcontainers<span class=nt>&lt;/groupId&gt;</span>
    <span class=nt>&lt;artifactId&gt;</span>testcontainers<span class=nt>&lt;/artifactId&gt;</span>
    <span class=nt>&lt;scope&gt;</span>test<span class=nt>&lt;/scope&gt;</span>
<span class=nt>&lt;/dependency&gt;</span>
<span class=nt>&lt;dependency&gt;</span>
    <span class=nt>&lt;groupId&gt;</span>org.testcontainers<span class=nt>&lt;/groupId&gt;</span>
    <span class=nt>&lt;artifactId&gt;</span>postgresql<span class=nt>&lt;/artifactId&gt;</span>
    <span class=nt>&lt;scope&gt;</span>test<span class=nt>&lt;/scope&gt;</span>
<span class=nt>&lt;/dependency&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>In this tutorial, we will use a great feature available in <strong>Quarkus</strong> called <strong>DevServices</strong>,¬†which helps you to provision sevices (like DB, Keycloak, Cache Engines, Kafka, etc.) <strong>for Dev and Test purposes</strong>.</p>
<p>Based on the <strong>Quarkus Guides</strong>:</p>
<blockquote>
<p>Quarkus supports the automatic provisioning of unconfigured services in development and test mode. We refer to this capability as <strong>Dev Services</strong>. From a developer‚Äôs perspective this means that if you include an extension and don‚Äôt configure it then Quarkus will automatically start the relevant service (usually using¬†<a href=https://www.testcontainers.org/>Testcontainers</a>¬†behind the scenes) and wire up your application to use this service.</p>
<p>&ndash; <a href=https://quarkus.io/guides/dev-services>Quarkus - Dev Services Overview</a></p>
</blockquote>
<p>‚ö†Ô∏è ‚ö†Ô∏è You need to have Docker installed in order to enjoy the <strong>Quarkus Dev Services</strong> capability.</p>
<p>We will start by configuring <strong>DevServices</strong> in the <code>application.properties</code> :</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=na>quarkus.datasource.db-kind</span><span class=o>=</span><span class=s>postgresql</span>
<span class=na>quarkus.datasource.devservices.enabled</span><span class=o>=</span><span class=s>true</span>
<span class=na>quarkus.datasource.devservices.image-name</span><span class=o>=</span><span class=s>postgres:13</span>
<span class=na>quarkus.datasource.devservices.port</span><span class=o>=</span><span class=s>5432</span>
<span class=na>quarkus.datasource.username</span><span class=o>=</span><span class=s>postgresx</span>
<span class=na>quarkus.datasource.password</span><span class=o>=</span><span class=s>postgresx</span>
<span class=na>quarkus.datasource.jdbc</span><span class=o>=</span><span class=s>false</span>
<span class=na>quarkus.flyway.migrate-at-start</span><span class=o>=</span><span class=s>false</span>

<span class=na>quarkus.datasource.reactive.url</span><span class=o>=</span><span class=s>postgresql://localhost:5432/postgres</span>
<span class=na>quarkus.datasource.reactive.max-size</span><span class=o>=</span><span class=s>20</span>
</code></pre></td></tr></table>
</div>
</div><p>The line(s):</p>
<ul>
<li>2, 3 and 4 will <strong>activate the DevServices capability</strong> for the <strong>Datasource</strong>, and define the <strong>container image</strong> as <code>postgres:13</code> and define the <strong>container port</strong> to <code>5432</code>.</li>
<li>5 and 6 will <strong>define the Database container credentials</strong></li>
<li>7 will <strong>disable the JDBC access to the database</strong></li>
<li>8 will <strong>disable the automatic Flyway migration at startup</strong> as it&rsquo;s not correctly working in the reactive mode. There is already an issue <a href=https://github.com/quarkusio/quarkus/issues/10716>Hibernate reactive + Flyway extension causes UnsatisfiedResolutionException ¬∑ Issue #10716 ¬∑ quarkusio/quarkus (github.com)</a></li>
<li>10 and 11 will <strong>configure the reactive database connection URL and properties</strong></li>
</ul>
<p>We will be developing a <strong>Reactive</strong> version of our famous <strong>Books CRUD Application</strong>. Our <strong>Book entity</strong> looks like:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=nd>@Data</span>
<span class=nd>@NoArgsConstructor</span>
<span class=nd>@Entity</span>
<span class=nd>@Table</span><span class=o>(</span><span class=n>name</span> <span class=o>=</span> <span class=s>&#34;books&#34;</span><span class=o>)</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Book</span> <span class=o>{</span>
    <span class=nd>@Id</span>
    <span class=nd>@GeneratedValue</span><span class=o>(</span><span class=n>strategy</span> <span class=o>=</span> <span class=n>GenerationType</span><span class=o>.</span><span class=na>AUTO</span><span class=o>)</span>
    <span class=kd>private</span> <span class=n>Long</span> <span class=n>id</span><span class=o>;</span>
    <span class=kd>private</span> <span class=n>String</span> <span class=n>title</span><span class=o>;</span>
    <span class=nd>@Size</span><span class=o>(</span><span class=n>min</span> <span class=o>=</span> <span class=n>13</span><span class=o>,</span> <span class=n>max</span> <span class=o>=</span> <span class=n>20</span><span class=o>)</span>
    <span class=kd>private</span> <span class=n>String</span> <span class=n>isbn</span><span class=o>;</span>
    <span class=kd>private</span> <span class=n>String</span> <span class=n>author</span><span class=o>;</span>
    <span class=nd>@DecimalMin</span><span class=o>(</span><span class=s>&#34;0.0&#34;</span><span class=o>)</span>
    <span class=kd>private</span> <span class=n>BigDecimal</span> <span class=n>price</span><span class=o>;</span>

    <span class=kd>public</span> <span class=nf>Book</span><span class=o>(</span><span class=n>String</span> <span class=n>title</span><span class=o>,</span> <span class=n>String</span> <span class=n>isbn</span><span class=o>,</span> <span class=n>String</span> <span class=n>author</span><span class=o>,</span> <span class=n>BigDecimal</span> <span class=n>price</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>this</span><span class=o>.</span><span class=na>title</span> <span class=o>=</span> <span class=n>title</span><span class=o>;</span>
        <span class=k>this</span><span class=o>.</span><span class=na>isbn</span> <span class=o>=</span> <span class=n>isbn</span><span class=o>;</span>
        <span class=k>this</span><span class=o>.</span><span class=na>author</span> <span class=o>=</span> <span class=n>author</span><span class=o>;</span>
        <span class=k>this</span><span class=o>.</span><span class=na>price</span> <span class=o>=</span> <span class=n>price</span><span class=o>;</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table>
</div>
</div><p>We will start by defining the initial Flyway migration script in the <code>resources/db/migration</code> folder:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=k>CREATE</span><span class=w> </span><span class=n>SEQUENCE</span><span class=w> </span><span class=n>hibernate_sequence</span><span class=w> </span><span class=k>START</span><span class=w> </span><span class=k>WITH</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>INCREMENT</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>books</span><span class=w>
</span><span class=w></span><span class=p>(</span><span class=w>
</span><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=nb>BIGINT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>nextval</span><span class=p>(</span><span class=s1>&#39;hibernate_sequence&#39;</span><span class=p>),</span><span class=w>
</span><span class=w>    </span><span class=n>title</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>100</span><span class=p>),</span><span class=w>
</span><span class=w>    </span><span class=n>isbn</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=n>isbn_size_between_13_20</span><span class=w> </span><span class=k>CHECK</span><span class=w> </span><span class=p>(</span><span class=k>char_length</span><span class=p>(</span><span class=n>isbn</span><span class=p>)</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=mi>13</span><span class=p>),</span><span class=w>
</span><span class=w>    </span><span class=n>author</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>100</span><span class=p>),</span><span class=w>
</span><span class=w>    </span><span class=n>price</span><span class=w> </span><span class=nb>NUMERIC</span><span class=p>(</span><span class=mi>6</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>)</span><span class=w> </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=n>positive_price</span><span class=w> </span><span class=k>CHECK</span><span class=w> </span><span class=p>(</span><span class=n>price</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w>
</span><span class=w></span><span class=p>);</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>books</span><span class=w> </span><span class=p>(</span><span class=n>title</span><span class=p>,</span><span class=w> </span><span class=n>isbn</span><span class=p>,</span><span class=w> </span><span class=n>author</span><span class=p>,</span><span class=w> </span><span class=n>price</span><span class=p>)</span><span class=w>
</span><span class=w></span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;Pairing Apache Shiro and Java EE 7&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;978-1-365-12404-4&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Nebrass Lamouchi&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>books</span><span class=w> </span><span class=p>(</span><span class=n>title</span><span class=p>,</span><span class=w> </span><span class=n>isbn</span><span class=p>,</span><span class=w> </span><span class=n>author</span><span class=p>,</span><span class=w> </span><span class=n>price</span><span class=p>)</span><span class=w>
</span><span class=w></span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;Playing with Java Microservices on Kubernetes and OpenShift&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;9782956428510&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Nebrass Lamouchi&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>9</span><span class=p>.</span><span class=mi>18</span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>books</span><span class=w> </span><span class=p>(</span><span class=n>title</span><span class=p>,</span><span class=w> </span><span class=n>isbn</span><span class=p>,</span><span class=w> </span><span class=n>author</span><span class=p>,</span><span class=w> </span><span class=n>price</span><span class=p>)</span><span class=w>
</span><span class=w></span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;Pro Java Microservices with Quarkus and Kubernetes&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;9781484271698&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Nebrass Lamouchi&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>65</span><span class=p>);</span><span class=w>
</span></code></pre></td></tr></table>
</div>
</div><p>Then, we need to create a <strong>Flyway</strong> migration component that will use the <strong>DevServices</strong> credentials to load this script to our Database:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=nd>@ApplicationScoped</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>FlywayMigrationService</span> <span class=o>{</span>

    <span class=nd>@ConfigProperty</span><span class=o>(</span><span class=n>name</span> <span class=o>=</span> <span class=s>&#34;quarkus.datasource.reactive.url&#34;</span><span class=o>)</span>
    <span class=n>String</span> <span class=n>dbUrl</span><span class=o>;</span>
    <span class=nd>@ConfigProperty</span><span class=o>(</span><span class=n>name</span> <span class=o>=</span> <span class=s>&#34;quarkus.datasource.username&#34;</span><span class=o>)</span>
    <span class=n>String</span> <span class=n>dbUsername</span><span class=o>;</span>
    <span class=nd>@ConfigProperty</span><span class=o>(</span><span class=n>name</span> <span class=o>=</span> <span class=s>&#34;quarkus.datasource.password&#34;</span><span class=o>)</span>
    <span class=n>String</span> <span class=n>dbPassword</span><span class=o>;</span>

    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>runFlywayMigration</span><span class=o>(</span><span class=nd>@Observes</span> <span class=n>StartupEvent</span> <span class=n>event</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>Flyway</span> <span class=n>flyway</span> <span class=o>=</span> <span class=n>Flyway</span><span class=o>.</span><span class=na>configure</span><span class=o>()</span>
                <span class=o>.</span><span class=na>dataSource</span><span class=o>(</span><span class=s>&#34;jdbc:&#34;</span> <span class=o>+</span> <span class=n>dbUrl</span><span class=o>,</span> <span class=n>dbUsername</span><span class=o>,</span> <span class=n>dbPassword</span><span class=o>)</span>
                <span class=o>.</span><span class=na>load</span><span class=o>();</span>

        <span class=n>flyway</span><span class=o>.</span><span class=na>migrate</span><span class=o>();</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table>
</div>
</div><p>The <code>FlywayMigrationService</code> will grab the <strong>DevService Database credentials</strong> and will load all the migration scripts stored in the <strong>Flyway</strong> directory.</p>
<p>Next, we will create a <strong>Reactive Repository</strong> to manage our <strong>Books</strong> in our <strong>DB</strong>:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=nd>@ApplicationScoped</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>BookRepository</span> <span class=kd>implements</span> <span class=n>PanacheRepositoryBase</span><span class=o>&lt;</span><span class=n>Book</span><span class=o>,</span> <span class=n>Long</span><span class=o>&gt;</span> <span class=o>{</span>
<span class=o>}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>‚ÑπÔ∏è The <code>PanacheRepositoryBase</code> represents a <code>Repository</code> for a specific type of entity <code>Entity</code>. Implementing this repository will gain you similar useful methods that are on <strong>Spring Data</strong> <code>JpaRepository</code> like:</p>
</blockquote>
<ul>
<li>findAll()</li>
<li>findById()</li>
<li>persist()</li>
<li>update()</li>
<li>delete()</li>
<li>etc..</li>
</ul>
<p>Then, we will create the <code>BookService</code> component with an injected <code>BookRepository</code>:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=nd>@ApplicationScoped</span>
<span class=nd>@RequiredArgsConstructor</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>BookService</span> <span class=o>{</span>
    <span class=kd>private</span> <span class=kd>final</span> <span class=n>BookRepository</span> <span class=n>bookRepository</span><span class=o>;</span>
<span class=o>}</span>
</code></pre></td></tr></table>
</div>
</div><p>Then, in the <strong>Service</strong> layer, we will implement the <strong>CRUD operations</strong> thru the <strong>Repository</strong> in the <strong>Reactive mode</strong>.</p>
<h3 id=implementing-the-findall-method>Implementing the findAll() method<a hidden class=anchor aria-hidden=true href=#implementing-the-findall-method>#</a></h3>
<p>To grab all entities of the <code>Book</code> entity, we will be call the <code>findAll()</code> method of the <strong>BookRepository</strong>. In the <code>PanacheRepositoryBase</code> interface, the <code>findAll</code> method returns a <code>PanacheQuery&lt;Entity></code>.</p>
<blockquote>
<p>‚ÑπÔ∏è A <strong>PanacheQuery</strong> is an interface representing an entity query, which abstracts the use of paging, getting the number of results, and operating on <code>List</code> or <code>Stream</code>. The <code>PanacheQuery</code> interface will get its implementation based on the shipped <strong>Panache</strong> dependency that we have. In our case it will be implemented in the <code>PanacheQueryImpl</code> class from the <code>io.quarkus.hibernate.reactive.panache.runtime</code> package from the <code>quarkus-hibernate-reactive-panache</code> extension.</p>
</blockquote>
<p>The <code>list()</code> method from the <code>PanacheQueryImpl</code> class returns a <code>Uni&lt;List&lt;T>></code>.</p>
<p>But, what is the <code>Uni</code> type ?</p>
<blockquote>
<p>A¬†<code>Uni&lt;T></code>¬†is a specialized stream that emits only an item or a failure. Typically,¬†<code>Uni&lt;T></code>¬†are great to represent asynchronous actions such as a remote procedure call, an HTTP request, or an operation producing a single result.</p>
<p><code>Uni&lt;T></code>¬†provides many operators that create, transform, and orchestrate¬†<code>Uni</code> sequences.</p>
<p>&ndash; <a href=https://smallrye.io/smallrye-mutiny/getting-started/creating-unis>SmallRye Mutiny</a> documentation</p>
</blockquote>
<p>In the <strong>BookService</strong>, we can use the <code>list()</code> method from the <code>PanacheQueryImpl</code> class to grab all the books. The <code>findAll()</code> will look like:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=n>Uni</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&lt;</span><span class=n>Book</span><span class=o>&gt;&gt;</span> <span class=nf>findAll</span><span class=o>()</span> <span class=o>{</span>
    <span class=k>return</span> <span class=n>bookRepository</span><span class=o>.</span><span class=na>findAll</span><span class=o>().</span><span class=na>list</span><span class=o>();</span>
<span class=o>}</span>
</code></pre></td></tr></table>
</div>
</div><p>‚ÑπÔ∏è Actually, there is a shortcut to the <code>findAll().list()</code> in the <code>PanacheRepositoryBase</code> interface, but I wanted to take you in a tour to show you how things are already made.</p>
<p>Then, we will create the <strong>BookResource</strong> to expose the <code>findAll()</code> operation:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=nd>@RequiredArgsConstructor</span>
<span class=nd>@Produces</span><span class=o>(</span><span class=n>MediaType</span><span class=o>.</span><span class=na>APPLICATION_JSON</span><span class=o>)</span>
<span class=nd>@Path</span><span class=o>(</span><span class=s>&#34;/api/books&#34;</span><span class=o>)</span>
<span class=nd>@RequestScoped</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>BookResource</span> <span class=o>{</span>

    <span class=kd>private</span> <span class=kd>final</span> <span class=n>BookService</span> <span class=n>bookService</span><span class=o>;</span>

    <span class=nd>@GET</span>
    <span class=kd>public</span> <span class=n>Uni</span><span class=o>&lt;</span><span class=n>Response</span><span class=o>&gt;</span> <span class=nf>findAll</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>return</span> <span class=n>bookService</span><span class=o>.</span><span class=na>findAll</span><span class=o>()</span>
                <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>data</span> <span class=o>-&gt;</span> <span class=n>ok</span><span class=o>(</span><span class=n>data</span><span class=o>).</span><span class=na>build</span><span class=o>());</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table>
</div>
</div><p>We are wrapping the <code>List&lt;Book></code> inside the <code>Uni&lt;Response></code>.</p>
<p>Then, if you run the <strong>Quarkus</strong> application using the <code>mvn quarkus:dev</code> command, then we can test the <code>findAll</code> <strong>REST API</strong> using the <strong>Swagger UI</strong> available on <a href=http://localhost:8080/q/swagger-ui/>http://localhost:8080/q/swagger-ui/</a>:</p>
<div align=center>
<p><img loading=lazy src=../images/reactive-quarkus-findall-swagger-942x1024.webp alt="findAll REST API - Swagger UI">
<em>findAll</em> REST API - Swagger UI</p>
</div>
<h3 id=implementing-the-save-method>Implementing the save() method<a hidden class=anchor aria-hidden=true href=#implementing-the-save-method>#</a></h3>
<p>After implementing the <code>findAll()</code> method, we need to create the one that inserts records in the database üòÖ</p>
<p>In our REST API, the <code>save()</code> method is called with JSON Payload holding a new book details. These details can be defined as a DTO Model class that I will call BookDTO:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=nd>@lombok.Data</span>
<span class=nd>@lombok.NoArgsConstructor</span>
<span class=nd>@lombok.AllArgsConstructor</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>BookDTO</span> <span class=o>{</span>
    <span class=kd>private</span> <span class=n>Long</span> <span class=n>id</span><span class=o>;</span>
    <span class=kd>private</span> <span class=n>String</span> <span class=n>title</span><span class=o>;</span>
    <span class=kd>private</span> <span class=n>String</span> <span class=n>isbn</span><span class=o>;</span>
    <span class=kd>private</span> <span class=n>String</span> <span class=n>author</span><span class=o>;</span>
    <span class=kd>private</span> <span class=n>BigDecimal</span> <span class=n>price</span><span class=o>;</span>
<span class=o>}</span>
</code></pre></td></tr></table>
</div>
</div><p>In the <code>BookResource</code> class we need to add a new method that is called using the HTTP Post Verb and that consumes as JSON Payload the BookDTO:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=nd>@POST</span>
<span class=nd>@Consumes</span><span class=o>(</span><span class=n>MediaType</span><span class=o>.</span><span class=na>APPLICATION_JSON</span><span class=o>)</span>
<span class=kd>public</span> <span class=n>Uni</span><span class=o>&lt;</span><span class=n>Response</span><span class=o>&gt;</span> <span class=nf>create</span><span class=o>(</span><span class=n>BookDTO</span> <span class=n>bookDTO</span><span class=o>)</span> <span class=o>{</span>
    <span class=k>return</span> <span class=n>bookService</span><span class=o>.</span><span class=na>save</span><span class=o>(</span><span class=n>bookDTO</span><span class=o>)</span>                                        <span class=o>&lt;</span><span class=n>1</span><span class=o>&gt;</span>
            <span class=o>.</span><span class=na>onItem</span><span class=o>().</span><span class=na>ifNotNull</span><span class=o>().</span><span class=na>transform</span><span class=o>(</span><span class=n>book</span> <span class=o>-&gt;</span> <span class=n>ok</span><span class=o>(</span><span class=n>book</span><span class=o>).</span><span class=na>build</span><span class=o>())</span>       <span class=o>&lt;</span><span class=n>2</span><span class=o>&gt;</span>
            <span class=o>.</span><span class=na>onItem</span><span class=o>().</span><span class=na>ifNull</span><span class=o>().</span><span class=na>continueWith</span><span class=o>(</span><span class=n>status</span><span class=o>(</span><span class=n>BAD_REQUEST</span><span class=o>)::</span><span class=n>build</span><span class=o>);</span>    <span class=o>&lt;</span><span class=n>3</span><span class=o>&gt;</span>
<span class=o>}</span>
</code></pre></td></tr></table>
</div>
</div><p>The line(s):</p>
<ul>
<li>1: will delegate the saving task to the <code>bookService.save()</code> method.</li>
<li>2: if the <code>save()</code> succeeds then we will return the <strong>created Book entry</strong> in the Response body.</li>
<li>3: if the <code>save()</code> fails then we will return an <strong>HTTP Bad Request (400)</strong> in the Response body.</li>
</ul>
<p>Now, we need to create the <code>save()</code> method in the <code>BookService</code>. This is will be obviously calling the <code>BookRepository</code> save method:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=n>Uni</span><span class=o>&lt;</span><span class=n>Book</span><span class=o>&gt;</span> <span class=nf>save</span><span class=o>(</span><span class=n>BookDTO</span> <span class=n>dto</span><span class=o>)</span> <span class=o>{</span>
    <span class=k>return</span> <span class=n>bookRepository</span><span class=o>.</span><span class=na>persistAndFlush</span><span class=o>(</span><span class=k>new</span> <span class=n>Book</span><span class=o>(</span>
            <span class=n>dto</span><span class=o>.</span><span class=na>getTitle</span><span class=o>(),</span>
            <span class=n>dto</span><span class=o>.</span><span class=na>getIsbn</span><span class=o>(),</span>
            <span class=n>dto</span><span class=o>.</span><span class=na>getAuthor</span><span class=o>(),</span>
            <span class=n>dto</span><span class=o>.</span><span class=na>getPrice</span><span class=o>()</span>
    <span class=o>));</span>
<span class=o>}</span>
</code></pre></td></tr></table>
</div>
</div><p>You can notice that the <code>persistAndFlush()</code> method returns a <code>Uni&lt;Book></code> which we already discovered in the previous part of this tutorial.</p>
<p>Hmm.. I have something to modify in my <code>BookService</code> after introducing the <code>BookDTO</code> class. I wonder:</p>
<ul>
<li>Why do I need to return the all the <code>Book</code> entity records in my <code>findAll()</code> method ? Why I dont return instead the entity records wrapped as DTO instances ? Is this will be better or it&rsquo;s just an overhead ?</li>
</ul>
<p>The RESPONSE is: THIS IS MUST BE DONE ‚öîÔ∏èüõ°‚öîÔ∏è But why ?</p>
<p>The DTO pattern is highly useful in many cases:</p>
<ul>
<li>Returning the plain data directly from the database to the user can be dangerous when the entity records hold sensitive data such as password, payments credentials, adresses, etc. So records mapping to DTOs is a must - as you cannot obfuscate data on the record instance itself üòÅ</li>
<li>The DTO offers the ability to provide the data that is needed in different contexts. For example, the <code>findAll()</code> method in a page that needs only the books titles and prices is not the same as a page that needs the books titles and isbns only. DTOs here will be offering the possibility to create a separate DTO dedicated for each need.</li>
</ul>
<blockquote>
<p>üí° It&rsquo;s true that in our example none of these needs are present, but I will use the DTO for learning purposes ü•π</p>
</blockquote>
<p>My <code>findAll()</code> method with DTOs will look like:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=n>Uni</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&lt;</span><span class=n>BookDTO</span><span class=o>&gt;&gt;</span> <span class=nf>findAll</span><span class=o>()</span> <span class=o>{</span>
    <span class=k>return</span> <span class=n>bookRepository</span><span class=o>.</span><span class=na>findAll</span><span class=o>()</span>
            <span class=o>.</span><span class=na>stream</span><span class=o>()</span>
            <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>bookEntity</span> <span class=o>-&gt;</span> <span class=k>new</span> <span class=n>BookDTO</span><span class=o>(</span>
                    <span class=n>bookEntity</span><span class=o>.</span><span class=na>getId</span><span class=o>(),</span>
                    <span class=n>bookEntity</span><span class=o>.</span><span class=na>getTitle</span><span class=o>(),</span>
                    <span class=n>bookEntity</span><span class=o>.</span><span class=na>getIsbn</span><span class=o>(),</span>
                    <span class=n>bookEntity</span><span class=o>.</span><span class=na>getAuthor</span><span class=o>(),</span>
                    <span class=n>bookEntity</span><span class=o>.</span><span class=na>getPrice</span><span class=o>()</span>
            <span class=o>))</span>
            <span class=o>.</span><span class=na>collect</span><span class=o>()</span>
            <span class=o>.</span><span class=na>asList</span><span class=o>();</span>
<span class=o>}</span>
</code></pre></td></tr></table>
</div>
</div><p>Hhmmmmmmmm.. in the <code>save()</code> method I instanciated a new Book instance and I passed the attributes to the constructor, and here I passed the attributes from the entity record to the instanciated DTO constructor. Ok this is clear, but headache and it&rsquo;s not beautiful ü§Æ</p>
<p>One idea, is to create Mapping methods:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=kd>private</span> <span class=n>java</span><span class=o>.</span><span class=na>util</span><span class=o>.</span><span class=na>function</span><span class=o>.</span><span class=na>Function</span><span class=o>&lt;</span><span class=n>Book</span><span class=o>,</span> <span class=n>BookDTO</span><span class=o>&gt;</span> <span class=nf>mapBookEntityToDTO</span><span class=o>()</span> <span class=o>{</span>
    <span class=k>return</span> <span class=n>bookEntity</span> <span class=o>-&gt;</span> <span class=k>new</span> <span class=n>BookDTO</span><span class=o>(</span>
            <span class=n>bookEntity</span><span class=o>.</span><span class=na>getId</span><span class=o>(),</span>
            <span class=n>bookEntity</span><span class=o>.</span><span class=na>getTitle</span><span class=o>(),</span>
            <span class=n>bookEntity</span><span class=o>.</span><span class=na>getIsbn</span><span class=o>(),</span>
            <span class=n>bookEntity</span><span class=o>.</span><span class=na>getAuthor</span><span class=o>(),</span>
            <span class=n>bookEntity</span><span class=o>.</span><span class=na>getPrice</span><span class=o>()</span>
    <span class=o>);</span>
<span class=o>}</span>

<span class=kd>private</span> <span class=n>java</span><span class=o>.</span><span class=na>util</span><span class=o>.</span><span class=na>function</span><span class=o>.</span><span class=na>Function</span><span class=o>&lt;</span><span class=n>BookDTO</span><span class=o>,</span> <span class=n>Book</span><span class=o>&gt;</span> <span class=nf>mapBookDtoToEntity</span><span class=o>()</span> <span class=o>{</span>
    <span class=k>return</span> <span class=n>bookDTO</span> <span class=o>-&gt;</span> <span class=k>new</span> <span class=n>Book</span><span class=o>(</span>
            <span class=n>bookDTO</span><span class=o>.</span><span class=na>getTitle</span><span class=o>(),</span>
            <span class=n>bookDTO</span><span class=o>.</span><span class=na>getIsbn</span><span class=o>(),</span>
            <span class=n>bookDTO</span><span class=o>.</span><span class=na>getAuthor</span><span class=o>(),</span>
            <span class=n>bookDTO</span><span class=o>.</span><span class=na>getPrice</span><span class=o>()</span>
    <span class=o>);</span>
<span class=o>}</span>
</code></pre></td></tr></table>
</div>
</div><p>Then my <code>findAll()</code> and <code>save()</code> methods will look like:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=n>Uni</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&lt;</span><span class=n>BookDTO</span><span class=o>&gt;&gt;</span> <span class=nf>findAll</span><span class=o>()</span> <span class=o>{</span>
    <span class=k>return</span> <span class=n>bookRepository</span><span class=o>.</span><span class=na>findAll</span><span class=o>()</span>
            <span class=o>.</span><span class=na>stream</span><span class=o>()</span>
            <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>mapBookEntityToDTO</span><span class=o>())</span>
            <span class=o>.</span><span class=na>collect</span><span class=o>()</span>
            <span class=o>.</span><span class=na>asList</span><span class=o>();</span>
<span class=o>}</span>

<span class=kd>public</span> <span class=n>Uni</span><span class=o>&lt;</span><span class=n>BookDTO</span><span class=o>&gt;</span> <span class=nf>save</span><span class=o>(</span><span class=n>BookDTO</span> <span class=n>dto</span><span class=o>)</span> <span class=o>{</span>
    <span class=k>return</span> <span class=n>bookRepository</span><span class=o>.</span><span class=na>persistAndFlush</span><span class=o>(</span>
                    <span class=n>mapBookDtoToEntity</span><span class=o>().</span><span class=na>apply</span><span class=o>(</span><span class=n>dto</span><span class=o>))</span>
            <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>mapBookEntityToDTO</span><span class=o>());</span>
<span class=o>}</span>
</code></pre></td></tr></table>
</div>
</div><p>Ouuuf üò© This is better, but it will be better if there are any cleaner way.. I know it will be crazy to create <strong>2 x N methods</strong> if we will have <strong>N different DTO for each entity</strong>. The good news is that there is an excellent solution to do this: <strong>Java bean mappings utility classes</strong> !</p>
<p>Hmm üòí the name is no so funky ! I know ! But this is what is called. I won&rsquo;t reinvent the wheel üòÅ</p>
<h3 id=implementing-the-mapping-mechanism>Implementing the Mapping mechanism<a hidden class=anchor aria-hidden=true href=#implementing-the-mapping-mechanism>#</a></h3>
<p>In the Java World, there are many libraries that helps to do dynamic mapping from an entity to its corresponding DTO classes. Since 2016, I was trying many of them like: <em>MapStruct, Dozer, ModelMapper, JMapper, etc</em>. But the best one that suited my needs is <strong>MapStruct</strong>.</p>
<p>You can read about benchmarking and performance of the different available libraries here @Baeldung: <a href=https://www.baeldung.com/java-performance-mapping-frameworks>https://www.baeldung.com/java-performance-mapping-frameworks</a>.</p>
<p>To add <strong>MapStruct</strong> to our application, we start by adding the <strong>MapStruct Maven dependency</strong> to our <code>pom.xml</code>:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=nt>&lt;properties&gt;</span>
    ...
    <span class=nt>&lt;mapstruct.version&gt;</span>1.4.2.Final<span class=nt>&lt;/mapstruct.version&gt;</span>
    <span class=nt>&lt;lombok-mapstruct-binding.version&gt;</span>0.2.0<span class=nt>&lt;/lombok-mapstruct-binding.version&gt;</span>
    ...
<span class=nt>&lt;/properties&gt;</span>

...

<span class=nt>&lt;dependencies&gt;</span>
    ...
    <span class=nt>&lt;dependency&gt;</span>
        <span class=nt>&lt;groupId&gt;</span>org.mapstruct<span class=nt>&lt;/groupId&gt;</span>
        <span class=nt>&lt;artifactId&gt;</span>mapstruct<span class=nt>&lt;/artifactId&gt;</span>
        <span class=nt>&lt;version&gt;</span>${mapstruct.version}<span class=nt>&lt;/version&gt;</span>
    <span class=nt>&lt;/dependency&gt;</span>
    ...
<span class=nt>&lt;/dependencies&gt;</span>    
</code></pre></td></tr></table>
</div>
</div><p>Then, in the Maven POM <code>build</code> section, we need to configure the compiler to take into consideration the <strong>MapStruct processor</strong> along with the <strong>Lombok processor</strong>:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=nt>&lt;build&gt;</span>
    <span class=nt>&lt;plugins&gt;</span>
        <span class=nt>&lt;plugin&gt;</span>
            <span class=nt>&lt;artifactId&gt;</span>maven-compiler-plugin<span class=nt>&lt;/artifactId&gt;</span>
            <span class=nt>&lt;version&gt;</span>${compiler-plugin.version}<span class=nt>&lt;/version&gt;</span>
            <span class=nt>&lt;configuration&gt;</span>
                <span class=nt>&lt;compilerArgs&gt;</span>
                    <span class=nt>&lt;arg&gt;</span>-parameters<span class=nt>&lt;/arg&gt;</span>
                <span class=nt>&lt;/compilerArgs&gt;</span>
                <span class=nt>&lt;annotationProcessorPaths&gt;</span>
                    <span class=nt>&lt;path&gt;</span>
                        <span class=nt>&lt;groupId&gt;</span>org.mapstruct<span class=nt>&lt;/groupId&gt;</span>
                        <span class=nt>&lt;artifactId&gt;</span>mapstruct-processor<span class=nt>&lt;/artifactId&gt;</span>
                        <span class=nt>&lt;version&gt;</span>${mapstruct.version}<span class=nt>&lt;/version&gt;</span>
                    <span class=nt>&lt;/path&gt;</span>
                    <span class=c>&lt;!-- other annotation processors --&gt;</span>
                    <span class=nt>&lt;path&gt;</span>
                        <span class=nt>&lt;groupId&gt;</span>org.projectlombok<span class=nt>&lt;/groupId&gt;</span>
                        <span class=nt>&lt;artifactId&gt;</span>lombok<span class=nt>&lt;/artifactId&gt;</span>
                        <span class=nt>&lt;version&gt;</span>${lombok.version}<span class=nt>&lt;/version&gt;</span>
                    <span class=nt>&lt;/path&gt;</span>
                    <span class=nt>&lt;dependency&gt;</span>
                        <span class=nt>&lt;groupId&gt;</span>org.projectlombok<span class=nt>&lt;/groupId&gt;</span>
                        <span class=nt>&lt;artifactId&gt;</span>lombok-mapstruct-binding<span class=nt>&lt;/artifactId&gt;</span>
                        <span class=nt>&lt;version&gt;</span>${lombok-mapstruct-binding.version}<span class=nt>&lt;/version&gt;</span>
                    <span class=nt>&lt;/dependency&gt;</span>
                <span class=nt>&lt;/annotationProcessorPaths&gt;</span>
            <span class=nt>&lt;/configuration&gt;</span>
        <span class=nt>&lt;/plugin&gt;</span>
    ...
<span class=nt>&lt;/build&gt;</span>    
</code></pre></td></tr></table>
</div>
</div><p>Now, we need to create the <strong>MapStruct Mapper class</strong> that will reference the <strong>Entity</strong> and the <strong>DTO</strong>:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=nd>@Mapper</span><span class=o>(</span><span class=n>componentModel</span> <span class=o>=</span> <span class=s>&#34;cdi&#34;</span><span class=o>)</span>
<span class=kd>public</span> <span class=kd>interface</span> <span class=nc>BookMapper</span> <span class=o>{</span>
    <span class=n>BookDTO</span> <span class=nf>toBookDto</span><span class=o>(</span><span class=n>Book</span> <span class=n>book</span><span class=o>);</span>

    <span class=n>Book</span> <span class=nf>toBookEntity</span><span class=o>(</span><span class=n>BookDTO</span> <span class=n>dto</span><span class=o>);</span>

    <span class=n>List</span><span class=o>&lt;</span><span class=n>BookDTO</span><span class=o>&gt;</span> <span class=nf>toBookDtoList</span><span class=o>(</span><span class=n>List</span><span class=o>&lt;</span><span class=n>Book</span><span class=o>&gt;</span> <span class=n>book</span><span class=o>);</span>

    <span class=kt>void</span> <span class=nf>updateBookEntityFromDto</span><span class=o>(</span><span class=n>BookDTO</span> <span class=n>dto</span><span class=o>,</span> <span class=nd>@MappingTarget</span> <span class=n>Book</span> <span class=n>book</span><span class=o>);</span>
<span class=o>}</span>
</code></pre></td></tr></table>
</div>
</div><p>This interface defines:</p>
<ul>
<li>the generated mapper as an <strong>application-scoped CDI bean</strong> and can be retrieved via <code>@Inject</code> annotation.</li>
<li>different methods that maps:
<ul>
<li>an entity to a DTO</li>
<li>a DTO to an entity</li>
<li>an entities list to a DTOs list</li>
<li>an update Entity from a DTO definition</li>
</ul>
</li>
</ul>
<p>Excellent ! Now, we can add the <code>BookMapper</code> reference for injection in the <code>BookService</code> class:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=nd>@ApplicationScoped</span>
<span class=nd>@RequiredArgsConstructor</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>BookService</span> <span class=o>{</span>

    <span class=kd>private</span> <span class=kd>final</span> <span class=n>BookRepository</span> <span class=n>bookRepository</span><span class=o>;</span>
    <span class=kd>private</span> <span class=kd>final</span> <span class=n>BookMapper</span> <span class=n>bookMapper</span><span class=o>;</span>

    <span class=o>...</span>
<span class=o>}</span>
</code></pre></td></tr></table>
</div>
</div><p>Then we can use the <strong>BookMapper</strong> in our <code>findAll()</code> and <code>save()</code> methods:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=n>Uni</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&lt;</span><span class=n>BookDTO</span><span class=o>&gt;&gt;</span> <span class=nf>findAll</span><span class=o>()</span> <span class=o>{</span>
    <span class=k>return</span> <span class=n>bookRepository</span><span class=o>.</span><span class=na>findAll</span><span class=o>()</span>
            <span class=o>.</span><span class=na>stream</span><span class=o>()</span>
            <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>bookMapper</span><span class=o>::</span><span class=n>toBookDto</span><span class=o>)</span>
            <span class=o>.</span><span class=na>collect</span><span class=o>()</span>
            <span class=o>.</span><span class=na>asList</span><span class=o>();</span>
<span class=o>}</span>

<span class=kd>public</span> <span class=n>Uni</span><span class=o>&lt;</span><span class=n>BookDTO</span><span class=o>&gt;</span> <span class=nf>save</span><span class=o>(</span><span class=n>BookDTO</span> <span class=n>book</span><span class=o>)</span> <span class=o>{</span>
    <span class=k>return</span> <span class=n>bookRepository</span><span class=o>.</span><span class=na>persistAndFlush</span><span class=o>(</span>
                <span class=n>bookMapper</span><span class=o>.</span><span class=na>toBookEntity</span><span class=o>(</span><span class=n>book</span><span class=o>))</span>
            <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>bookMapper</span><span class=o>::</span><span class=n>toBookDto</span><span class=o>);</span>
<span class=o>}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>üí° In the <code>save()</code> method, we used the mapper to create a Book instance from the DTO, and then convert the stored Book record to a DTO instance.</p>
</blockquote>
<p>That&rsquo;s all tale! The MapStruct will do all the magic!</p>
<p>Behind the scenes, the Maven Compiler will use the MapStruct Processor to implement the MapStruct Mapper via the <code>BookMapperImpl.java</code> class, available after compilation, in the <code>/target/generated-sources/annotations/</code> directory:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=nd>@Generated</span><span class=o>(</span>
    <span class=n>value</span> <span class=o>=</span> <span class=s>&#34;org.mapstruct.ap.MappingProcessor&#34;</span><span class=o>,</span>
    <span class=n>date</span> <span class=o>=</span> <span class=s>&#34;2022-05-27T11:20:38+0200&#34;</span><span class=o>,</span>
    <span class=n>comments</span> <span class=o>=</span> <span class=s>&#34;version: 1.4.2.Final, compiler: javac, environment: Java 17.0.3 (GraalVM Community)&#34;</span>
<span class=o>)</span>
<span class=nd>@ApplicationScoped</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>BookMapperImpl</span> <span class=kd>implements</span> <span class=n>BookMapper</span> <span class=o>{</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>BookDTO</span> <span class=nf>toBookDto</span><span class=o>(</span><span class=n>Book</span> <span class=n>book</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>if</span> <span class=o>(</span> <span class=n>book</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>)</span> <span class=o>{</span>
            <span class=k>return</span> <span class=kc>null</span><span class=o>;</span>
        <span class=o>}</span>

        <span class=n>BookDTO</span> <span class=n>bookDTO</span> <span class=o>=</span> <span class=k>new</span> <span class=n>BookDTO</span><span class=o>();</span>

        <span class=n>bookDTO</span><span class=o>.</span><span class=na>setId</span><span class=o>(</span> <span class=n>book</span><span class=o>.</span><span class=na>getId</span><span class=o>()</span> <span class=o>);</span>
        <span class=n>bookDTO</span><span class=o>.</span><span class=na>setTitle</span><span class=o>(</span> <span class=n>book</span><span class=o>.</span><span class=na>getTitle</span><span class=o>()</span> <span class=o>);</span>
        <span class=n>bookDTO</span><span class=o>.</span><span class=na>setIsbn</span><span class=o>(</span> <span class=n>book</span><span class=o>.</span><span class=na>getIsbn</span><span class=o>()</span> <span class=o>);</span>
        <span class=n>bookDTO</span><span class=o>.</span><span class=na>setAuthor</span><span class=o>(</span> <span class=n>book</span><span class=o>.</span><span class=na>getAuthor</span><span class=o>()</span> <span class=o>);</span>
        <span class=n>bookDTO</span><span class=o>.</span><span class=na>setPrice</span><span class=o>(</span> <span class=n>book</span><span class=o>.</span><span class=na>getPrice</span><span class=o>()</span> <span class=o>);</span>

        <span class=k>return</span> <span class=n>bookDTO</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>Book</span> <span class=nf>toBookEntity</span><span class=o>(</span><span class=n>BookDTO</span> <span class=n>dto</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>if</span> <span class=o>(</span> <span class=n>dto</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>)</span> <span class=o>{</span>
            <span class=k>return</span> <span class=kc>null</span><span class=o>;</span>
        <span class=o>}</span>

        <span class=n>Book</span> <span class=n>book</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Book</span><span class=o>();</span>

        <span class=n>book</span><span class=o>.</span><span class=na>setId</span><span class=o>(</span> <span class=n>dto</span><span class=o>.</span><span class=na>getId</span><span class=o>()</span> <span class=o>);</span>
        <span class=n>book</span><span class=o>.</span><span class=na>setTitle</span><span class=o>(</span> <span class=n>dto</span><span class=o>.</span><span class=na>getTitle</span><span class=o>()</span> <span class=o>);</span>
        <span class=n>book</span><span class=o>.</span><span class=na>setIsbn</span><span class=o>(</span> <span class=n>dto</span><span class=o>.</span><span class=na>getIsbn</span><span class=o>()</span> <span class=o>);</span>
        <span class=n>book</span><span class=o>.</span><span class=na>setAuthor</span><span class=o>(</span> <span class=n>dto</span><span class=o>.</span><span class=na>getAuthor</span><span class=o>()</span> <span class=o>);</span>
        <span class=n>book</span><span class=o>.</span><span class=na>setPrice</span><span class=o>(</span> <span class=n>dto</span><span class=o>.</span><span class=na>getPrice</span><span class=o>()</span> <span class=o>);</span>

        <span class=k>return</span> <span class=n>book</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>BookDTO</span><span class=o>&gt;</span> <span class=nf>toBookDtoList</span><span class=o>(</span><span class=n>List</span><span class=o>&lt;</span><span class=n>Book</span><span class=o>&gt;</span> <span class=n>book</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>if</span> <span class=o>(</span> <span class=n>book</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>)</span> <span class=o>{</span>
            <span class=k>return</span> <span class=kc>null</span><span class=o>;</span>
        <span class=o>}</span>

        <span class=n>List</span><span class=o>&lt;</span><span class=n>BookDTO</span><span class=o>&gt;</span> <span class=n>list</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>BookDTO</span><span class=o>&gt;(</span> <span class=n>book</span><span class=o>.</span><span class=na>size</span><span class=o>()</span> <span class=o>);</span>
        <span class=k>for</span> <span class=o>(</span> <span class=n>Book</span> <span class=n>book1</span> <span class=o>:</span> <span class=n>book</span> <span class=o>)</span> <span class=o>{</span>
            <span class=n>list</span><span class=o>.</span><span class=na>add</span><span class=o>(</span> <span class=n>toBookDto</span><span class=o>(</span> <span class=n>book1</span> <span class=o>)</span> <span class=o>);</span>
        <span class=o>}</span>

        <span class=k>return</span> <span class=n>list</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>updateBookEntityFromDto</span><span class=o>(</span><span class=n>BookDTO</span> <span class=n>dto</span><span class=o>,</span> <span class=n>Book</span> <span class=n>book</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>if</span> <span class=o>(</span> <span class=n>dto</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>)</span> <span class=o>{</span>
            <span class=k>return</span><span class=o>;</span>
        <span class=o>}</span>

        <span class=n>book</span><span class=o>.</span><span class=na>setId</span><span class=o>(</span> <span class=n>dto</span><span class=o>.</span><span class=na>getId</span><span class=o>()</span> <span class=o>);</span>
        <span class=n>book</span><span class=o>.</span><span class=na>setTitle</span><span class=o>(</span> <span class=n>dto</span><span class=o>.</span><span class=na>getTitle</span><span class=o>()</span> <span class=o>);</span>
        <span class=n>book</span><span class=o>.</span><span class=na>setIsbn</span><span class=o>(</span> <span class=n>dto</span><span class=o>.</span><span class=na>getIsbn</span><span class=o>()</span> <span class=o>);</span>
        <span class=n>book</span><span class=o>.</span><span class=na>setAuthor</span><span class=o>(</span> <span class=n>dto</span><span class=o>.</span><span class=na>getAuthor</span><span class=o>()</span> <span class=o>);</span>
        <span class=n>book</span><span class=o>.</span><span class=na>setPrice</span><span class=o>(</span> <span class=n>dto</span><span class=o>.</span><span class=na>getPrice</span><span class=o>()</span> <span class=o>);</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table>
</div>
</div><p>Great! I feel very comfortable for delegating the DTO Mapping load to MapStruct üòÅ <strong>As I always say: &ldquo;A Good Developer is a Lazy Developer&rdquo;</strong> üòÇ</p>
<h3 id=implementing-the-findbyid-findbyauthor-and-deletebyid-methods>Implementing the findById, findByAuthor and deleteById methods<a hidden class=anchor aria-hidden=true href=#implementing-the-findbyid-findbyauthor-and-deletebyid-methods>#</a></h3>
<p>Now, we will continue to implement our CRUD methods - like:</p>
<ul>
<li><code>findById()</code>: find a book using a given book ID.</li>
<li><code>findByAuthor()</code>: find books using a given author name.</li>
<li><code>deleteById()</code>: delete a book using a given book ID.</li>
</ul>
<p>The implementation looks like:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=n>Uni</span><span class=o>&lt;</span><span class=n>BookDTO</span><span class=o>&gt;</span> <span class=nf>findById</span><span class=o>(</span><span class=n>Long</span> <span class=n>id</span><span class=o>)</span> <span class=o>{</span>
    <span class=k>return</span> <span class=n>bookRepository</span><span class=o>.</span><span class=na>findById</span><span class=o>(</span><span class=n>id</span><span class=o>)</span>
            <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>bookMapper</span><span class=o>::</span><span class=n>toBookDto</span><span class=o>);</span>
<span class=o>}</span>

<span class=kd>public</span> <span class=n>Uni</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&lt;</span><span class=n>BookDTO</span><span class=o>&gt;&gt;</span> <span class=nf>findByAuthor</span><span class=o>(</span><span class=n>String</span> <span class=n>author</span><span class=o>)</span> <span class=o>{</span>
    <span class=k>return</span> <span class=n>bookRepository</span>
            <span class=o>.</span><span class=na>find</span><span class=o>(</span><span class=s>&#34;lower(author) like lower(CONCAT(&#39;%&#39;, &#39;&#34;</span> <span class=o>+</span> <span class=n>author</span> <span class=o>+</span> <span class=s>&#34;&#39;, &#39;%&#39;)) &#34;</span><span class=o>)</span> <span class=o>&lt;</span><span class=n>1</span><span class=o>&gt;</span>
            <span class=o>.</span><span class=na>stream</span><span class=o>()</span>
            <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>bookMapper</span><span class=o>::</span><span class=n>toBookDto</span><span class=o>)</span>
            <span class=o>.</span><span class=na>collect</span><span class=o>()</span>
            <span class=o>.</span><span class=na>asList</span><span class=o>();</span>
<span class=o>}</span>

<span class=nd>@ReactiveTransactional</span> <span class=o>&lt;</span><span class=n>2</span><span class=o>&gt;</span>
<span class=kd>public</span> <span class=n>Uni</span><span class=o>&lt;</span><span class=n>Void</span><span class=o>&gt;</span> <span class=nf>deleteById</span><span class=o>(</span><span class=n>Long</span> <span class=n>id</span><span class=o>)</span> <span class=o>{</span>
    <span class=k>return</span> <span class=n>bookRepository</span><span class=o>.</span><span class=na>deleteById</span><span class=o>(</span><span class=n>id</span><span class=o>).</span><span class=na>replaceWithVoid</span><span class=o>();</span>
<span class=o>}</span>
</code></pre></td></tr></table>
</div>
</div><p>The line:</p>
<ul>
<li>1: defines the Hibernate Query that is used to search by author name with ignore case.</li>
<li>2: runs the method into a reactive <code>Mutiny.Session.Transation</code>.</li>
</ul>
<p>Then, their REST APIs look like:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=nd>@RequiredArgsConstructor</span>
<span class=nd>@Produces</span><span class=o>(</span><span class=n>MediaType</span><span class=o>.</span><span class=na>APPLICATION_JSON</span><span class=o>)</span>
<span class=nd>@Path</span><span class=o>(</span><span class=s>&#34;/api/books&#34;</span><span class=o>)</span>
<span class=nd>@RequestScoped</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>BookResource</span> <span class=o>{</span>

    <span class=kd>private</span> <span class=kd>final</span> <span class=n>BookService</span> <span class=n>bookService</span><span class=o>;</span>

    <span class=o>...</span>

    <span class=nd>@GET</span>
    <span class=nd>@Path</span><span class=o>(</span><span class=s>&#34;/{id}&#34;</span><span class=o>)</span>
    <span class=kd>public</span> <span class=n>Uni</span><span class=o>&lt;</span><span class=n>Response</span><span class=o>&gt;</span> <span class=nf>findById</span><span class=o>(</span><span class=nd>@PathParam</span><span class=o>(</span><span class=s>&#34;id&#34;</span><span class=o>)</span> <span class=n>Long</span> <span class=n>id</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>return</span> <span class=n>bookService</span><span class=o>.</span><span class=na>findById</span><span class=o>(</span><span class=n>id</span><span class=o>)</span>
                <span class=o>.</span><span class=na>onItem</span><span class=o>().</span><span class=na>ifNotNull</span><span class=o>().</span><span class=na>transform</span><span class=o>(</span><span class=n>book</span> <span class=o>-&gt;</span> <span class=n>ok</span><span class=o>(</span><span class=n>book</span><span class=o>).</span><span class=na>build</span><span class=o>())</span>
                <span class=o>.</span><span class=na>onItem</span><span class=o>().</span><span class=na>ifNull</span><span class=o>().</span><span class=na>continueWith</span><span class=o>(</span><span class=n>status</span><span class=o>(</span><span class=n>NOT_FOUND</span><span class=o>)::</span><span class=n>build</span><span class=o>);</span>
    <span class=o>}</span>

    <span class=nd>@GET</span>
    <span class=nd>@Path</span><span class=o>(</span><span class=s>&#34;/author/{name}&#34;</span><span class=o>)</span>
    <span class=kd>public</span> <span class=n>Uni</span><span class=o>&lt;</span><span class=n>Response</span><span class=o>&gt;</span> <span class=nf>findByAuthor</span><span class=o>(</span><span class=nd>@PathParam</span><span class=o>(</span><span class=s>&#34;name&#34;</span><span class=o>)</span> <span class=n>String</span> <span class=n>name</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>return</span> <span class=n>bookService</span><span class=o>.</span><span class=na>findByAuthor</span><span class=o>(</span><span class=n>name</span><span class=o>)</span>
                <span class=o>.</span><span class=na>onItem</span><span class=o>().</span><span class=na>ifNotNull</span><span class=o>().</span><span class=na>transform</span><span class=o>(</span><span class=n>book</span> <span class=o>-&gt;</span> <span class=n>ok</span><span class=o>(</span><span class=n>book</span><span class=o>).</span><span class=na>build</span><span class=o>())</span>
                <span class=o>.</span><span class=na>onItem</span><span class=o>().</span><span class=na>ifNull</span><span class=o>().</span><span class=na>continueWith</span><span class=o>(</span><span class=n>status</span><span class=o>(</span><span class=n>NOT_FOUND</span><span class=o>)::</span><span class=n>build</span><span class=o>);</span>
    <span class=o>}</span>

    <span class=nd>@DELETE</span>
    <span class=nd>@Path</span><span class=o>(</span><span class=s>&#34;/{id}&#34;</span><span class=o>)</span>
    <span class=kd>public</span> <span class=n>Uni</span><span class=o>&lt;</span><span class=n>Void</span><span class=o>&gt;</span> <span class=nf>deleteById</span><span class=o>(</span><span class=nd>@PathParam</span><span class=o>(</span><span class=s>&#34;id&#34;</span><span class=o>)</span> <span class=n>Long</span> <span class=n>id</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>return</span> <span class=n>bookService</span><span class=o>.</span><span class=na>deleteById</span><span class=o>(</span><span class=n>id</span><span class=o>);</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table>
</div>
</div><p>That&rsquo;s all tale ! üòÅ We made our first <strong>Quarkus Reactive application</strong> ! You can now write some integration tests using RestAssured to be sure that all is working as expected ü§©</p>
<p>If you have questions, please feel free to get in touch with me üòé</p>
</div>
<footer class=post-footer>
<ul class=post-tags>
</ul>
<div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share Playing with Reactive Quarkus on twitter" href="https://twitter.com/intent/tweet/?text=Playing%20with%20Reactive%20Quarkus&url=https%3a%2f%2fblog.nebrass.fr%2fplaying-with-reactive-quarkus%2f&hashtags="><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Playing with Reactive Quarkus on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fblog.nebrass.fr%2fplaying-with-reactive-quarkus%2f&title=Playing%20with%20Reactive%20Quarkus&summary=Playing%20with%20Reactive%20Quarkus&source=https%3a%2f%2fblog.nebrass.fr%2fplaying-with-reactive-quarkus%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Playing with Reactive Quarkus on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fblog.nebrass.fr%2fplaying-with-reactive-quarkus%2f&title=Playing%20with%20Reactive%20Quarkus"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Playing with Reactive Quarkus on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.nebrass.fr%2fplaying-with-reactive-quarkus%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Playing with Reactive Quarkus on whatsapp" href="https://api.whatsapp.com/send?text=Playing%20with%20Reactive%20Quarkus%20-%20https%3a%2f%2fblog.nebrass.fr%2fplaying-with-reactive-quarkus%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Playing with Reactive Quarkus on telegram" href="https://telegram.me/share/url?text=Playing%20with%20Reactive%20Quarkus&url=https%3a%2f%2fblog.nebrass.fr%2fplaying-with-reactive-quarkus%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg>
</a>
</div>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2022 <a href=https://blog.nebrass.fr>Nebrass Homepage</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
</body>
</html>