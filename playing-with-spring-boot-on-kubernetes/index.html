<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Playing with Spring Boot on Kubernetes | Nebrass Homepage</title><meta name=keywords content="java,kubernetes,spring-boot"><meta name=description content="I. Introduction In this tutorial I will show you how to write a small Spring Boot CRUD application and how to deploy it on Kubernetes.
Spring Boot is an innovative project that aims to make it easy to create Spring applications by simplifying the configuration and deployment actions through its convention over configuration based setup.
Kubernetes (commonly referred to as &ldquo;K8s&rdquo;) is an open-source system for automating deployment, scaling and management of containerized applications that was originally designed by Google and now maintained by the Cloud Native Computing Foundation."><meta name=author content><link rel=canonical href=https://blog.nebrass.fr/playing-with-spring-boot-on-kubernetes/><link crossorigin=anonymous href=/assets/css/stylesheet.min.9aeab43847eb11aca320bfadedfe191ed6516dd768bf1314b534c4992aac901a.css integrity="sha256-muq0OEfrEayjIL+t7f4ZHtZRbddovxMUtTTEmSqskBo=" rel="preload stylesheet" as=style><script src=/js/prism.min.js></script>
<link rel=stylesheet href=/css/prism.min.css><link rel=icon href=https://blog.nebrass.fr/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.nebrass.fr/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.nebrass.fr/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.nebrass.fr/apple-touch-icon.png><link rel=mask-icon href=https://blog.nebrass.fr/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><style amp-custom>.main,.footer,.nav{max-width:calc(var(--main-width) + var(--gap) * 15)}</style><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,o,i,a,t,n,s){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,n=o.createElement(i),s=o.getElementsByTagName(i)[0],n.async=1,n.src=a,s.parentNode.insertBefore(n,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-111781986-1","auto"),ga("send","pageview"))</script><meta property="og:title" content="Playing with Spring Boot on Kubernetes"><meta property="og:description" content="I. Introduction In this tutorial I will show you how to write a small Spring Boot CRUD application and how to deploy it on Kubernetes.
Spring Boot is an innovative project that aims to make it easy to create Spring applications by simplifying the configuration and deployment actions through its convention over configuration based setup.
Kubernetes (commonly referred to as &ldquo;K8s&rdquo;) is an open-source system for automating deployment, scaling and management of containerized applications that was originally designed by Google and now maintained by the Cloud Native Computing Foundation."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.nebrass.fr/playing-with-spring-boot-on-kubernetes/"><meta property="og:image" content="https://blog.nebrass.fr/images/PlayingWithSpringBootOnK8S.webp"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-03-31T00:00:00+00:00"><meta property="article:modified_time" content="2018-03-31T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.nebrass.fr/images/PlayingWithSpringBootOnK8S.webp"><meta name=twitter:title content="Playing with Spring Boot on Kubernetes"><meta name=twitter:description content="I. Introduction In this tutorial I will show you how to write a small Spring Boot CRUD application and how to deploy it on Kubernetes.
Spring Boot is an innovative project that aims to make it easy to create Spring applications by simplifying the configuration and deployment actions through its convention over configuration based setup.
Kubernetes (commonly referred to as &ldquo;K8s&rdquo;) is an open-source system for automating deployment, scaling and management of containerized applications that was originally designed by Google and now maintained by the Cloud Native Computing Foundation."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://blog.nebrass.fr/posts/"},{"@type":"ListItem","position":3,"name":"Playing with Spring Boot on Kubernetes","item":"https://blog.nebrass.fr/playing-with-spring-boot-on-kubernetes/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Playing with Spring Boot on Kubernetes","name":"Playing with Spring Boot on Kubernetes","description":"I. Introduction In this tutorial I will show you how to write a small Spring Boot CRUD application and how to deploy it on Kubernetes.\nSpring Boot is an innovative project that aims to make it easy to create Spring applications by simplifying the configuration and deployment actions through its convention over configuration based setup.\nKubernetes (commonly referred to as \u0026ldquo;K8s\u0026rdquo;) is an open-source system for automating deployment, scaling and management of containerized applications that was originally designed by Google and now maintained by the Cloud Native Computing Foundation.","keywords":["java","kubernetes","spring-boot"],"articleBody":"I. Introduction In this tutorial I will show you how to write a small Spring Boot CRUD application and how to deploy it on Kubernetes.\nSpring Boot is an innovative project that aims to make it easy to create Spring applications by simplifying the configuration and deployment actions through its convention over configuration based setup.\nKubernetes (commonly referred to as ‚ÄúK8s‚Äù) is an open-source system for automating deployment, scaling and management of containerized applications that was originally designed by Google and now maintained by the Cloud Native Computing Foundation. It aims to provide a ‚Äúplatform for automating deployment, scaling, and operations of application containers across clusters of hosts‚Äù. It works with a range of container tools, including Docker.\nDocker is an open source project that automates the deployment of applications inside software containers.\nThis tutorial is a getting started point to the Spring Boot \u0026 K8s Stack.\nII. Writing the application 1. Creating the skull Here we go ! We will start using the great features and options offered by the Spring Framework Teams at Pivotal Software, Inc.\nTo avoid the hard parts when creating new project and getting it started, the Spring Team has created the Spring Initializr Project.\nThe Spring Initializr is a useful project that can generate a basic Spring Boot project structure easily. You can choose either your project to be based on Maven or Gradle, to use Java or Kotlin or Groovy, and to choose which version of Spring Boot you want to pick.\nSpring Initializr can be used:\n Using a Web-based Interface http://start.spring.io Using Spring Tool Suite or other different IDEs like NetBeans \u0026 IntelliJ Using the Spring Boot CLI  Spring Initializr gives you the ability to add the core dependencies that you need, like JDBC drivers or Spring Boot Starters.\n ‚ö†Ô∏è Hey! What is Spring Boot Starters?\nSpring Boot Starters are a set of convenient dependency descriptors that you can include in your application. You get a one-stop-shop for all the Spring and related technology that you need, without having to hunt through sample code and copy paste loads of dependency descriptors. For example, if you want to get started using Spring and JPA for database access, just include the spring-boot-starter-data-jpa dependency in your project,and you are good to go.\nThe starters contain a lot of the dependencies that you need to get a project up and running quickly and with a consistent, supported set of managed transitive dependencies.\n‚ÑπÔ∏è Note\nYou can learn more about Spring Boot Starters here: https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#using-boot-starter\n For our case we will be using:\n Maven Java 8 Spring Boot 1.5.x  And for the Dependencies we will choose:\n JPA H2 Rest Repositories Actuator Lombok   The resulting pom will be like:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62    xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\" 4.0.0 com.onepoint.labs myschool 0.0.1-SNAPSHOT jar MySchool Demo project for Spring Boot  org.springframework.boot spring-boot-starter-parent 1.5.10.RELEASE     UTF-8 UTF-8 1.8    org.springframework.boot spring-boot-starter-actuator   org.springframework.boot spring-boot-starter-data-jpa   org.springframework.boot spring-boot-starter-data-rest   com.h2database h2 runtime   org.springframework.boot spring-boot-starter-test test      org.springframework.boot spring-boot-maven-plugin       Now, we need to add the embedded databse configuration to the application.properties:\n1 2 3 4 5  spring.datasource.driver-class-name=org.h2.Driver spring.jpa.hibernate.ddl-auto=create spring.datasource.url=jdbc:h2:mem:boutique;DB_CLOSE_DELAY=-1 spring.datasource.username=sa spring.datasource.password=   Next, we will start the implementation of our Java components.\n2. Presenting the domain The domain of our application will just contain only one entity: Student.\n 3. Implementing the domain The Student entity will look like this:\n1 2 3 4 5 6 7 8 9 10 11  @Entity @Data public class Student { @Id @GeneratedValue(strategy = GenerationType.AUTO) private Long id; private String name; private String family; }    @Data generates all the boilerplate that is normally associated with simple POJOs (Plain Old Java Objects) and beans: getters for all fields, setters for all non-final fields, and appropriate toString, equals and hashCode implementations.  Next, we will implement the JPA Repository:\n1 2 3 4 5 6 7  @RepositoryRestResource(collectionResourceRel = \"students\", path = \"students\") public interface StudentRepository extends PagingAndSortingRepositoryStudent, Long { ListStudent findByName(String name); ListStudent findByNameAndFamily(String name, String family); }    We are using this annotation to customize the REST endpoint. We are extending the PagingAndSortingRepository Interface to get the paging \u0026 sorting features. We are implementing custom JPA Repository methods using the special Spring Data Query DSL.  4. Adding the Swagger 2 Capabilities Swagger 2 is an open source project used to describe and document RESTful APIs. Swagger 2 is language-agnostic and is extensible into new technologies and protocols beyond HTTP. The current version defines a set HTML, JavaScript and CSS assets to dynamically generate documentation from a Swagger-compliant API. These files are bundled by the Swagger UI project to display the API on browser. Besides rendering documentation, Swagger UI allows other API developers or consumers to interact with the API‚Äôs resources without having any of the implementation logic in place.\nThe Swagger 2 specification, which is known as OpenAPI specification has several implementations. We will be using the Springfox implementation in our project.\nTo enable the Swagger capabilities to our project, we will be:\n Adding the Maven Dependencies Adding the Java Configuration  The Maven Dependencies:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18    io.springfox springfox-data-rest 2.8.0   io.springfox springfox-swagger-ui 2.8.0   io.springfox springfox-swagger2 2.8.0    For the Java Configuration, we need to create a Spring @Bean that configure Swagger in the application context.\n1 2 3 4 5 6 7 8 9 10 11  @Configuration public class SwaggerConfig { @Bean public Docket productApi() { return new Docket(DocumentationType.SWAGGER_2).select() .apis(RequestHandlerSelectors.any()) .paths(PathSelectors.any()) .build(); } }   Also, we need to add the @EnableSwagger2 annotation to the SpringBootApplication Main Class. We also have to add the @Import({springfox.documentation.spring.data.rest.configuration.SpringDataRestConfiguration.class}) annotation, that enables the Springfox implementation to scan and parse the generated methods by Spring Data REST.\n5. Run it ! To run the Spring Boot Application, you just run: mvn spring-boot:run\nThe application will be running on the 8080 port. To access the application, just go to http://localhost:8080, you will see this:\n We will enjoy the game now: we will be using Swagger forms to insert some records.\nTo access the Swagger UI, just go to http://localhost:8080/swagger-ui.html#/\n We will be using the Student Entity menu ‚Üí POST operation called saveStudent ‚Üí Try it out ‚Üí in the form just mention the name and the family data that you want to store. For example:\n1 2 3 4  { \"family\": \"Lamouchi\", \"name\": \"Nebrass\" }   The screen will be like this:\n Just hit Execute and the Responde body will be somthing like this:\n1 2 3 4 5 6 7 8 9 10 11 12  { \"name\": \"Nebrass\", \"family\": \"Lamouchi\", \"_links\": { \"self\": { \"href\": \"http://localhost:8080/students/1\" }, \"student\": { \"href\": \"http://localhost:8080/students/1\" } } }   And the Response headers will look like this:\n1 2 3 4 5  content-type: application/hal+json;charset=UTF-8 date: Sun, 04 Mar 2018 22:05:55 GMT location: http://localhost:8080/students/1 transfer-encoding: chunked x-application-context: application:local   We can use the findAllStudents menu of the Swagger UI to list all the students in the DB, to be sure that the record has been successfully created:\nThe Response body of the findAll operation will look like:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36  { \"_embedded\": { \"students\": [ { \"name\": \"Nebrass\", \"family\": \"Lamouchi\", \"_links\": { \"self\": { \"href\": \"http://localhost:8080/students/1\" }, \"student\": { \"href\": \"http://localhost:8080/students/1\" } } } ] }, \"_links\": { \"self\": { \"href\": \"http://localhost:8080/students{?page,size,sort}\", \"templated\": true }, \"profile\": { \"href\": \"http://localhost:8080/profile/students\" }, \"search\": { \"href\": \"http://localhost:8080/students/search\" } }, \"page\": { \"size\": 20, \"totalElements\": 1, \"totalPages\": 1, \"number\": 0 } }    üí° Tip\nYou can simply go to http://localhost:8080/students and you will get all the students persisted to the DB.\n III. Moving to the Containers Era To deploy our (so huge, so big) application üòÇ, we will be using Docker. We will deploy our code in a container so we can enjoy the great feature provided by Docker.\nDocker has become the standard to develop and run containerized applications.\nThis is great ! Using Docker is quitely simple, especially in development stages. Deploying containers in the same server (docker-machine) is simple, but when start thinking to deploy many containers to many servers, things become complicated (managing the servers, managing the container state, etc.‚Äã).\nHere come the orchestration system, which provides many features like orchestrating computing, networking and storage infrastructure on behalf of user workloads\n Scheduling: matching containers to machines based on many factors like resources needs, affinity requirements‚Ä¶‚Äã Replications Handling failures Etc‚Ä¶‚Äã  For our tutorial, we will choose Kubernetes, the star of container orchestration.\n1. What is Kubernetes ? Kubernetes (Aka K8s) was a project spun out of Google as a open source next-gen container scheduler designed with the lessons learned from developing and managing Borg and Omega.\nKubernetes is designed to have loosely coupled components centered around deploying, maintaining and scaling applications. K8s abstracts the underlying infrastructure of the nodes and provides a uniform layer for the deployed applications.\n1.1 Kubernetes Architecture In the big plan, a Kubernetes cluster is composed of two items:\n Master Nodes: The main control plane for Kubernetes. It contains an API Server, a Scheduler, a Controller Manager (K8s cluster manager) and a datastore to save the cluster state called Etcd. Worker Nodes: A single host, physical or virual machine, capable of running POD. They are managed by the Master nodes.   Let‚Äôs have a look inside a Master node:\n (Kube) API-Server: allows the communication, thru REST APIs, between the Master node and all its clients such as Worker Nodes, kube-cli, ‚Ä¶‚Äã (Kube) Scheduler: a policy-rich, topology-aware, workload-specific function that significantly impacts availability, performance, and capacity to assign a Node to a newly created POD. (Kube) Controller Manager: a daemon that embeds the core control loops shipped with Kubernetes. A control loop is a permenent listener that regulates the state of the system. In Kubernetes, a controller is a control loop that watches the shared state of the cluster through the API-Server and makes changes attempting to move the current state towards the desired state. Etcd: a strong, consistent and highly available key-value store used for persisting the cluster state.  Then, what about a Worker node?\n Kubelet: an agent that runs on each node in the cluster. It makes sure that containers are running in a POD. Kube-Proxy: enables the Kubernetes service abstraction by maintaining network rules on the host and perform networking actions.   üí° Tip\nThe Container Runtime that we will user is Docker. Kubernetes is compatible with many others like Cri-o, Rkt, ‚Ä¶‚Äã\n 1.2 Kubernetes Core Concepts The K8s ecosystem covers many concepts and components. We will try to introduce them briefly.\nKubectl The kubectl is a command line interface for running commands against Kubernetes clusters.\nCluster A collection of hosts that aggregate their resources (CPU, Ram, Disk, ‚Ä¶‚Äã) into a usable pool.\nNamespace A logical partitioning capability that enable one Kubernetes cluster to be used by multiple users, teams of users, or a single user with multiple applications without concern for undesired interaction. Each user, team of users, or application may exist within its Namespace, isolated from every other user of the cluster and operating as if it were the sole user of the cluster.\nList all Namespace:\n1  $ kubectl get namespace # or `kubectl get ns`   Label Key-value pairs that are used to identify and select related sets of objects. Labels have a strict syntax and defined character set.\nAnnotation Key-value pairs that contain non-identifying information or metadata. Annotations do not have the the syntax limitations as labels and can contain structured or unstructured data.\nSelector Selectors use labels to filter or select objects. Both equality-based (=, ==, !=) or simple key-value matching selectors are supported.\nUse case of Annotations, Labels and Selectors.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  apiVersion:apps/v1kind:Deploymentmetadata:name:nginx-deploymentannotations:description:\"nginx frontend\"labels:app:nginxspec:replicas:3selector:matchLabels:app:nginxtemplate:metadata:labels:app:nginxspec:containers:- name:nginximage:nginx:1.7.9ports:- containerPort:80  Pod It is the basic unit of work for Kubernetes. Represent a collection of containers that share resources, such as IP addresses and storage.\nPod Example.\n1 2 3 4 5 6 7 8 9 10 11  apiVersion:v1kind:Podmetadata:name:myapp-podlabels:app:myappspec:containers:- name:myapp-containerimage:busyboxcommand:['sh','-c','echo Hello Kubernetes! \u0026\u0026 sleep 3600']  To list all Pods:\n1  $ kubectl get pod # or `kubectl get po`   ReplicationController A framework for defining pods that are meant to be horizontally scaled. A replication controller includes a pod definition that is to be replicated, and the pods created from it can be scheduled to different nodes.\nReplicationController Example.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  apiVersion:v1kind:ReplicationControllermetadata:name:nginxspec:replicas:3selector:app:nginxtemplate:metadata:name:nginxlabels:app:nginxspec:containers:- name:nginximage:nginxports:- containerPort:80  List all ReplicationControllers:\n1  $ kubectl get replicationcontroller # or `kubectl get rc`   ReplicaSet An upgraded version of ReplicationController that supports set-based selectors.\nReplicaSet Example.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28  apiVersion:apps/v1kind:ReplicaSetmetadata:name:frontendlabels:app:guestbooktier:frontendspec:replicas:3selector:matchLabels:tier:frontendmatchExpressions:- {key: tier, operator: In, values:[frontend]}template:metadata:labels:app:guestbooktier:frontendspec:containers:- name:php-redisimage:gcr.io/google_samples/gb-frontend:v3env:- name:GET_HOSTS_FROMvalue:dnsports:- containerPort:80  List all ReplicaSets:\n1  $ kubectl get replicaset # or `kubectl get rs`   Deployment Includes a Pod template and a replicas field. Kubernetes will make sure the actual state (amount of replicas, Pod template) always matches the desired state. When you update a Deployment it will perform a ‚Äúrolling update‚Äù.\nDeployment Example.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21  apiVersion:apps/v1kind:Deploymentmetadata:name:nginx-deploymentlabels:app:nginxspec:replicas:3selector:matchLabels:app:nginxtemplate:metadata:labels:app:nginxspec:containers:- name:nginximage:nginx:1.7.9ports:- containerPort:80  List all Deployments:\n1  $ kubectl get deployment   StatefulSet A controller tthat aims to manage Pods that must persist or maintain state. Pod identity including hostname, network, and storage will be persisted.\nStatefulSet Example.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34  apiVersion:apps/v1kind:StatefulSetmetadata:name:webspec:selector:matchLabels:app:nginxserviceName:\"nginx\"replicas:3template:metadata:labels:app:nginxspec:terminationGracePeriodSeconds:10containers:- name:nginximage:k8s.gcr.io/nginx-slim:0.8ports:- containerPort:80name:webvolumeMounts:- name:wwwmountPath:/usr/share/nginx/htmlvolumeClaimTemplates:- metadata:name:wwwspec:accessModes:[\"ReadWriteOnce\"]storageClassName:\"my-storage-class\"resources:requests:storage:1Gi  List all StatefulSets:\n1  $ kubectl get statefulset   DaemonSet Ensures that an instance of a specific pod is running on all (or a selection of) nodes in a cluster.\nDaemonSet Example.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  apiVersion:apps/v1kind:DaemonSetmetadata:name:fluentd-elasticsearchnamespace:kube-systemlabels:k8s-app:fluentd-loggingspec:selector:matchLabels:name:fluentd-elasticsearchtemplate:metadata:labels:name:fluentd-elasticsearchspec:tolerations:- key:node-role.kubernetes.io/mastereffect:NoSchedulecontainers:- name:fluentd-elasticsearchimage:gcr.io/google-containers/fluentd-elasticsearch:1.20terminationGracePeriodSeconds:30  List all DaemonSets:\n1  $ kubectl get daemonset # or `kubectl get ds`   Service Define a single IP/port combination that provides access to a pool of pods. It uses label selectors to map groups of pods and ports to a cluster-unique virtual IP.\nService Example.\n1 2 3 4 5 6 7 8 9 10 11 12  apiVersion:v1kind:Servicemetadata:name:my-nginxlabels:run:my-nginxspec:ports:- port:80protocol:TCPselector:run:my-nginx  List all Services:\n1  $ kubectl get service # or `kubectl get svc`   Ingress An ingress controller is the primary method of exposing a cluster service (usually http) to the outside world. These are load balancers or routers that usually offer SSL termination, name-based virtual hosting etc‚Ä¶‚Äã\nIngress Example.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  apiVersion:extensions/v1beta1kind:Ingressmetadata:name:test-ingressannotations:nginx.ingress.kubernetes.io/rewrite-target:/spec:rules:- http:paths:- path:/testpathbackend:serviceName:testservicePort:80  List all Ingress:\n1  $ kubectl get ingress   Volume Storage that is tied to the Pod Lifecycle, consumable by one or more containers within the pod.\nPersistentVolume A PersistentVolume (PV) represents a storage resource. PVs are commonly linked to a backing storage resource, NFS, GCEPersistentDisk, RBD etc. and are provisioned ahead of time. Their lifecycle is handled independently from a pod.\nList all PersistentVolumes:\n1  $ kubectl get persistentvolume` or `kubectl get pv`   PersistentVolumeClaim A PersistentVolumeClaim (PVC) is a request for storage that satisfies a set of requirements. Commonly used with dynamically provisioned storage.\nList all PersistentVolumeClaims:\n1  $ kubectl get persistentvolumeclaim` or `kubectl get pvc`   StorageClass Storage classes are an abstraction on top of an external storage resource. These will include a provisioner, provisioner configuration parameters as well as a PV reclaimPolicy.\nList all StorageClasses:\n1  $ kubectl get storageclass` or `kubectl get sc`   Job The job controller ensures one or more pods are executed and successfully terminates. It will do this until it satisfies the completion and/or parallelism condition.\nList all Jobs:\n1  $ kubectl get job`   CronJob An extension of the Job Controller, it provides a method of executing jobs on a cron-like schedule.\nList all CronJobs:\n1  $ kubectl get cronjob`   ConfigMap Externalized data stored within Kubernetes that can be referenced as a commandline argument, environment variable or injected as a file into a volume mount. Ideal for implementing the External Configuration Store pattern.\nList all ConfigMaps:\n1  $ kubectl get configmap` or `kubectl get cm`   Secret Functionally identical to ConfigMaps, but stored encoded as base64, and encrypted at rest (if configured).\nList all Secrets:\n1  $ kubectl get secret`   2. Run Kubernetes locally For our tutorial we will not build a real Kubernetes Cluster. We will use Minikube.\nMinikube is a tool that makes it easy to run Kubernetes locally. Minikube runs a single-node Kubernetes cluster inside a VM on your laptop for users looking to try out Kubernetes or develop with it day-to-day.\nFor Minikube installation : https://github.com/kubernetes/minikube\nAfter the installation, to start Minikube:\n1  $ minikube start   The minikube start command creates a kubectl context called minikube. This context contains the configuration to communicate with your minikube cluster.\nMinikube sets this context to default automatically, but if you need to switch back to it in the future, run:\nkubectl config use-context minikube\nTo access the Kubernetes Dashboard:\n1  $ minikube dashboard   The Dashboard will be opened in your default browser:\n The minikube stop command can be used to stop your cluster. This command shuts down the minikube virtual machine, but preserves all cluster state and data. Starting the cluster again will restore it to it‚Äôs previous state.\nThe minikube delete command can be used to delete your cluster. This command shuts down and deletes the minikube virtual machine. No data or state is preserved.\n3. Refactoring the application Now we want to move from H2 Databse to PostgreSQL. So we have to configure the application to use it by mentioning some properties like JDBC driver, url, username, password‚Ä¶‚Äã in the application.properties file and to add the PostgreSQL JDBC Driver in the pom.xml.\nFirst of all, we start by adding this dependency to our pom.xml:\n1 2 3 4 5   org.postgresql postgresql runtime    Next, we do some modifications to the application.properties:\n1 2 3 4 5  spring.datasource.driver-class-name=org.postgresql.Driver spring.jpa.hibernate.ddl-auto=create spring.datasource.url=jdbc:postgresql://${POSTGRES_SERVICE}:5432/${POSTGRES_DB_NAME} spring.datasource.username=${POSTGRES_DB_USER} spring.datasource.password=${POSTGRES_DB_PASSWORD}   We have used environment properties placeholders:\n POSTGRES_SERVICE : Host of PostgreSQL DB Server POSTGRES_DB_NAME : PostgreSQL DB Name POSTGRES_DB_USER : PostgreSQL Username POSTGRES_DB_PASSWORD : PostgreSQL Password  We will extract these values from a Kubernetes ConfigMap and Secret objects.\nCreate the ConfigMap We need to create the ConfigMap:\n1 2 3  $ kubectl create configmap postgres-config \\ \t--from-literal=postgres.service.name=postgresql \\ \t--from-literal=postgres.db.name=boutique   We can check the created ConfigMap:\n1  $ kubectl get cm postgres-config -o json   The output will look like this:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  { \"apiVersion\": \"v1\", \"data\": { \"postgres.db.name\": \"boutique\", \"postgres.service.name\": \"postgresql\" }, \"kind\": \"ConfigMap\", \"metadata\": { \"creationTimestamp\": \"2018-03-25T16:42:39Z\", \"name\": \"postgres-config\", \"namespace\": \"default\", \"resourceVersion\": \"195\", \"selfLink\": \"/api/v1/namespaces/default/configmaps/postgres-config\", \"uid\": \"87d7481c-304b-11e8-889d-080027a8a37c\" } }   Create the Secret Next we create the Secret:\n1 2 3  $ kubectl create secret generic db-security \\ \t--from-literal=db.user.name=nebrass \\ \t--from-literal=db.user.password=password   We can check the created Secret:\n1  $ kubectl get secret db-security -o json   The output will look like this:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  { \"apiVersion\": \"v1\", \"data\": { \"db.user.name\": \"bmVicmFzcw==\", \"db.user.password\": \"cGFzc3dvcmQ=\" }, \"kind\": \"Secret\", \"metadata\": { \"creationTimestamp\": \"2018-03-25T16:56:36Z\", \"name\": \"db-security\", \"namespace\": \"default\", \"resourceVersion\": \"714\", \"selfLink\": \"/api/v1/namespaces/default/secrets/db-security\", \"uid\": \"7ac96df3-304d-11e8-889d-080027a8a37c\" }, \"type\": \"Opaque\" }    The credentials are encoded as base64. This is to protect the secret from being exposed accidentally to someone looking or from being stored in a terminal log. From kubernetes‚Äôs point of view the contents of this Secret is unstructured: it can contain arbitrary key-value pairs.  Deploy PostgreSQL to Kubernetes As the configuration is centralized and stored in the Kubernetes Cluster, we can share them between the Spring Boot Application and the PostgreSQL Service that we will create now.\nI already prepared the PostgreSQL resource file, in the src/main/assets/. This YAML file contains a Deployment and a Service resources.\nWe loaded the properties from our ConfigMap and Secret.\nThe content of postgres.yml:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50  apiVersion:extensions/v1beta1kind:Deploymentmetadata:name:postgresqlnamespace:defaultspec:replicas:1template:metadata:labels:app:postgresqlspec:volumes:- name:dataemptyDir:{}containers:- name:postgresimage:postgres:9.6.5env:- name:POSTGRES_USERvalueFrom:secretKeyRef:name:db-securitykey:db.user.name- name:POSTGRES_PASSWORDvalueFrom:secretKeyRef:name:db-securitykey:db.user.password- name:POSTGRES_DBvalueFrom:configMapKeyRef:name:postgres-configkey:postgres.db.nameports:- containerPort:5432volumeMounts:- name:datamountPath:/var/lib/postgresql/---apiVersion:v1kind:Servicemetadata:name:postgresqlnamespace:defaultspec:selector:app:postgresqlports:- port:5432   We will use the postgres:9.6.5 image The env block is used to load data in the container environment. Create an environment variable with a value loaded from a key called db.user.name in the secret called db-security. Create an environment variable with a value loaded from a key called db.user.password in the secret called db-security. Create an environment variable with a value loaded from a key called postgres.db.name in the configMap called postgres-config.  To apply this resource file to Kubernetes, we can do:\n1  $ kubectl create -f src/main/assets/postgres.yml   The output will be:\n1 2  deployment \"postgresql\" created service \"postgresql\" created   We can check the created Deployment:\n1  $ kubectl get deployment postgresql -o json   The output will look like this:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39  { \"apiVersion\": \"extensions/v1beta1\", \"kind\": \"Deployment\", \"metadata\": { \"annotations\": { \"deployment.kubernetes.io/revision\": \"1\" }, \"creationTimestamp\": \"2018-03-25T17:04:03Z\", \"generation\": 1, \"labels\": { \"app\": \"postgresql\" }, \"name\": \"postgresql\", \"namespace\": \"default\", \"resourceVersion\": \"1025\", \"selfLink\": \"/apis/extensions/v1beta1/namespaces/default/deployments/postgresql\", \"uid\": \"84fa2f1a-304e-11e8-889d-080027a8a37c\" }, \"spec\": { ... }, \"status\": { \"availableReplicas\": 1, \"conditions\": [ { \"lastTransitionTime\": \"2018-03-25T17:04:03Z\", \"lastUpdateTime\": \"2018-03-25T17:04:03Z\", \"message\": \"Deployment has minimum availability.\", \"reason\": \"MinimumReplicasAvailable\", \"status\": \"True\", \"type\": \"Available\" } ], \"observedGeneration\": 1, \"readyReplicas\": 1, \"replicas\": 1, \"updatedReplicas\": 1 } }   We can check the created Service:\n1  $ kubectl get service postgresql -o json   The output will look like this:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39  { \"apiVersion\": \"extensions/v1beta1\", \"kind\": \"Deployment\", \"metadata\": { \"annotations\": { \"deployment.kubernetes.io/revision\": \"1\" }, \"creationTimestamp\": \"2018-03-25T17:04:03Z\", \"generation\": 1, \"labels\": { \"app\": \"postgresql\" }, \"name\": \"postgresql\", \"namespace\": \"default\", \"resourceVersion\": \"1025\", \"selfLink\": \"/apis/extensions/v1beta1/namespaces/default/deployments/postgresql\", \"uid\": \"84fa2f1a-304e-11e8-889d-080027a8a37c\" }, \"spec\": { ... }, \"status\": { \"availableReplicas\": 1, \"conditions\": [ { \"lastTransitionTime\": \"2018-03-25T17:04:03Z\", \"lastUpdateTime\": \"2018-03-25T17:04:03Z\", \"message\": \"Deployment has minimum availability.\", \"reason\": \"MinimumReplicasAvailable\", \"status\": \"True\", \"type\": \"Available\" } ], \"observedGeneration\": 1, \"readyReplicas\": 1, \"replicas\": 1, \"updatedReplicas\": 1 } }   In this output, there is something interesting: the port and the target port:\n The port this service will be available on The container port the service will forward to  We already mentionned the port in the spring.datasource.url property.\n- What do you think if we use the powerful features of Kubernetes to resolve this port dynamically?\n- Ok but how? :)\nAfter creating these resources, the effective properties will like this :\n1 2 3 4 5  spring.datasource.driver-class-name=org.postgresql.Driver spring.jpa.hibernate.ddl-auto=create spring.datasource.url=jdbc:postgresql://postgresql:5432/boutique spring.datasource.username=nebrass spring.datasource.password=password   The Datasource URL is pointing to a host called postgresql. The resolution of the hostname to IP is done by Kubernetes.\nIf we check the postgresql service:\n1 2 3 4  $ kubectl get svc postgresql NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE postgresql ClusterIP 10.111.244.143  5432/TCP 1h   There is an other cool feature in Kubernetes, we can fetch data related to the service itself. We can for example get the port associated to this service.\nFor example:\n ${postgresql.service.host} will be resolved to 10.111.244.143. ${postgresql.service.port} will be resolved to 5432.  We can do it better ^^) we can merge the environment variables in the great holders that will be resolved by Kubernetes. They will become:\n ${postgresql.service.host} can be written ${${POSTGRES_SERVICE}.service.host} ${postgresql.service.port} can be written ${${POSTGRES_SERVICE}.service.port}  In this way, the internal placeholder will be resolved by the environment variable provided by the ConfigMap, and the external placeholder will be resolved by Kubernetes.\nThe resulting application.properties will look like:\n1 2 3 4 5  spring.datasource.driver-class-name=org.postgresql.Driver spring.jpa.hibernate.ddl-auto=create spring.datasource.url=jdbc:postgresql://${${POSTGRES_SERVICE}.service.host}:${${POSTGRES_SERVICE}.service.port}/${POSTGRES_DB_NAME} spring.datasource.username=${POSTGRES_DB_USER} spring.datasource.password=${POSTGRES_DB_PASSWORD}   Now, we are ConfigMaps addicts :) we will host our application.properties in a ConfigMap in Kubernetes. To do it, just do:\n1 2  $ kubectl create configmap app-config \\ \t--from-file=src/main/resources/application.properties   Now that the application.properties, how can our Spring Boot application use them?\nThe answer is so easy: the Spring Cloud Kubernetes plugin.\nWhat is Spring Cloud Kubernetes The Spring Cloud Kubernetes plug-in implements the integration between Kubernetes and Spring Boot. It provides access to the configuration data of a ConfigMap using the Kubernetes API.\nIt make so easy to integrate Kubernetes ConfigMap directly with the Spring Boot externalized configuration mechanism, so that Kubernetes ConfigMaps behave as an alternative property source for Spring Boot configuration.\nTo enable the great features of the plugin:\n  Add the Maven Dependency:Add this dependency to the pom.xml:\n1 2 3 4 5   io.fabric8 spring-cloud-starter-kubernetes 0.1.6      Create the Bootstrap file:Create a new file bootstrap.properties under src/main/resources:\n1 2  spring.application.name=${project.artifactId} spring.cloud.kubernetes.config.name=app-config    The ${project.artifactId} will be parsed and populated by maven-resources-plugin, that you will find in the pom.xml of the sample project hosted in the Github repository of this tutorial. The name of the ConfigMap where we stored our great application.properties.    That‚Äôs it! The Spring Cloud Kubernetes is correctly integrated to our application. When we deploy our application to Kubernetes, it will use the application.properties stored in the ConfigMap app-config.\nYou say deploy? Ok but how to do it?\nDeploy it to Kubernetes The deployment?! A dedicated full story, that can have many chapters. But we will try to keep it short and simple.\nBy definition, Kubernetes is a container orchestration solution. So deploying an application to Kubernetes means :\n Containerizing the application: creating an image embedding the application. Preparing the deployment resources (Deployment, ReplicaSet, etc‚Ä¶‚Äã). Deploying the container to Kubernetes.  These steps can take some time to be done, even if we try to automate this process, it will take us long time to implement it, and it will take more time to cover all the cases and variants of the apps.\nAs these tasks are so heavy, we need some tool that do all of this for easy.\nHere comes the super powerfull tool: Fabric8-Maven-Plugin.\n Fabric8-Maven-Plugin is a one-stop-shop for building and deploying Java applications for Docker, Kubernetes and OpenShift. It brings your Java applications on to Kubernetes and OpenShift. It provides a tight integration into maven and benefits from the build configuration already provided. It focuses on three tasks:\n Building Docker images Creating OpenShift and Kubernetes resources Deploy application on Kubernetes and OpenShift  The plugin will do all the heavy tasks ! Yes ! He will ! :)\nIt can be configured very flexibly and supports multiple configuration models for creating:\n Zero Configuration for a quick ramp-up where opinionated defaults will be pre-selected. Inline Configuration within the plugin configuration in an XML syntax. External Configuration templates of the real deployment descriptors which are enriched by the plugin. Docker Compose Configuration provide Docker Compose file and bring up docker compose deployments on a Kubernetes/OpenShift cluster.  To enable fabric8-maven-plugin on your project just add this to the plugins sections of your pom.xml:\n1 2 3 4 5   io.fabric8 fabric8-maven-plugin 3.5.38    Now in order to use fabric8-maven-plugin to build or deploy, make sure you have a Kubernetes cluster up and running.\nThe fabric8-maven-plugin supports a rich set of goals for providing a smooth Java developer experience. You can categorize these goals as follows:\n Build goals are used to create and manage the Kubernetes build artifacts like Docker images.  fabric8:build : Build Docker images fabric8:resource : Create Kubernetes resource descriptors fabric8:push : Push Docker images to a registry fabric8:apply : Apply resources to a running cluster   Development goals are used in deploying resource descriptors to the development cluster.  fabric8:run : Run a complete development workflow cycle fabric8:resource ‚Üí fabric8:build ‚Üí fabric8:apply in the foreground. fabric8:deploy : Deploy resources descriptors to a cluster after creating them and building the app. Same as fabric8:run except that it runs in the background. fabric8:undeploy : Undeploy and remove resources descriptors from a cluster. fabric8:watch : Watch for doing rebuilds and restarts    If you want to integrate the goals in the maven lifecycle phases, you can do it easily:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16   io.fabric8 fabric8-maven-plugin 3.5.38    fmp  resource build        ‚ÑπÔ∏è Note\nFor lazyness purposes :p I will be referencing the fabric8-maven-plugin as f8mp.\n  ‚ö†Ô∏è Warning\nThe f8mp needs to access to the Docker environment of Minikube, to do this just start the command¬†eval $(minikube docker-env) . Without this command, Kubernetes will not find the Docker images built by f8mp.\n Now when we do mvn clean install for example, the plugin will build the docker images and will generate the Kubernetes resource descriptors in the ${basedir}/target/classes/META-INF/fabric8/kubernetes directory.\nLet‚Äôs check the generated resource descriptors.\n ‚ö†Ô∏è Warning\nWait ! Wait! We said that we will pass the ConfigMaps to the Spring Boot application. Where is that?!\n Yep! Before generating our resources descriptors, we have to tell this to f8mp.\nf8mp has an easy way to do this: the plugin can handle some Resource Fragments. It‚Äôs a piece of YAML code located in the src/main/fabric8 directory. Each resource get is own file, which contains some skeleton of a resource description. The plugin will pick up the resource, enriches it and then combines all the data. Within these descriptor files you are can freely use any Kubernetes feature.\nIn our case, we will deliver in the Resource Fragment the configuration of the environment variables to the Pod, where our Spring Boot Application will be executed. We will use a fragment of a Deployment, which will look like this:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31  apiVersion:extensions/v1beta1kind:Deploymentmetadata:name:${project.artifactId}namespace:defaultspec:template:spec:containers:- name:${project.artifactId}env:- name:POSTGRES_SERVICEvalueFrom:configMapKeyRef:name:postgres-configkey:postgres.service.name- name:POSTGRES_DB_NAMEvalueFrom:configMapKeyRef:name:postgres-configkey:postgres.db.name- name:POSTGRES_DB_USERvalueFrom:secretKeyRef:name:db-securitykey:db.user.name- name:POSTGRES_DB_PASSWORDvalueFrom:secretKeyRef:name:db-securitykey:db.user.password   The name of our Deployment and the container. The environment variables that we are creating and populating from the ConfigMap and Secret.  Now, when the f8mp will try to generate the resources descriptors, it will find this resource fragment, combine it with the other data. The resulting output will be coherent with the fregment that we already provided.\nLet‚Äôs try it. Just run mvn clean install:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46  [INFO] Scanning for projects... [INFO] [INFO] ------------------------------------------------------------------------ [INFO] Building MySchool 0.0.1-SNAPSHOT [INFO] ------------------------------------------------------------------------ [INFO] ... [INFO] [INFO] --- fabric8-maven-plugin:3.5.38:resource (fmp) @ myschool - [INFO] F8: Running in Kubernetes mode [INFO] F8: Running generator spring-boot [INFO] F8: spring-boot: Using Docker image fabric8/java-jboss-openjdk8-jdk:1.3 as base / builder [INFO] F8: using resource templates from /Users/n.lamouchi/MySchool/src/main/fabric8 [INFO] F8: fmp-service: Adding a default service 'myschool' with ports [8080] [INFO] F8: spring-boot-health-check: Adding readiness probe on port 8080, path='/health', scheme='HTTP', with initial delay 10 seconds [INFO] F8: spring-boot-health-check: Adding liveness probe on port 8080, path='/health', scheme='HTTP', with initial delay 180 seconds [INFO] F8: fmp-revision-history: Adding revision history limit to 2 [INFO] F8: f8-icon: Adding icon for deployment [INFO] F8: f8-icon: Adding icon for service [INFO] F8: validating /Users/n.lamouchi/MySchool/target/classes/META-INF/fabric8/openshift/myschool-svc.yml resource [INFO] F8: validating /Users/n.lamouchi/MySchool/target/classes/META-INF/fabric8/openshift/myschool-deploymentconfig.yml resource [INFO] F8: validating /Users/n.lamouchi/MySchool/target/classes/META-INF/fabric8/openshift/myschool-route.yml resource [INFO] F8: validating /Users/n.lamouchi/MySchool/target/classes/META-INF/fabric8/kubernetes/myschool-deployment.yml resource [INFO] F8: validating /Users/n.lamouchi/MySchool/target/classes/META-INF/fabric8/kubernetes/myschool-svc.yml resource [INFO] ... [INFO] [INFO] --- fabric8-maven-plugin:3.5.38:build (fmp) @ myschool - [INFO] F8: Building Docker image in Kubernetes mode [INFO] F8: Running generator spring-boot [INFO] F8: spring-boot: Using Docker image fabric8/java-jboss-openjdk8-jdk:1.3 as base / builder [INFO] Copying files to /Users/n.lamouchi/MySchool/target/docker/nebrass/myschool/snapshot-180327-174802-0575/build/maven [INFO] Building tar: /Users/n.lamouchi/MySchool/target/docker/nebrass/myschool/snapshot-180327-174802-0575/tmp/docker-build.tar [INFO] F8: [nebrass/myschool:snapshot-180327-174802-0575] \"spring-boot\": Created docker-build.tar in 283 milliseconds [INFO] F8: [nebrass/myschool:snapshot-180327-174802-0575] \"spring-boot\": Built image sha256:61171 [INFO] F8: [nebrass/myschool:snapshot-180327-174802-0575] \"spring-boot\": Tag with latest [INFO] ... [INFO] [INFO] ------------------------------------------------------------------------ [INFO] BUILD SUCCESS [INFO] ------------------------------------------------------------------------ [INFO] Total time: 30.505 s [INFO] Finished at: 2018-03-27T17:48:29+02:00 [INFO] Final Memory: 70M/721M [INFO] ------------------------------------------------------------------------    Generating the resources descriptors based on the detected configuration: Spring Boot application that is using the port 8080 with existing Actuator endpoints. Building the Docker image in Kubernetes mode (locally and not like the Openshift mode, which uses the Openshift S2I Mechanism for the build).  After building our project, we got these files in the ${basedir}/target/classes/META-INF/fabric8/kubernetes directory:\n my-school-deployment.yml my-school-svc.yml  Let‚Äôs check the Deployment:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89  apiVersion:extensions/v1beta1kind:Deploymentmetadata:annotations:fabric8.io/git-commit:0120b762d7e26994e8b01d7e85f8941e5d095130fabric8.io/git-branch:masterfabric8.io/scm-tag:HEAD...labels:app:myschoolprovider:fabric8version:0.0.1-SNAPSHOTgroup:com.onepoint.labsname:myschoolnamespace:defaultspec:replicas:1revisionHistoryLimit:2selector:matchLabels:app:myschoolprovider:fabric8group:com.onepoint.labstemplate:metadata:annotations:fabric8.io/git-commit:0120b762d7e26994e8b01d7e85f8941e5d095130fabric8.io/git-branch:masterfabric8.io/scm-tag:HEAD...labels:app:myschoolprovider:fabric8version:0.0.1-SNAPSHOTgroup:com.onepoint.labsspec:containers:- env:- name:POSTGRES_SERVICEvalueFrom:configMapKeyRef:key:postgres.service.namename:postgres-config- name:POSTGRES_DB_NAMEvalueFrom:configMapKeyRef:key:postgres.db.namename:postgres-config- name:POSTGRES_DB_USERvalueFrom:secretKeyRef:key:db.user.namename:db-security- name:POSTGRES_DB_PASSWORDvalueFrom:secretKeyRef:key:db.user.passwordname:db-security- name:KUBERNETES_NAMESPACEvalueFrom:fieldRef:fieldPath:metadata.namespaceimage:nebrass/myschool:snapshot-180327-003059-0437imagePullPolicy:IfNotPresentlivenessProbe:httpGet:path:/healthport:8080scheme:HTTPinitialDelaySeconds:180name:myschoolports:- containerPort:8080name:httpprotocol:TCP- containerPort:9779name:prometheusprotocol:TCP- containerPort:8778name:jolokiaprotocol:TCPreadinessProbe:httpGet:path:/healthport:8080scheme:HTTPinitialDelaySeconds:10securityContext:privileged:false   Generated annotations that holds many usefull data, like the git-commit id or the git-branch Labels section holds the Maven Project groupId, artifactId and version information. Add to that, a label provider=fabric8 to tell you that this data is generated by f8mp The Docker Image, generated and built by f8mp. The suffix snapshot-180327-003059-0437 is the default format to assign a version tag. A liveness probe checks if the container in which it is configured is still up. A readiness probe determines if a container is ready to service requests.   üí° Tip\nThe liveness and readiness probes are generated because the f8mp has detected that the Spring-Boot-Actuator library in the classpath.\n At this point, we can deploy our application just using the command mvn fabric8:apply, the output will look like:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  [INFO] --- fabric8-maven-plugin:3.5.38:apply (default-cli) @ myschool --- [INFO] F8: Using Kubernetes at https://192.168.99.100:8443/ in namespace default with manifest /Users/n.lamouchi/Downloads/MyBoutiqueReactive/target/classes/META-INF/fabric8/kubernetes.yml [INFO] Using namespace: default [INFO] Updating a Service from kubernetes.yml [INFO] Updated Service: target/fabric8/applyJson/default/service-myschool.json [INFO] Using namespace: default [INFO] Creating a Deployment from kubernetes.yml namespace default name myschool [INFO] Created Deployment: target/fabric8/applyJson/default/deployment-myschool.json [INFO] F8: HINT: Use the command `kubectl get pods -w` to watch your pods start up [INFO] ------------------------------------------------------------------------ [INFO] BUILD SUCCESS [INFO] ------------------------------------------------------------------------ [INFO] Total time: 16.003 s [INFO] Finished at: 2018-03-28T00:03:56+02:00 [INFO] Final Memory: 78M/756M [INFO] ------------------------------------------------------------------------   We can check all the resources that exists on our cluster\n1  $ kubectl get all   This command will list all the resources in the default namespace. The output will be something:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  NAME DESIRED CURRENT UP-TO-DATE AVAILABLE AGE deploy/myschool 1 1 1 1 6m deploy/postgresql 1 1 1 1 7m NAME DESIRED CURRENT READY AGE rs/myschool-5dd7cbff98 1 1 1 6m rs/postgresql-5f57747985 1 1 1 7m NAME READY STATUS RESTARTS AGE po/myschool-5dd7cbff98-w2wtl 1/1 Running 0 6m po/postgresql-5f57747985-8n9h6 1/1 Running 0 7m NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE svc/kubernetes ClusterIP 10.96.0.1  443/TCP 23m svc/myschool ClusterIP 10.106.72.231  8080/TCP 20m svc/postgresql ClusterIP 10.111.62.173  5432/TCP 21m    üí° Tip\nWe can list all these resources on the K8s Dashboard.\n Wow! Yes, these resources have been created during the steps that we did before :) Good job !\n5. It works ! Hakuna Matata ! It‚Äôs done ^^) we deployed the application and all its required resources; but how can we access the deployed application?\nThe application will be accessible thru the Kubernetes Service object called myschool.\nLet‚Äôs check what is the service myschool, type kubectl get svc myschool, the output will be:\n1 2  NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE myschool ClusterIP 10.106.72.231  8080/TCP 1d   The type of our service is ClusterIP. What is a ClusterIP ?\nClusterIP is the default ServiceType. It exposes the service on a cluster-internal IP so it will be only reachable from within the cluster.\nSo we cannot use this ServiceType because we need our service to be reachable from outisde the cluster. So is there any other type of service?\nYes! There are three other types of services, other than ClusterIP:\n NodePort: Exposes the service on each Node‚Äôs IP at a static port (the NodePort). A ClusterIP service, to which the NodePort service will route, is automatically created. You‚Äôll be able to contact the NodePort service, from outside the cluster, by requesting :. LoadBalancer: Exposes the service externally using a cloud provider‚Äôs load balancer. NodePort and ClusterIP services, to which the external load balancer will route, are automatically created. ExternalName: Maps the service to the contents of the externalName field (e.g. foo.bar.example.com), by returning a CNAME record with its value.   üí° Tip\nIn our case, we will be using the LoadBalancer service, which redirects traffic across all the nodes. Clients connect to the LoadBalancer service through the load balancer‚Äôs IP.\n Ok :) The LoadBalancer will be our ServiceType. But how can we tell this to the f8mp ?\nWe have two solutions:\n The Resource Fragments as we did before. The Inline Configuration, which is XML based configuration of the f8mp plugin.  Let‚Äôs use this time the Inline Configuration to tell the f8mp that we want a LoadBalancer service:\nIn the configuration section of the f8mp plugin, we will declare an enricher.\nAn enricher is a component used to create and customize Kubernetes and Openshift resource objects. f8mp comes with a set of enrichers which are enabled by default. One of these enrichers, is the fmp-service which is used to customize the Services.\nThe f8mp with the configured enricher will look like:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23   io.fabric8 fabric8-maven-plugin 3.5.38     LoadBalancer       fmp  resource build       Let‚Äôs build and a redeploy our project using mvn clean install fabric8:apply and see what is the type of the deployed service using kubectl get svc myschool:\n1 2  NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE myschool LoadBalancer 10.106.72.231  8080:31246/TCP 2d    ‚ö†Ô∏è Warning\nThe  shown in the EXTERNAL-IP column is due that we are using minikube.\n Cool ! How can we access the application now? How can we get the URL of the deployed application?\nEuuuuh! The answer is shorter than the question :D to get the URL of the deployed app on minikube just type:\n1  $ open $(minikube service myschool --url)   This command will open the URL of the Spring Boot Application in your default browser :)\n  üí° Tip\nThe command minikube service myschool --url will give us the path of the service myschool, which is pointing on our Spring Boot Application.\n How can I access the Swagger UI of my deployed App?\n1  $ open $(minikube service myschool --url)/swagger-ui.html   This command will open the URL of the Spring Boot Application in your default browser :)\n The full source code of this tutorial, can be found here.\nIV. Conclusion \u0026 final words: The main goal of this tutorial is to introduce you to the Kubernetes ecosystem and to let you start playing with Kubernetes.\nPutting your hands on practical exercices on Kubernetes will let you master this great platform. You will be able to feel the performance of Kubernetes when you experience many use cases.\nYou can consider the small application that we developed as a small microservice. You can develop other small apps and make interaction with them to start playing with the microservices architecture.\nWhat other areas around Java Microservices, Docker and Kubernetes would you like to know? Let me know at my mail. I plan on making additional tutorials on these topics. I will be happy to pick topics based on your feedback!\n","wordCount":"6771","inLanguage":"en","image":"https://blog.nebrass.fr/images/PlayingWithSpringBootOnK8S.webp","datePublished":"2018-03-31T00:00:00Z","dateModified":"2018-03-31T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.nebrass.fr/playing-with-spring-boot-on-kubernetes/"},"publisher":{"@type":"Organization","name":"Nebrass Homepage","logo":{"@type":"ImageObject","url":"https://blog.nebrass.fr/favicon.ico"}}}</script></head><body id=top><script>window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.nebrass.fr accesskey=h title="Nebrass Homepage (Alt + H)">Nebrass Homepage</a>
<span class=logo-switches></span></div><ul id=menu><li><a href=https://blog.nebrass.fr/ title=Posts><span>Posts</span></a></li><li><a href=https://blog.nebrass.fr/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://blog.nebrass.fr/categories/ title=Categories><span>Categories</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Playing with Spring Boot on Kubernetes</h1><div class=post-meta><span title="2018-03-31 00:00:00 +0000 UTC">March 31, 2018</span>&nbsp;¬∑&nbsp;32 min</div></header><figure class=entry-cover><img loading=lazy src=https://blog.nebrass.fr/images/PlayingWithSpringBootOnK8S.webp alt></figure><div class=post-content><h2 id=i-introduction>I. Introduction<a hidden class=anchor aria-hidden=true href=#i-introduction>#</a></h2><p>In this tutorial I will show you how to write a small <strong>Spring Boot CRUD application</strong> and how to deploy it on <strong>Kubernetes</strong>.</p><p><strong>Spring Boot</strong> is an innovative project that aims to make it easy to create <strong>Spring</strong> applications by simplifying the configuration and deployment actions through its convention over configuration based setup.</p><p><strong>Kubernetes</strong> (commonly referred to as &ldquo;<strong>K8s</strong>&rdquo;) is an open-source system for automating deployment, scaling and management of containerized applications that was originally designed by <strong>Google</strong> and now maintained by the <strong>Cloud Native Computing Foundation</strong>. It aims to provide a &ldquo;platform for automating deployment, scaling, and operations of application containers across clusters of hosts&rdquo;. It works with a range of container tools, including <strong>Docker</strong>.</p><p><strong>Docker</strong> is an open source project that automates the deployment of applications inside software containers.</p><p>This tutorial is a getting started point to the <strong>Spring Boot & K8s Stack</strong>.</p><h2 id=ii-writing-the-application>II. Writing the application<a hidden class=anchor aria-hidden=true href=#ii-writing-the-application>#</a></h2><h3 id=1-creating-the-skull>1. Creating the skull<a hidden class=anchor aria-hidden=true href=#1-creating-the-skull>#</a></h3><p>Here we go ! We will start using the great features and options offered by the <strong>Spring Framework Teams</strong> at <strong>Pivotal Software, Inc</strong>.</p><p>To avoid the hard parts when creating new project and getting it started, the <strong>Spring Team</strong> has created the <strong>Spring Initializr</strong> Project.</p><p>The <strong>Spring Initializr</strong> is a useful project that can generate a basic <strong>Spring Boot</strong> project structure easily. You can choose either your project to be based on <strong>Maven</strong> or <strong>Gradle</strong>, to use <strong>Java</strong> or <strong>Kotlin</strong> or <strong>Groovy</strong>, and to choose which version of <strong>Spring Boot</strong> you want to pick.</p><p><strong>Spring Initializr</strong> can be used:</p><ul><li>Using a <strong>Web-based Interface</strong> <a href=https://start.spring.io>http://start.spring.io</a></li><li>Using <strong>Spring Tool Suite</strong> or other different IDEs like <strong>NetBeans</strong> & <strong>IntelliJ</strong></li><li>Using the <strong>Spring Boot CLI</strong></li></ul><p><strong>Spring Initializr</strong> gives you the ability to add the <strong>core dependencies</strong> that you need, like <strong>JDBC drivers</strong> or <strong>Spring Boot Starters</strong>.</p><blockquote><p>‚ö†Ô∏è <em><strong>Hey! What is Spring Boot Starters?</strong></em></p><p><strong>Spring Boot Starters</strong> are a set of convenient dependency descriptors that you can include in your application. You get a one-stop-shop for all the <strong>Spring</strong> and related technology that you need, without having to hunt through sample code and copy paste loads of dependency descriptors. For example, if you want to get started using <strong>Spring</strong> and <strong>JPA</strong> for database access, just include the <code>spring-boot-starter-data-jpa</code> dependency in your project,and you are good to go.</p><p>The starters contain a lot of the dependencies that you need to get a project up and running quickly and with a consistent, supported set of managed transitive dependencies.</p><p>‚ÑπÔ∏è <strong>Note</strong></p><p>You can learn more about Spring Boot Starters here: <a href=https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#using-boot-starter>https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#using-boot-starter</a></p></blockquote><p>For our case we will be using:</p><ul><li>Maven</li><li>Java 8</li><li>Spring Boot 1.5.x</li></ul><p>And for the <em>Dependencies</em> we will choose:</p><ul><li>JPA</li><li>H2</li><li>Rest Repositories</li><li>Actuator</li><li>Lombok</li></ul><div align=center><p><img loading=lazy src=../images/spring-initializr.webp alt="Spring Initializr - Bootstrapping MySchool"></p></div><p>The resulting pom will be like:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;project</span> <span class=na>xmlns=</span><span class=s>&#34;http://maven.apache.org/POM/4.0.0&#34;</span> <span class=na>xmlns:xsi=</span><span class=s>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>xsi:schemaLocation=</span><span class=s>&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;modelVersion&gt;</span>4.0.0<span class=nt>&lt;/modelVersion&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;groupId&gt;</span>com.onepoint.labs<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;artifactId&gt;</span>myschool<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;version&gt;</span>0.0.1-SNAPSHOT<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;packaging&gt;</span>jar<span class=nt>&lt;/packaging&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;name&gt;</span>MySchool<span class=nt>&lt;/name&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;description&gt;</span>Demo project for Spring Boot<span class=nt>&lt;/description&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;parent&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;groupId&gt;</span>org.springframework.boot<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;artifactId&gt;</span>spring-boot-starter-parent<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;version&gt;</span>1.5.10.RELEASE<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;relativePath/&gt;</span> <span class=c>&lt;!-- lookup parent from repository --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/parent&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;properties&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class=nt>&lt;/project.build.sourceEncoding&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;project.reporting.outputEncoding&gt;</span>UTF-8<span class=nt>&lt;/project.reporting.outputEncoding&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;java.version&gt;</span>1.8<span class=nt>&lt;/java.version&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/properties&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;dependencies&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>org.springframework.boot<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>org.springframework.boot<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>spring-boot-starter-data-jpa<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>org.springframework.boot<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>spring-boot-starter-data-rest<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>com.h2database<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>h2<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;scope&gt;</span>runtime<span class=nt>&lt;/scope&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>org.springframework.boot<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>spring-boot-starter-test<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;scope&gt;</span>test<span class=nt>&lt;/scope&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/dependencies&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;build&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;plugins&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;groupId&gt;</span>org.springframework.boot<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/plugin&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/plugins&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/build&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nt>&lt;/project&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>Now, we need to add the embedded databse configuration to the <strong>application.properties</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>spring.datasource.driver-class-name=org.h2.Driver
</span></span><span class=line><span class=cl>spring.jpa.hibernate.ddl-auto=create
</span></span><span class=line><span class=cl>spring.datasource.url=jdbc:h2:mem:boutique;DB_CLOSE_DELAY=-1
</span></span><span class=line><span class=cl>spring.datasource.username=sa
</span></span><span class=line><span class=cl>spring.datasource.password=
</span></span></code></pre></td></tr></table></div></div><p>Next, we will start the implementation of our Java components.</p><h3 id=2-presenting-the-domain>2. Presenting the domain<a hidden class=anchor aria-hidden=true href=#2-presenting-the-domain>#</a></h3><p>The domain of our application will just contain only one entity: <strong>Student</strong>.</p><div align=center><p><img loading=lazy src=../images/student-domain.webp alt="Domain: the Student Entity"></p></div><h3 id=3-implementing-the-domain>3. Implementing the domain<a hidden class=anchor aria-hidden=true href=#3-implementing-the-domain>#</a></h3><p>The <strong>Student</strong> entity will look like this:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Entity</span>
</span></span><span class=line><span class=cl><span class=nd>@Data</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Student</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Id</span>
</span></span><span class=line><span class=cl>    <span class=nd>@GeneratedValue</span><span class=o>(</span><span class=n>strategy</span> <span class=o>=</span> <span class=n>GenerationType</span><span class=o>.</span><span class=na>AUTO</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Long</span> <span class=n>id</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>name</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>family</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><code>@Data</code> generates all the boilerplate that is normally associated with simple POJOs (Plain Old Java Objects) and beans: getters for all fields, setters for all non-final fields, and appropriate toString, equals and hashCode implementations.</li></ul><p>Next, we will implement the <code>JPA Repository</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@RepositoryRestResource</span><span class=o>(</span><span class=n>collectionResourceRel</span> <span class=o>=</span> <span class=s>&#34;students&#34;</span><span class=o>,</span> <span class=n>path</span> <span class=o>=</span> <span class=s>&#34;students&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>StudentRepository</span> <span class=kd>extends</span> <span class=n>PagingAndSortingRepository</span><span class=o>&lt;</span><span class=n>Student</span><span class=o>,</span> <span class=n>Long</span><span class=o>&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>List</span><span class=o>&lt;</span><span class=n>Student</span><span class=o>&gt;</span> <span class=nf>findByName</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>List</span><span class=o>&lt;</span><span class=n>Student</span><span class=o>&gt;</span> <span class=nf>findByNameAndFamily</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>,</span> <span class=n>String</span> <span class=n>family</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>We are using this annotation to customize the <strong>REST endpoint</strong>.</li><li>We are extending the <code>PagingAndSortingRepository</code> Interface to get the paging & sorting features.</li><li>We are implementing custom <strong>JPA Repository</strong> methods using the special <strong>Spring Data Query DSL</strong>.</li></ul><h3 id=4-adding-the-swagger-2-capabilities>4. Adding the Swagger 2 Capabilities<a hidden class=anchor aria-hidden=true href=#4-adding-the-swagger-2-capabilities>#</a></h3><p><strong>Swagger 2</strong> is an open source project used to describe and document <strong>RESTful APIs</strong>. <strong>Swagger 2</strong> is language-agnostic and is extensible into new technologies and protocols beyond HTTP. The current version defines a set <strong>HTML, JavaScript and CSS assets</strong> to dynamically generate documentation from a <strong>Swagger-compliant API</strong>. These files are bundled by the <strong>Swagger UI</strong> project to display the API on browser. Besides rendering documentation, <strong>Swagger UI</strong> allows other API developers or consumers to interact with the API‚Äôs resources without having any of the implementation logic in place.</p><p>The <strong>Swagger 2 specification</strong>, which is known as <strong>OpenAPI specification</strong> has several implementations. We will be using the <strong>Springfox implementation</strong> in our project.</p><p>To enable the Swagger capabilities to our project, we will be:</p><ul><li>Adding the <strong>Maven Dependencies</strong></li><li>Adding the <strong>Java Configuration</strong></li></ul><p>The <strong>Maven Dependencies</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=c>&lt;!--DEPENDENCIES FOR SWAGGER DOCUMENTATION--&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;groupId&gt;</span>io.springfox<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;artifactId&gt;</span>springfox-data-rest<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;version&gt;</span>2.8.0<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;groupId&gt;</span>io.springfox<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;artifactId&gt;</span>springfox-swagger-ui<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;version&gt;</span>2.8.0<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;groupId&gt;</span>io.springfox<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;artifactId&gt;</span>springfox-swagger2<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;version&gt;</span>2.8.0<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>For the Java Configuration, we need to create a Spring <code>@Bean</code> that configure <strong>Swagger</strong> in the application context.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Configuration</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SwaggerConfig</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Bean</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Docket</span> <span class=nf>productApi</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>Docket</span><span class=o>(</span><span class=n>DocumentationType</span><span class=o>.</span><span class=na>SWAGGER_2</span><span class=o>).</span><span class=na>select</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>apis</span><span class=o>(</span><span class=n>RequestHandlerSelectors</span><span class=o>.</span><span class=na>any</span><span class=o>())</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>paths</span><span class=o>(</span><span class=n>PathSelectors</span><span class=o>.</span><span class=na>any</span><span class=o>())</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Also, we need to add the <strong>@EnableSwagger2</strong> annotation to the <strong>SpringBootApplication Main Class</strong>. We also have to add the <code>@Import({springfox.documentation.spring.data.rest.configuration.SpringDataRestConfiguration.class})</code> annotation, that enables the <strong>Springfox implementation</strong> to scan and parse the generated methods by <strong>Spring Data REST</strong>.</p><h3 id=5-run-it->5. Run it !<a hidden class=anchor aria-hidden=true href=#5-run-it->#</a></h3><p>To run the <strong>Spring Boot Application</strong>, you just run: <code>mvn spring-boot:run</code></p><p>The application will be running on the <code>8080</code> port. To access the application, just go to <a href=http://localhost:8080>http://localhost:8080</a>, you will see this:</p><div align=center><p><img loading=lazy src=../images/landing-page.webp alt="Landing Page: HATEOS json code listing REST services"></p></div><p>We will enjoy the game now: we will be using Swagger forms to insert some records.</p><p>To access the Swagger UI, just go to <a href=http://localhost:8080/swagger-ui.html#/>http://localhost:8080/swagger-ui.html#/</a></p><div align=center><p><img loading=lazy src=../images/swagger.webp alt="Swagger UI"></p></div><p>We will be using the <strong>Student Entity</strong> menu ‚Üí POST operation called <strong>saveStudent</strong> ‚Üí <strong>Try it out</strong> ‚Üí in the form just mention the <em>name</em> and the <em>family</em> data that you want to store. For example:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;family&#34;</span><span class=p>:</span> <span class=s2>&#34;Lamouchi&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Nebrass&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>The screen will be like this:</p><div align=center><p><img loading=lazy src=../images/save-student.webp alt="Swagger POST Form: New Student"></p></div><p>Just hit <strong>Execute</strong> and the <strong>Responde body</strong> will be somthing like this:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Nebrass&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;family&#34;</span><span class=p>:</span> <span class=s2>&#34;Lamouchi&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;_links&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;self&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;href&#34;</span><span class=p>:</span> <span class=s2>&#34;http://localhost:8080/students/1&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;student&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;href&#34;</span><span class=p>:</span> <span class=s2>&#34;http://localhost:8080/students/1&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>And the <strong>Response headers</strong> will look like this:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=err>content-type: application/hal+json;charset=UTF-8
</span></span></span><span class=line><span class=cl><span class=err>date: Sun, 04 Mar 2018 22:05:55 GMT
</span></span></span><span class=line><span class=cl><span class=err>location: http://localhost:8080/students/1
</span></span></span><span class=line><span class=cl><span class=err>transfer-encoding: chunked
</span></span></span><span class=line><span class=cl><span class=err>x-application-context: application:local
</span></span></span></code></pre></td></tr></table></div></div><p>We can use the <em>findAllStudents</em> menu of the <strong>Swagger UI</strong> to list all the students in the DB, to be sure that the record has been successfully created:</p><p>The <strong>Response body</strong> of the findAll operation will look like:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;_embedded&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;students&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Nebrass&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;family&#34;</span><span class=p>:</span> <span class=s2>&#34;Lamouchi&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;_links&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;self&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;href&#34;</span><span class=p>:</span> <span class=s2>&#34;http://localhost:8080/students/1&#34;</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;student&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;href&#34;</span><span class=p>:</span> <span class=s2>&#34;http://localhost:8080/students/1&#34;</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;_links&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;self&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;href&#34;</span><span class=p>:</span> <span class=s2>&#34;http://localhost:8080/students{?page,size,sort}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;templated&#34;</span><span class=p>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;profile&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;href&#34;</span><span class=p>:</span> <span class=s2>&#34;http://localhost:8080/profile/students&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;search&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;href&#34;</span><span class=p>:</span> <span class=s2>&#34;http://localhost:8080/students/search&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;page&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;size&#34;</span><span class=p>:</span> <span class=mi>20</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;totalElements&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;totalPages&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;number&#34;</span><span class=p>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>üí° <strong>Tip</strong></p><p>You can simply go to <a href=http://localhost:8080/students>http://localhost:8080/students</a> and you will get all the students persisted to the DB.</p></blockquote><h2 id=iii-moving-to-the-containers-era>III. Moving to the Containers Era<a hidden class=anchor aria-hidden=true href=#iii-moving-to-the-containers-era>#</a></h2><p>To deploy our (so huge, so big) application üòÇ, we will be using <strong>Docker</strong>. We will deploy our code in a container so we can enjoy the great feature provided by <strong>Docker</strong>.</p><p><strong>Docker</strong> has become the standard to develop and run containerized applications.</p><p>This is great ! Using <strong>Docker</strong> is quitely simple, especially in development stages. Deploying containers in the same server (<code>docker-machine</code>) is simple, but when start thinking to deploy many containers to many servers, things become complicated (managing the servers, managing the container state, etc.‚Äã).</p><p>Here come the orchestration system, which provides many features like orchestrating computing, networking and storage infrastructure on behalf of user workloads</p><ul><li><strong>Scheduling</strong>: matching containers to machines based on many factors like resources needs, affinity requirements‚Ä¶‚Äã</li><li><strong>Replications</strong></li><li><strong>Handling failures</strong></li><li><strong>Etc</strong>‚Ä¶‚Äã</li></ul><p>For our tutorial, we will choose <strong>Kubernetes</strong>, the star of container orchestration.</p><h3 id=1-what-is-kubernetes->1. What is Kubernetes ?<a hidden class=anchor aria-hidden=true href=#1-what-is-kubernetes->#</a></h3><p><strong>Kubernetes</strong> (Aka <strong>K8s</strong>) was a project spun out of Google as a open source next-gen container scheduler designed with the lessons learned from developing and managing Borg and Omega.</p><p><strong>Kubernetes</strong> is designed to have loosely coupled components centered around deploying, maintaining and scaling applications. <strong>K8s</strong> abstracts the underlying infrastructure of the nodes and provides a uniform layer for the deployed applications.</p><h4 id=11-kubernetes-architecture>1.1 Kubernetes Architecture<a hidden class=anchor aria-hidden=true href=#11-kubernetes-architecture>#</a></h4><p>In the big plan, a <strong>Kubernetes</strong> cluster is composed of two items:</p><ul><li><strong>Master Nodes</strong>: The main control plane for <strong>Kubernetes</strong>. It contains an <strong>API Server</strong>, a <strong>Scheduler</strong>, a <strong>Controller Manager</strong> (<em><strong>K8s cluster manager</strong></em>) and a datastore to save the cluster state called <strong>Etcd</strong>.</li><li><strong>Worker Nodes</strong>: A <strong>single host, physical or virual machine</strong>, capable of running <strong>POD</strong>. They are managed by the <strong>Master nodes</strong>.</li></ul><div align=center><p><img loading=lazy src=../images/k8s-architecture.webp alt="Kubernetes Architecture Overview"></p></div><p>Let‚Äôs have a look inside a <strong>Master node</strong>:</p><ul><li><strong>(Kube) API-Server</strong>: allows the communication, thru REST APIs, between the Master node and all its clients such as Worker Nodes, kube-cli, ‚Ä¶‚Äã</li><li><strong>(Kube) Scheduler</strong>: a policy-rich, topology-aware, workload-specific function that significantly impacts availability, performance, and capacity to assign a Node to a newly created <strong>POD</strong>.</li><li><strong>(Kube) Controller Manager</strong>: a daemon that embeds the core control loops shipped with Kubernetes. A control loop is a permenent listener that regulates the state of the system. In Kubernetes, a controller is a control loop that watches the shared state of the cluster through the API-Server and makes changes attempting to move the current state towards the desired state.</li><li><strong>Etcd</strong>: a strong, consistent and highly available key-value store used for persisting the cluster state.</li></ul><p>Then, what about a <strong>Worker node</strong>?</p><ul><li><strong>Kubelet</strong>: an agent that runs on each node in the cluster. It makes sure that containers are running in a <strong>POD</strong>.</li><li><strong>Kube-Proxy</strong>: enables the Kubernetes service abstraction by maintaining network rules on the host and perform networking actions.</li></ul><blockquote><p>üí° <strong>Tip</strong></p><p>The <strong>Container Runtime</strong> that we will user is <strong>Docker</strong>. Kubernetes is compatible with many others like <strong>Cri-o</strong>, <strong>Rkt</strong>, ‚Ä¶‚Äã</p></blockquote><h4 id=12-kubernetes-core-concepts>1.2 Kubernetes Core Concepts<a hidden class=anchor aria-hidden=true href=#12-kubernetes-core-concepts>#</a></h4><p>The <strong>K8s</strong> ecosystem covers many concepts and components. We will try to introduce them briefly.</p><h5 id=kubectl>Kubectl<a hidden class=anchor aria-hidden=true href=#kubectl>#</a></h5><p>The <code>kubectl</code> is a command line interface for running commands against Kubernetes clusters.</p><h5 id=cluster>Cluster<a hidden class=anchor aria-hidden=true href=#cluster>#</a></h5><p>A collection of hosts that aggregate their resources (CPU, Ram, Disk, ‚Ä¶‚Äã) into a usable pool.</p><h5 id=namespace>Namespace<a hidden class=anchor aria-hidden=true href=#namespace>#</a></h5><p>A logical partitioning capability that enable one Kubernetes cluster to be used by multiple users, teams of users, or a single user with multiple applications without concern for undesired interaction. Each user, team of users, or application may exist within its <strong>Namespace</strong>, isolated from every other user of the cluster and operating as if it were the sole user of the cluster.</p><p>List all Namespace:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get namespace <span class=c1># or `kubectl get ns`</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=label>Label<a hidden class=anchor aria-hidden=true href=#label>#</a></h5><p>Key-value pairs that are used to identify and select related sets of objects. Labels have a strict syntax and defined character set.</p><h5 id=annotation>Annotation<a hidden class=anchor aria-hidden=true href=#annotation>#</a></h5><p>Key-value pairs that contain non-identifying information or metadata. Annotations do not have the the syntax limitations as labels and can contain structured or unstructured data.</p><h5 id=selector>Selector<a hidden class=anchor aria-hidden=true href=#selector>#</a></h5><p>Selectors use labels to filter or select objects. Both equality-based (=, ==, !=) or simple key-value matching selectors are supported.</p><p><strong>Use case of Annotations, Labels and Selectors.</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx-deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>annotations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;nginx frontend&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx:1.7.9</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h5 id=pod>Pod<a hidden class=anchor aria-hidden=true href=#pod>#</a></h5><p>It is the basic unit of work for Kubernetes. Represent a collection of containers that share resources, such as IP addresses and storage.</p><p><strong>Pod Example.</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>myapp-pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>myapp-container</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>busybox</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;sh&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;-c&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;echo Hello Kubernetes! &amp;&amp; sleep 3600&#39;</span><span class=p>]</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>To list all Pods:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get pod <span class=c1># or `kubectl get po`</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=replicationcontroller>ReplicationController<a hidden class=anchor aria-hidden=true href=#replicationcontroller>#</a></h5><p>A framework for defining pods that are meant to be horizontally scaled. A replication controller includes a pod definition that is to be replicated, and the pods created from it can be scheduled to different nodes.</p><p><strong>ReplicationController Example.</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ReplicationController</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>List all ReplicationControllers:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get replicationcontroller <span class=c1># or `kubectl get rc`</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=replicaset>ReplicaSet<a hidden class=anchor aria-hidden=true href=#replicaset>#</a></h5><p>An upgraded version of ReplicationController that supports set-based selectors.</p><p><strong>ReplicaSet Example.</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ReplicaSet</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>frontend</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>guestbook</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>tier</span><span class=p>:</span><span class=w> </span><span class=l>frontend</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>tier</span><span class=p>:</span><span class=w> </span><span class=l>frontend</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchExpressions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- {<span class=nt>key: tier, operator: In, values</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>frontend]}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>guestbook</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>tier</span><span class=p>:</span><span class=w> </span><span class=l>frontend</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>php-redis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>gcr.io/google_samples/gb-frontend:v3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>GET_HOSTS_FROM</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=l>dns</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>List all ReplicaSets:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get replicaset <span class=c1># or `kubectl get rs`</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=deployment>Deployment<a hidden class=anchor aria-hidden=true href=#deployment>#</a></h5><p>Includes a Pod template and a replicas field. Kubernetes will make sure the actual state (amount of replicas, Pod template) always matches the desired state. When you update a Deployment it will perform a &ldquo;rolling update&rdquo;.</p><p><strong>Deployment Example.</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx-deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx:1.7.9</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>List all Deployments:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get deployment
</span></span></code></pre></td></tr></table></div></div><h5 id=statefulset>StatefulSet<a hidden class=anchor aria-hidden=true href=#statefulset>#</a></h5><p>A controller tthat aims to manage Pods that must persist or maintain state. Pod identity including hostname, network, and storage will be persisted.</p><p><strong>StatefulSet Example.</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>StatefulSet</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>web</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>serviceName</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;nginx&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>terminationGracePeriodSeconds</span><span class=p>:</span><span class=w> </span><span class=m>10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>k8s.gcr.io/nginx-slim:0.8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>web</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>www</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/usr/share/nginx/html</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>volumeClaimTemplates</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>www</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>accessModes</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=s2>&#34;ReadWriteOnce&#34;</span><span class=w> </span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>storageClassName</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;my-storage-class&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>storage</span><span class=p>:</span><span class=w> </span><span class=l>1Gi</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>List all StatefulSets:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get statefulset
</span></span></code></pre></td></tr></table></div></div><h5 id=daemonset>DaemonSet<a hidden class=anchor aria-hidden=true href=#daemonset>#</a></h5><p>Ensures that an instance of a specific pod is running on all (or a selection of) nodes in a cluster.</p><p><strong>DaemonSet Example.</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>DaemonSet</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>fluentd-elasticsearch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>kube-system</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>k8s-app</span><span class=p>:</span><span class=w> </span><span class=l>fluentd-logging</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>fluentd-elasticsearch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>fluentd-elasticsearch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>tolerations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>node-role.kubernetes.io/master</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>effect</span><span class=p>:</span><span class=w> </span><span class=l>NoSchedule</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>fluentd-elasticsearch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>gcr.io/google-containers/fluentd-elasticsearch:1.20</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>terminationGracePeriodSeconds</span><span class=p>:</span><span class=w> </span><span class=m>30</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>List all DaemonSets:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get daemonset <span class=c1># or `kubectl get ds`</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=service>Service<a hidden class=anchor aria-hidden=true href=#service>#</a></h5><p>Define a single IP/port combination that provides access to a pool of pods. It uses label selectors to map groups of pods and ports to a cluster-unique virtual IP.</p><p><strong>Service Example.</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>my-nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>my-nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>my-nginx</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>List all Services:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get service <span class=c1># or `kubectl get svc`</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=ingress>Ingress<a hidden class=anchor aria-hidden=true href=#ingress>#</a></h5><p>An ingress controller is the primary method of exposing a cluster service (usually http) to the outside world. These are load balancers or routers that usually offer SSL termination, name-based virtual hosting etc‚Ä¶‚Äã</p><p><strong>Ingress Example.</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>extensions/v1beta1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Ingress</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>test-ingress</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>annotations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>nginx.ingress.kubernetes.io/rewrite-target</span><span class=p>:</span><span class=w> </span><span class=l>/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/testpath</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>backend</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>serviceName</span><span class=p>:</span><span class=w> </span><span class=l>test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>servicePort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>List all Ingress:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get ingress
</span></span></code></pre></td></tr></table></div></div><h5 id=volume>Volume<a hidden class=anchor aria-hidden=true href=#volume>#</a></h5><p>Storage that is tied to the Pod Lifecycle, consumable by one or more containers within the pod.</p><h5 id=persistentvolume>PersistentVolume<a hidden class=anchor aria-hidden=true href=#persistentvolume>#</a></h5><p>A PersistentVolume (PV) represents a storage resource. PVs are commonly linked to a backing storage resource, NFS, GCEPersistentDisk, RBD etc. and are provisioned ahead of time. Their lifecycle is handled independently from a pod.</p><p>List all PersistentVolumes:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get persistentvolume<span class=sb>`</span> or <span class=sb>`</span>kubectl get pv<span class=sb>`</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=persistentvolumeclaim>PersistentVolumeClaim<a hidden class=anchor aria-hidden=true href=#persistentvolumeclaim>#</a></h5><p>A PersistentVolumeClaim (PVC) is a request for storage that satisfies a set of requirements. Commonly used with dynamically provisioned storage.</p><p>List all PersistentVolumeClaims:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get persistentvolumeclaim<span class=sb>`</span> or <span class=sb>`</span>kubectl get pvc<span class=sb>`</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=storageclass>StorageClass<a hidden class=anchor aria-hidden=true href=#storageclass>#</a></h5><p>Storage classes are an abstraction on top of an external storage resource. These will include a provisioner, provisioner configuration parameters as well as a PV reclaimPolicy.</p><p>List all StorageClasses:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get storageclass<span class=sb>`</span> or <span class=sb>`</span>kubectl get sc<span class=sb>`</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=job>Job<a hidden class=anchor aria-hidden=true href=#job>#</a></h5><p>The job controller ensures one or more pods are executed and successfully terminates. It will do this until it satisfies the completion and/or parallelism condition.</p><p>List all Jobs:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get job<span class=sb>`</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=cronjob>CronJob<a hidden class=anchor aria-hidden=true href=#cronjob>#</a></h5><p>An extension of the Job Controller, it provides a method of executing jobs on a cron-like schedule.</p><p>List all CronJobs:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get cronjob<span class=sb>`</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=configmap>ConfigMap<a hidden class=anchor aria-hidden=true href=#configmap>#</a></h5><p>Externalized data stored within Kubernetes that can be referenced as a commandline argument, environment variable or injected as a file into a volume mount. Ideal for implementing the External Configuration Store pattern.</p><p>List all ConfigMaps:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get configmap<span class=sb>`</span> or <span class=sb>`</span>kubectl get cm<span class=sb>`</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=secret>Secret<a hidden class=anchor aria-hidden=true href=#secret>#</a></h5><p>Functionally identical to ConfigMaps, but stored encoded as base64, and encrypted at rest (if configured).</p><p>List all Secrets:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get secret<span class=sb>`</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=2-run-kubernetes-locally>2. Run Kubernetes locally<a hidden class=anchor aria-hidden=true href=#2-run-kubernetes-locally>#</a></h3><p>For our tutorial we will not build a real <strong>Kubernetes Cluster</strong>. We will use <strong>Minikube</strong>.</p><p><strong>Minikube</strong> is a tool that makes it easy to run <strong>Kubernetes</strong> locally. <strong>Minikube</strong> runs a single-node <strong>Kubernetes cluster</strong> inside a <strong>VM</strong> on your laptop for users looking to try out <strong>Kubernetes</strong> or develop with it day-to-day.</p><p>For <strong>Minikube</strong> installation : <a href=https://github.com/kubernetes/minikube>https://github.com/kubernetes/minikube</a></p><p>After the installation, to start <strong>Minikube</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ minikube start
</span></span></code></pre></td></tr></table></div></div><p>The <code>minikube start</code> command creates a <strong>kubectl context</strong> called <strong>minikube</strong>. This context contains the configuration to communicate with your minikube cluster.</p><p><strong>Minikube</strong> sets this context to default automatically, but if you need to switch back to it in the future, run:</p><p>kubectl config use-context minikube</p><p>To access the Kubernetes Dashboard:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ minikube dashboard
</span></span></code></pre></td></tr></table></div></div><p>The Dashboard will be opened in your default browser:</p><div align=center><p><img loading=lazy src=../images/k8s-dashboard.webp alt="Kubernetes Dashboard (Web UI)"></p></div><p>The <code>minikube stop</code> command can be used to stop your cluster. This command shuts down the minikube virtual machine, but preserves all cluster state and data. Starting the cluster again will restore it to it‚Äôs previous state.</p><p>The <code>minikube delete</code> command can be used to delete your cluster. This command shuts down and deletes the minikube virtual machine. No data or state is preserved.</p><h3 id=3-refactoring-the-application>3. Refactoring the application<a hidden class=anchor aria-hidden=true href=#3-refactoring-the-application>#</a></h3><p>Now we want to move from H2 Databse to PostgreSQL. So we have to configure the application to use it by mentioning some properties like JDBC driver, url, username, password‚Ä¶‚Äã in the <code>application.properties</code> file and to add the PostgreSQL JDBC Driver in the <code>pom.xml</code>.</p><p>First of all, we start by adding this dependency to our <code>pom.xml</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;groupId&gt;</span>org.postgresql<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;artifactId&gt;</span>postgresql<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;scope&gt;</span>runtime<span class=nt>&lt;/scope&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>Next, we do some modifications to the <code>application.properties</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>spring.datasource.driver-class-name=org.postgresql.Driver
</span></span><span class=line><span class=cl>spring.jpa.hibernate.ddl-auto=create
</span></span><span class=line><span class=cl>spring.datasource.url=jdbc:postgresql://${POSTGRES_SERVICE}:5432/${POSTGRES_DB_NAME}
</span></span><span class=line><span class=cl>spring.datasource.username=${POSTGRES_DB_USER}
</span></span><span class=line><span class=cl>spring.datasource.password=${POSTGRES_DB_PASSWORD}
</span></span></code></pre></td></tr></table></div></div><p>We have used environment properties placeholders:</p><ul><li><code>POSTGRES_SERVICE</code> : Host of PostgreSQL DB Server</li><li><code>POSTGRES_DB_NAME</code> : PostgreSQL DB Name</li><li><code>POSTGRES_DB_USER</code> : PostgreSQL Username</li><li><code>POSTGRES_DB_PASSWORD</code> : PostgreSQL Password</li></ul><p>We will extract these values from a Kubernetes ConfigMap and Secret objects.</p><h4 id=create-the-configmap>Create the ConfigMap<a hidden class=anchor aria-hidden=true href=#create-the-configmap>#</a></h4><p>We need to create the ConfigMap:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl create configmap postgres-config <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	--from-literal<span class=o>=</span>postgres.service.name<span class=o>=</span>postgresql <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	--from-literal<span class=o>=</span>postgres.db.name<span class=o>=</span>boutique
</span></span></code></pre></td></tr></table></div></div><p>We can check the created ConfigMap:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get cm postgres-config -o json
</span></span></code></pre></td></tr></table></div></div><p>The output will look like this:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;apiVersion&#34;</span><span class=p>:</span> <span class=s2>&#34;v1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;data&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;postgres.db.name&#34;</span><span class=p>:</span> <span class=s2>&#34;boutique&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;postgres.service.name&#34;</span><span class=p>:</span> <span class=s2>&#34;postgresql&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;kind&#34;</span><span class=p>:</span> <span class=s2>&#34;ConfigMap&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;metadata&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;creationTimestamp&#34;</span><span class=p>:</span> <span class=s2>&#34;2018-03-25T16:42:39Z&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;postgres-config&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;namespace&#34;</span><span class=p>:</span> <span class=s2>&#34;default&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;resourceVersion&#34;</span><span class=p>:</span> <span class=s2>&#34;195&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;selfLink&#34;</span><span class=p>:</span> <span class=s2>&#34;/api/v1/namespaces/default/configmaps/postgres-config&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;uid&#34;</span><span class=p>:</span> <span class=s2>&#34;87d7481c-304b-11e8-889d-080027a8a37c&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=create-the-secret>Create the Secret<a hidden class=anchor aria-hidden=true href=#create-the-secret>#</a></h4><p>Next we create the Secret:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl create secret generic db-security <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	--from-literal<span class=o>=</span>db.user.name<span class=o>=</span>nebrass <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	--from-literal<span class=o>=</span>db.user.password<span class=o>=</span>password
</span></span></code></pre></td></tr></table></div></div><p>We can check the created Secret:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get secret db-security -o json
</span></span></code></pre></td></tr></table></div></div><p>The output will look like this:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;apiVersion&#34;</span><span class=p>:</span> <span class=s2>&#34;v1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;data&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;db.user.name&#34;</span><span class=p>:</span> <span class=s2>&#34;bmVicmFzcw==&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;db.user.password&#34;</span><span class=p>:</span> <span class=s2>&#34;cGFzc3dvcmQ=&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;kind&#34;</span><span class=p>:</span> <span class=s2>&#34;Secret&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;metadata&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;creationTimestamp&#34;</span><span class=p>:</span> <span class=s2>&#34;2018-03-25T16:56:36Z&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;db-security&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;namespace&#34;</span><span class=p>:</span> <span class=s2>&#34;default&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;resourceVersion&#34;</span><span class=p>:</span> <span class=s2>&#34;714&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;selfLink&#34;</span><span class=p>:</span> <span class=s2>&#34;/api/v1/namespaces/default/secrets/db-security&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;uid&#34;</span><span class=p>:</span> <span class=s2>&#34;7ac96df3-304d-11e8-889d-080027a8a37c&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;Opaque&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>The credentials are encoded as base64. This is to protect the secret from being exposed accidentally to someone looking or from being stored in a terminal log.</li><li>From kubernetes‚Äôs point of view the contents of this Secret is unstructured: it can contain arbitrary key-value pairs.</li></ul><h4 id=deploy-postgresql-to-kubernetes>Deploy PostgreSQL to Kubernetes<a hidden class=anchor aria-hidden=true href=#deploy-postgresql-to-kubernetes>#</a></h4><p>As the configuration is centralized and stored in the Kubernetes Cluster, we can share them between the Spring Boot Application and the PostgreSQL Service that we will create now.</p><p>I already prepared the PostgreSQL resource file, in the <code>src/main/assets/</code>. This YAML file contains a Deployment and a Service resources.</p><p>We loaded the properties from our ConfigMap and Secret.</p><p>The content of <code>postgres.yml</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>extensions/v1beta1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>postgresql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>postgresql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>emptyDir</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>postgres</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>postgres:9.6.5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>POSTGRES_USER</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>secretKeyRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>db-security</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>db.user.name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>POSTGRES_PASSWORD</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>secretKeyRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>db-security</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>db.user.password</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>POSTGRES_DB</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>configMapKeyRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>postgres-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>postgres.db.name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>5432</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/var/lib/postgresql/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>postgresql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>postgresql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>5432</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>We will use the postgres:9.6.5 image</li><li>The <code>env</code> block is used to load data in the container environment.</li><li>Create an environment variable with a value loaded from a <code>key</code> called <code>db.user.name</code> in the <code>secret</code> called <code>db-security</code>.</li><li>Create an environment variable with a value loaded from a <code>key</code> called <code>db.user.password</code> in the <code>secret</code> called <code>db-security</code>.</li><li>Create an environment variable with a value loaded from a <code>key</code> called <code>postgres.db.name</code> in the <code>configMap</code> called <code>postgres-config</code>.</li></ul><p>To apply this resource file to Kubernetes, we can do:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl create -f src/main/assets/postgres.yml
</span></span></code></pre></td></tr></table></div></div><p>The output will be:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>deployment <span class=s2>&#34;postgresql&#34;</span> created
</span></span><span class=line><span class=cl>service <span class=s2>&#34;postgresql&#34;</span> created
</span></span></code></pre></td></tr></table></div></div><p>We can check the created Deployment:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get deployment postgresql -o json
</span></span></code></pre></td></tr></table></div></div><p>The output will look like this:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;apiVersion&#34;</span><span class=p>:</span> <span class=s2>&#34;extensions/v1beta1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;kind&#34;</span><span class=p>:</span> <span class=s2>&#34;Deployment&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;metadata&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;annotations&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;deployment.kubernetes.io/revision&#34;</span><span class=p>:</span> <span class=s2>&#34;1&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;creationTimestamp&#34;</span><span class=p>:</span> <span class=s2>&#34;2018-03-25T17:04:03Z&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;generation&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;labels&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;app&#34;</span><span class=p>:</span> <span class=s2>&#34;postgresql&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;postgresql&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;namespace&#34;</span><span class=p>:</span> <span class=s2>&#34;default&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;resourceVersion&#34;</span><span class=p>:</span> <span class=s2>&#34;1025&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;selfLink&#34;</span><span class=p>:</span> <span class=s2>&#34;/apis/extensions/v1beta1/namespaces/default/deployments/postgresql&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;uid&#34;</span><span class=p>:</span> <span class=s2>&#34;84fa2f1a-304e-11e8-889d-080027a8a37c&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;spec&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=err>...</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;status&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;availableReplicas&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;conditions&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;lastTransitionTime&#34;</span><span class=p>:</span> <span class=s2>&#34;2018-03-25T17:04:03Z&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;lastUpdateTime&#34;</span><span class=p>:</span> <span class=s2>&#34;2018-03-25T17:04:03Z&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;Deployment has minimum availability.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;reason&#34;</span><span class=p>:</span> <span class=s2>&#34;MinimumReplicasAvailable&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;True&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;Available&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;observedGeneration&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;readyReplicas&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;replicas&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;updatedReplicas&#34;</span><span class=p>:</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>We can check the created Service:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get service postgresql -o json
</span></span></code></pre></td></tr></table></div></div><p>The output will look like this:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;apiVersion&#34;</span><span class=p>:</span> <span class=s2>&#34;extensions/v1beta1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;kind&#34;</span><span class=p>:</span> <span class=s2>&#34;Deployment&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;metadata&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;annotations&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;deployment.kubernetes.io/revision&#34;</span><span class=p>:</span> <span class=s2>&#34;1&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;creationTimestamp&#34;</span><span class=p>:</span> <span class=s2>&#34;2018-03-25T17:04:03Z&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;generation&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;labels&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;app&#34;</span><span class=p>:</span> <span class=s2>&#34;postgresql&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;postgresql&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;namespace&#34;</span><span class=p>:</span> <span class=s2>&#34;default&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;resourceVersion&#34;</span><span class=p>:</span> <span class=s2>&#34;1025&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;selfLink&#34;</span><span class=p>:</span> <span class=s2>&#34;/apis/extensions/v1beta1/namespaces/default/deployments/postgresql&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;uid&#34;</span><span class=p>:</span> <span class=s2>&#34;84fa2f1a-304e-11e8-889d-080027a8a37c&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;spec&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=err>...</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;status&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;availableReplicas&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;conditions&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;lastTransitionTime&#34;</span><span class=p>:</span> <span class=s2>&#34;2018-03-25T17:04:03Z&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;lastUpdateTime&#34;</span><span class=p>:</span> <span class=s2>&#34;2018-03-25T17:04:03Z&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;Deployment has minimum availability.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;reason&#34;</span><span class=p>:</span> <span class=s2>&#34;MinimumReplicasAvailable&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;True&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;Available&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;observedGeneration&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;readyReplicas&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;replicas&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;updatedReplicas&#34;</span><span class=p>:</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>In this output, there is something interesting: the port and the target port:</p><ul><li>The port this service will be available on</li><li>The container port the service will forward to</li></ul><p>We already mentionned the <code>port</code> in the <code>spring.datasource.url</code> property.</p><p>- What do you think if we use the powerful features of Kubernetes to resolve this port dynamically?</p><p>- Ok but how? :)</p><p>After creating these resources, the <em>effective</em> properties will like this :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>spring.datasource.driver-class-name=org.postgresql.Driver
</span></span><span class=line><span class=cl>spring.jpa.hibernate.ddl-auto=create
</span></span><span class=line><span class=cl>spring.datasource.url=jdbc:postgresql://postgresql:5432/boutique
</span></span><span class=line><span class=cl>spring.datasource.username=nebrass
</span></span><span class=line><span class=cl>spring.datasource.password=password
</span></span></code></pre></td></tr></table></div></div><p>The <strong>Datasource URL</strong> is pointing to a host called <code>postgresql</code>. The resolution of the hostname to IP is done by Kubernetes.</p><p>If we check the <code>postgresql</code> service:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get svc postgresql
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME         TYPE        CLUSTER-IP       EXTERNAL-IP   PORT<span class=o>(</span>S<span class=o>)</span>    AGE
</span></span><span class=line><span class=cl>postgresql   ClusterIP   10.111.244.143   &lt;none&gt;        5432/TCP   1h
</span></span></code></pre></td></tr></table></div></div><p>There is an other cool feature in Kubernetes, we can fetch data related to the service itself. We can for example get the port associated to this service.</p><p>For example:</p><ul><li><code>${postgresql.service.host}</code> will be resolved to <code>10.111.244.143</code>.</li><li><code>${postgresql.service.port}</code> will be resolved to <code>5432</code>.</li></ul><p>We can do it better ^^) we can merge the environment variables in the great holders that will be resolved by Kubernetes. They will become:</p><ul><li><code>${postgresql.service.host}</code> can be written <code>${${POSTGRES_SERVICE}.service.host}</code></li><li><code>${postgresql.service.port}</code> can be written <code>${${POSTGRES_SERVICE}.service.port}</code></li></ul><p>In this way, the internal placeholder will be resolved by the environment variable provided by the ConfigMap, and the external placeholder will be resolved by Kubernetes.</p><p>The resulting <code>application.properties</code> will look like:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>spring.datasource.driver-class-name=org.postgresql.Driver
</span></span><span class=line><span class=cl>spring.jpa.hibernate.ddl-auto=create
</span></span><span class=line><span class=cl>spring.datasource.url=jdbc:postgresql://${${POSTGRES_SERVICE}.service.host}:${${POSTGRES_SERVICE}.service.port}/${POSTGRES_DB_NAME}
</span></span><span class=line><span class=cl>spring.datasource.username=${POSTGRES_DB_USER}
</span></span><span class=line><span class=cl>spring.datasource.password=${POSTGRES_DB_PASSWORD}
</span></span></code></pre></td></tr></table></div></div><p>Now, we are ConfigMaps addicts :) we will host our <code>application.properties</code> in a ConfigMap in Kubernetes. To do it, just do:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl create configmap app-config <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	--from-file<span class=o>=</span>src/main/resources/application.properties
</span></span></code></pre></td></tr></table></div></div><p>Now that the <code>application.properties</code>, how can our Spring Boot application use them?</p><p>The answer is so easy: the <strong>Spring Cloud Kubernetes</strong> plugin.</p><h4 id=what-is-spring-cloud-kubernetes>What is Spring Cloud Kubernetes<a hidden class=anchor aria-hidden=true href=#what-is-spring-cloud-kubernetes>#</a></h4><p>The Spring Cloud Kubernetes plug-in implements the integration between Kubernetes and Spring Boot. It provides access to the configuration data of a ConfigMap using the Kubernetes API.</p><p>It make so easy to integrate Kubernetes ConfigMap directly with the Spring Boot externalized configuration mechanism, so that Kubernetes ConfigMaps behave as an alternative property source for Spring Boot configuration.</p><p>To enable the great features of the plugin:</p><ol><li><p>Add the Maven Dependency:Add this dependency to the <code>pom.xml</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;groupId&gt;</span>io.fabric8<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;artifactId&gt;</span>spring-cloud-starter-kubernetes<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;version&gt;</span>0.1.6<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>Create the Bootstrap file:Create a new file <code>bootstrap.properties</code> under <code>src/main/resources</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>spring.application.name=${project.artifactId}
</span></span><span class=line><span class=cl>spring.cloud.kubernetes.config.name=app-config
</span></span></code></pre></td></tr></table></div></div><ul><li>The <code>${project.artifactId}</code> will be parsed and populated by <code>maven-resources-plugin</code>, that you will find in the <code>pom.xml</code> of the sample project hosted in the Github repository of this tutorial.</li><li>The name of the ConfigMap where we stored our great <code>application.properties</code>.</li></ul></li></ol><p>That‚Äôs it! The Spring Cloud Kubernetes is correctly integrated to our application. When we deploy our application to Kubernetes, it will use the <code>application.properties</code> stored in the ConfigMap <code>app-config</code>.</p><p>You say deploy? Ok but how to do it?</p><h4 id=deploy-it-to-kubernetes>Deploy it to Kubernetes<a hidden class=anchor aria-hidden=true href=#deploy-it-to-kubernetes>#</a></h4><p>The deployment?! A dedicated full story, that can have many chapters. But we will try to keep it short and simple.</p><p>By definition, Kubernetes is a container orchestration solution. So deploying an application to Kubernetes means :</p><ul><li>Containerizing the application: creating an image embedding the application.</li><li>Preparing the deployment resources (Deployment, ReplicaSet, etc‚Ä¶‚Äã).</li><li>Deploying the container to Kubernetes.</li></ul><p>These steps can take some time to be done, even if we try to automate this process, it will take us long time to implement it, and it will take more time to cover all the cases and variants of the apps.</p><p>As these tasks are so heavy, we need some tool that do all of this for easy.</p><p>Here comes the super powerfull tool: <strong>Fabric8-Maven-Plugin</strong>.</p><div align=center><p><img loading=lazy src=../images/fabric8-logo.webp alt="Fabric8 Logo"></p></div><p>Fabric8-Maven-Plugin is a one-stop-shop for building and deploying Java applications for Docker, Kubernetes and OpenShift. It brings your Java applications on to Kubernetes and OpenShift. It provides a tight integration into maven and benefits from the build configuration already provided. It focuses on three tasks:</p><ul><li>Building Docker images</li><li>Creating OpenShift and Kubernetes resources</li><li>Deploy application on Kubernetes and OpenShift</li></ul><p>The plugin will do all the heavy tasks ! Yes ! He will ! :)</p><p>It can be configured very flexibly and supports multiple configuration models for creating:</p><ul><li><strong>Zero Configuration</strong> for a quick ramp-up where opinionated defaults will be pre-selected.</li><li><strong>Inline Configuration</strong> within the plugin configuration in an XML syntax.</li><li><strong>External Configuration</strong> templates of the real deployment descriptors which are enriched by the plugin.</li><li><strong>Docker Compose Configuration</strong> provide Docker Compose file and bring up docker compose deployments on a Kubernetes/OpenShift cluster.</li></ul><p>To enable <code>fabric8-maven-plugin</code> on your project just add this to the plugins sections of your <code>pom.xml</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;groupId&gt;</span>io.fabric8<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;artifactId&gt;</span>fabric8-maven-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;version&gt;</span>3.5.38<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/plugin&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>Now in order to use <code>fabric8-maven-plugin</code> to build or deploy, make sure you have a Kubernetes cluster up and running.</p><p>The <code>fabric8-maven-plugin</code> supports a rich set of goals for providing a smooth Java developer experience. You can categorize these goals as follows:</p><ul><li>Build goals are used to create and manage the Kubernetes build artifacts like Docker images.<ul><li><code>fabric8:build</code> : Build Docker images</li><li><code>fabric8:resource</code> : Create Kubernetes resource descriptors</li><li><code>fabric8:push</code> : Push Docker images to a registry</li><li><code>fabric8:apply</code> : Apply resources to a running cluster</li></ul></li><li>Development goals are used in deploying resource descriptors to the development cluster.<ul><li><code>fabric8:run</code> : Run a complete development workflow cycle <code>fabric8:resource</code> ‚Üí <code>fabric8:build</code> ‚Üí <code>fabric8:apply</code> in the foreground.</li><li><code>fabric8:deploy</code> : Deploy resources descriptors to a cluster after creating them and building the app. Same as <code>fabric8:run</code> except that it runs in the background.</li><li><code>fabric8:undeploy</code> : Undeploy and remove resources descriptors from a cluster.</li><li><code>fabric8:watch</code> : Watch for doing rebuilds and restarts</li></ul></li></ul><p>If you want to integrate the goals in the maven lifecycle phases, you can do it easily:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;groupId&gt;</span>io.fabric8<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;artifactId&gt;</span>fabric8-maven-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;version&gt;</span>3.5.38<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!-- This block will connect fabric8:resource and fabric8:build to lifecycle phases --&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;executions&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;execution&gt;</span>
</span></span><span class=line><span class=cl>       <span class=nt>&lt;id&gt;</span>fmp<span class=nt>&lt;/id&gt;</span>
</span></span><span class=line><span class=cl>       <span class=nt>&lt;goals&gt;</span>
</span></span><span class=line><span class=cl>         <span class=nt>&lt;goal&gt;</span>resource<span class=nt>&lt;/goal&gt;</span>
</span></span><span class=line><span class=cl>         <span class=nt>&lt;goal&gt;</span>build<span class=nt>&lt;/goal&gt;</span>
</span></span><span class=line><span class=cl>       <span class=nt>&lt;/goals&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/execution&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/executions&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/plugin&gt;</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>‚ÑπÔ∏è <strong>Note</strong></p><p>For lazyness purposes :p I will be referencing the <em>fabric8-maven-plugin</em> as <strong>f8mp</strong>.</p></blockquote><blockquote><p>‚ö†Ô∏è <strong>Warning</strong></p><p>The <strong>f8mp</strong> needs to access to the Docker environment of Minikube, to do this just start the command¬†<code>eval $(minikube docker-env)</code> . Without this command, Kubernetes will not find the Docker images built by <strong>f8mp</strong>.</p></blockquote><p>Now when we do <code>mvn clean install</code> for example, the plugin will build the docker images and will generate the Kubernetes resource descriptors in the <code>${basedir}/target/classes/META-INF/fabric8/kubernetes</code> directory.</p><p>Let‚Äôs check the generated resource descriptors.</p><blockquote><p>‚ö†Ô∏è <strong>Warning</strong></p><p>Wait ! Wait! We said that we will pass the ConfigMaps to the Spring Boot application. Where is that?!</p></blockquote><p>Yep! Before generating our resources descriptors, we have to tell this to <strong>f8mp</strong>.</p><p><strong>f8mp</strong> has an easy way to do this: the plugin can handle some <strong>Resource Fragments</strong>. It‚Äôs a piece of YAML code located in the <code>src/main/fabric8</code> directory. Each resource get is own file, which contains some skeleton of a resource description. The plugin will pick up the resource, enriches it and then combines all the data. Within these descriptor files you are can freely use any Kubernetes feature.</p><p>In our case, we will deliver in the <strong>Resource Fragment</strong> the configuration of the environment variables to the Pod, where our Spring Boot Application will be executed. We will use a <strong>fragment</strong> of a <strong>Deployment</strong>, which will look like this:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>extensions/v1beta1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>${project.artifactId}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>${project.artifactId}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>POSTGRES_SERVICE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>configMapKeyRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>postgres-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>postgres.service.name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>POSTGRES_DB_NAME</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>configMapKeyRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>postgres-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>postgres.db.name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>POSTGRES_DB_USER</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>secretKeyRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>db-security</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>db.user.name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>POSTGRES_DB_PASSWORD</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>secretKeyRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>db-security</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>db.user.password</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>The name of our Deployment and the container.</li><li>The environment variables that we are creating and populating from the ConfigMap and Secret.</li></ul><p>Now, when the <strong>f8mp</strong> will try to generate the resources descriptors, it will find this resource fragment, combine it with the other data. The resulting output will be coherent with the fregment that we already provided.</p><p>Let‚Äôs try it. Just run <code>mvn clean install</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Scanning <span class=k>for</span> projects...
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> ------------------------------------------------------------------------
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Building MySchool 0.0.1-SNAPSHOT
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> ------------------------------------------------------------------------
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span>
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> --- fabric8-maven-plugin:3.5.38:resource <span class=o>(</span>fmp<span class=o>)</span> @ myschool -
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> F8: Running in Kubernetes mode
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> F8: Running generator spring-boot
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> F8: spring-boot: Using Docker image fabric8/java-jboss-openjdk8-jdk:1.3 as base / builder
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> F8: using resource templates from /Users/n.lamouchi/MySchool/src/main/fabric8
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> F8: fmp-service: Adding a default service <span class=s1>&#39;myschool&#39;</span> with ports <span class=o>[</span>8080<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> F8: spring-boot-health-check: Adding readiness probe on port 8080, <span class=nv>path</span><span class=o>=</span><span class=s1>&#39;/health&#39;</span>, <span class=nv>scheme</span><span class=o>=</span><span class=s1>&#39;HTTP&#39;</span>, with initial delay <span class=m>10</span> seconds
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> F8: spring-boot-health-check: Adding liveness probe on port 8080, <span class=nv>path</span><span class=o>=</span><span class=s1>&#39;/health&#39;</span>, <span class=nv>scheme</span><span class=o>=</span><span class=s1>&#39;HTTP&#39;</span>, with initial delay <span class=m>180</span> seconds
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> F8: fmp-revision-history: Adding revision <span class=nb>history</span> limit to <span class=m>2</span>
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> F8: f8-icon: Adding icon <span class=k>for</span> deployment
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> F8: f8-icon: Adding icon <span class=k>for</span> service
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> F8: validating /Users/n.lamouchi/MySchool/target/classes/META-INF/fabric8/openshift/myschool-svc.yml resource
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> F8: validating /Users/n.lamouchi/MySchool/target/classes/META-INF/fabric8/openshift/myschool-deploymentconfig.yml resource
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> F8: validating /Users/n.lamouchi/MySchool/target/classes/META-INF/fabric8/openshift/myschool-route.yml resource
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> F8: validating /Users/n.lamouchi/MySchool/target/classes/META-INF/fabric8/kubernetes/myschool-deployment.yml resource
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> F8: validating /Users/n.lamouchi/MySchool/target/classes/META-INF/fabric8/kubernetes/myschool-svc.yml resource
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span>
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> --- fabric8-maven-plugin:3.5.38:build <span class=o>(</span>fmp<span class=o>)</span> @ myschool -
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> F8: Building Docker image in Kubernetes mode
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> F8: Running generator spring-boot
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> F8: spring-boot: Using Docker image fabric8/java-jboss-openjdk8-jdk:1.3 as base / builder
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Copying files to /Users/n.lamouchi/MySchool/target/docker/nebrass/myschool/snapshot-180327-174802-0575/build/maven
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Building tar: /Users/n.lamouchi/MySchool/target/docker/nebrass/myschool/snapshot-180327-174802-0575/tmp/docker-build.tar
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> F8: <span class=o>[</span>nebrass/myschool:snapshot-180327-174802-0575<span class=o>]</span> <span class=s2>&#34;spring-boot&#34;</span>: Created docker-build.tar in <span class=m>283</span> milliseconds
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> F8: <span class=o>[</span>nebrass/myschool:snapshot-180327-174802-0575<span class=o>]</span> <span class=s2>&#34;spring-boot&#34;</span>: Built image sha256:61171
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> F8: <span class=o>[</span>nebrass/myschool:snapshot-180327-174802-0575<span class=o>]</span> <span class=s2>&#34;spring-boot&#34;</span>: Tag with latest
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span>
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> ------------------------------------------------------------------------
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> BUILD SUCCESS
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> ------------------------------------------------------------------------
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Total time: 30.505 s
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Finished at: 2018-03-27T17:48:29+02:00
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Final Memory: 70M/721M
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> ------------------------------------------------------------------------
</span></span></code></pre></td></tr></table></div></div><ul><li>Generating the resources descriptors based on the detected configuration: Spring Boot application that is using the port 8080 with existing Actuator endpoints.</li><li>Building the Docker image in Kubernetes mode (locally and not like the Openshift mode, which uses the Openshift S2I Mechanism for the build).</li></ul><p>After building our project, we got these files in the <code>${basedir}/target/classes/META-INF/fabric8/kubernetes</code> directory:</p><ul><li>my-school-deployment.yml</li><li>my-school-svc.yml</li></ul><p>Let‚Äôs check the Deployment:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>extensions/v1beta1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>annotations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>fabric8.io/git-commit</span><span class=p>:</span><span class=w> </span><span class=l>0120b762d7e26994e8b01d7e85f8941e5d095130</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>fabric8.io/git-branch</span><span class=p>:</span><span class=w> </span><span class=l>master</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>fabric8.io/scm-tag</span><span class=p>:</span><span class=w> </span><span class=l>HEAD</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>myschool</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>provider</span><span class=p>:</span><span class=w> </span><span class=l>fabric8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=m>0.0.1</span>-<span class=l>SNAPSHOT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>group</span><span class=p>:</span><span class=w> </span><span class=l>com.onepoint.labs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>myschool</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>revisionHistoryLimit</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>myschool</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>provider</span><span class=p>:</span><span class=w> </span><span class=l>fabric8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>group</span><span class=p>:</span><span class=w> </span><span class=l>com.onepoint.labs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>annotations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>fabric8.io/git-commit</span><span class=p>:</span><span class=w> </span><span class=l>0120b762d7e26994e8b01d7e85f8941e5d095130</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>fabric8.io/git-branch</span><span class=p>:</span><span class=w> </span><span class=l>master</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>fabric8.io/scm-tag</span><span class=p>:</span><span class=w> </span><span class=l>HEAD</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=l>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>myschool</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>provider</span><span class=p>:</span><span class=w> </span><span class=l>fabric8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=m>0.0.1</span>-<span class=l>SNAPSHOT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>group</span><span class=p>:</span><span class=w> </span><span class=l>com.onepoint.labs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>POSTGRES_SERVICE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>configMapKeyRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>postgres.service.name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>postgres-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>POSTGRES_DB_NAME</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>configMapKeyRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>postgres.db.name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>postgres-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>POSTGRES_DB_USER</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>secretKeyRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>db.user.name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>db-security</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>POSTGRES_DB_PASSWORD</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>secretKeyRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>db.user.password</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>db-security</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>KUBERNETES_NAMESPACE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>fieldRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>fieldPath</span><span class=p>:</span><span class=w> </span><span class=l>metadata.namespace</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nebrass/myschool:snapshot-180327-003059-0437</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class=l>IfNotPresent</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>livenessProbe</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>httpGet</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/health</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>scheme</span><span class=p>:</span><span class=w> </span><span class=l>HTTP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>initialDelaySeconds</span><span class=p>:</span><span class=w> </span><span class=m>180</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>myschool</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>http</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>9779</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>prometheus</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>8778</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>jolokia</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>readinessProbe</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>httpGet</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/health</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>scheme</span><span class=p>:</span><span class=w> </span><span class=l>HTTP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>initialDelaySeconds</span><span class=p>:</span><span class=w> </span><span class=m>10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>securityContext</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>privileged</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>Generated annotations that holds many usefull data, like the <code>git-commit</code> id or the <code>git-branch</code></li><li>Labels section holds the Maven Project <code>groupId</code>, <code>artifactId</code> and <code>version</code> information. Add to that, a label <code>provider=fabric8</code> to tell you that this data is generated by <strong>f8mp</strong></li><li>The Docker Image, generated and built by <strong>f8mp</strong>. The suffix <em>snapshot-180327-003059-0437</em> is the default format to assign a version tag.</li><li>A liveness probe checks if the container in which it is configured is still up.</li><li>A readiness probe determines if a container is ready to service requests.</li></ul><blockquote><p>üí° <strong>Tip</strong></p><p>The liveness and readiness probes are generated because the <strong>f8mp</strong> has detected that the Spring-Boot-Actuator library in the classpath.</p></blockquote><p>At this point, we can deploy our application just using the command <code>mvn fabric8:apply</code>, the output will look like:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> --- fabric8-maven-plugin:3.5.38:apply <span class=o>(</span>default-cli<span class=o>)</span> @ myschool ---
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> F8: Using Kubernetes at https://192.168.99.100:8443/ in namespace default with manifest
</span></span><span class=line><span class=cl>/Users/n.lamouchi/Downloads/MyBoutiqueReactive/target/classes/META-INF/fabric8/kubernetes.yml
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Using namespace: default
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Updating a Service from kubernetes.yml
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Updated Service: target/fabric8/applyJson/default/service-myschool.json
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Using namespace: default
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Creating a Deployment from kubernetes.yml namespace default name myschool
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Created Deployment: target/fabric8/applyJson/default/deployment-myschool.json
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> F8: HINT: Use the <span class=nb>command</span> <span class=sb>`</span>kubectl get pods -w<span class=sb>`</span> to watch your pods start up
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> ------------------------------------------------------------------------
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> BUILD SUCCESS
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> ------------------------------------------------------------------------
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Total time: 16.003 s
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Finished at: 2018-03-28T00:03:56+02:00
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Final Memory: 78M/756M
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> ------------------------------------------------------------------------
</span></span></code></pre></td></tr></table></div></div><p>We can check all the resources that exists on our cluster</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get all
</span></span></code></pre></td></tr></table></div></div><p>This command will list all the resources in the <code>default</code> namespace. The output will be something:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>NAME                DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>deploy/myschool     <span class=m>1</span>         <span class=m>1</span>         <span class=m>1</span>            <span class=m>1</span>           6m
</span></span><span class=line><span class=cl>deploy/postgresql   <span class=m>1</span>         <span class=m>1</span>         <span class=m>1</span>            <span class=m>1</span>           7m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                       DESIRED   CURRENT   READY     AGE
</span></span><span class=line><span class=cl>rs/myschool-5dd7cbff98     <span class=m>1</span>         <span class=m>1</span>         <span class=m>1</span>         6m
</span></span><span class=line><span class=cl>rs/postgresql-5f57747985   <span class=m>1</span>         <span class=m>1</span>         <span class=m>1</span>         7m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                             READY     STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>po/myschool-5dd7cbff98-w2wtl     1/1       Running   <span class=m>0</span>          6m
</span></span><span class=line><span class=cl>po/postgresql-5f57747985-8n9h6   1/1       Running   <span class=m>0</span>          7m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME             TYPE        CLUSTER-IP      EXTERNAL-IP   PORT<span class=o>(</span>S<span class=o>)</span>    AGE
</span></span><span class=line><span class=cl>svc/kubernetes   ClusterIP   10.96.0.1       &lt;none&gt;        443/TCP    23m
</span></span><span class=line><span class=cl>svc/myschool     ClusterIP   10.106.72.231   &lt;none&gt;        8080/TCP   20m
</span></span><span class=line><span class=cl>svc/postgresql   ClusterIP   10.111.62.173   &lt;none&gt;        5432/TCP   21m
</span></span></code></pre></td></tr></table></div></div><blockquote><p>üí° <strong>Tip</strong></p><p>We can list all these resources on the K8s Dashboard.</p></blockquote><p>Wow! Yes, these resources have been created during the steps that we did before :) Good job !</p><h3 id=5-it-works--hakuna-matata->5. It works ! Hakuna Matata !<a hidden class=anchor aria-hidden=true href=#5-it-works--hakuna-matata->#</a></h3><p>It‚Äôs done ^^) we deployed the application and all its required resources; but how can we access the deployed application?</p><p>The application will be accessible thru the Kubernetes Service object called <code>myschool</code>.</p><p>Let‚Äôs check what is the service <code>myschool</code>, type <code>kubectl get svc myschool</code>, the output will be:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>NAME       TYPE        CLUSTER-IP      EXTERNAL-IP   PORT<span class=o>(</span>S<span class=o>)</span>    AGE
</span></span><span class=line><span class=cl>myschool   ClusterIP   10.106.72.231   &lt;none&gt;        8080/TCP   1d
</span></span></code></pre></td></tr></table></div></div><p>The type of our <code>service</code> is <code>ClusterIP</code>. What is a <code>ClusterIP</code> ?</p><p><code>ClusterIP</code> is the default ServiceType. It exposes the service on a cluster-internal IP so it will be only reachable from within the cluster.</p><p>So we cannot use this ServiceType because we need our service to be reachable from outisde the cluster. So is there any other type of service?</p><p>Yes! There are three other types of services, other than <code>ClusterIP</code>:</p><ul><li><code>NodePort</code>: Exposes the service on each Node‚Äôs IP at a static port (the <code>NodePort</code>). A <code>ClusterIP</code> service, to which the <code>NodePort</code> service will route, is automatically created. You‚Äôll be able to contact the <code>NodePort</code> service, from outside the cluster, by requesting <code>&lt;NodeIP>:&lt;NodePort></code>.</li><li><code>LoadBalancer</code>: Exposes the service externally using a cloud provider‚Äôs load balancer. <code>NodePort</code> and <code>ClusterIP</code> services, to which the external load balancer will route, are automatically created.</li><li><code>ExternalName</code>: Maps the service to the contents of the <code>externalName</code> field (e.g. <code>foo.bar.example.com</code>), by returning a <code>CNAME</code> record with its value.</li></ul><blockquote><p>üí° <strong>Tip</strong></p><p>In our case, we will be using the <code>LoadBalancer</code> service, which redirects traffic across all the nodes. Clients connect to the <code>LoadBalancer</code> service through the load balancer‚Äôs IP.</p></blockquote><p>Ok :) The <code>LoadBalancer</code> will be our <code>ServiceType</code>. But how can we tell this to the <strong>f8mp</strong> ?</p><p>We have two solutions:</p><ul><li>The <strong>Resource Fragments</strong> as we did before.</li><li>The <strong>Inline Configuration</strong>, which is XML based configuration of the <strong>f8mp</strong> plugin.</li></ul><p>Let‚Äôs use this time the <strong>Inline Configuration</strong> to tell the <strong>f8mp</strong> that we want a <code>LoadBalancer</code> service:</p><p>In the <code>configuration</code> section of the <strong>f8mp</strong> plugin, we will declare an <code>enricher</code>.</p><p>An <code>enricher</code> is a component used to create and customize Kubernetes and Openshift resource objects. <strong>f8mp</strong> comes with a set of <code>enrichers</code> which are enabled by default. One of these enrichers, is the <code>fmp-service</code> which is used to customize the Services.</p><p>The <strong>f8mp</strong> with the configured <code>enricher</code> will look like:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;groupId&gt;</span>io.fabric8<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;artifactId&gt;</span>fabric8-maven-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;version&gt;</span>3.5.38<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;enricher&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;config&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;fmp-service&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&lt;type&gt;</span>LoadBalancer<span class=nt>&lt;/type&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;/fmp-service&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/config&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/enricher&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/configuration&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;executions&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;execution&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;id&gt;</span>fmp<span class=nt>&lt;/id&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;goals&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;goal&gt;</span>resource<span class=nt>&lt;/goal&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;goal&gt;</span>build<span class=nt>&lt;/goal&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/goals&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/execution&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/executions&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/plugin&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>Let‚Äôs build and a redeploy our project using <code>mvn clean install fabric8:apply</code> and see what is the type of the deployed <code>service</code> using <code>kubectl get svc myschool</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>NAME         TYPE           CLUSTER-IP      EXTERNAL-IP   PORT<span class=o>(</span>S<span class=o>)</span>          AGE
</span></span><span class=line><span class=cl>myschool     LoadBalancer   10.106.72.231   &lt;pending&gt;     8080:31246/TCP   2d
</span></span></code></pre></td></tr></table></div></div><blockquote><p>‚ö†Ô∏è <strong>Warning</strong></p><p>The <code>&lt;pending></code> shown in the <code>EXTERNAL-IP</code> column is due that we are using <strong>minikube</strong>.</p></blockquote><p>Cool ! How can we access the application now? How can we get the URL of the deployed application?</p><p>Euuuuh! The answer is shorter than the question :D to get the URL of the deployed app on <code>minikube</code> just type:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ open <span class=k>$(</span>minikube service myschool --url<span class=k>)</span>
</span></span></code></pre></td></tr></table></div></div><p>This command will open the URL of the Spring Boot Application in your default browser :)</p><div align=center><p><img loading=lazy src=../images/hosted-app.webp alt="Landing Page of the deployed application on Kubernetes"></p></div><blockquote><p>üí° <strong>Tip</strong></p><p>The command <code>minikube service myschool --url</code> will give us the path of the service <code>myschool</code>, which is pointing on our Spring Boot Application.</p></blockquote><p>How can I access the Swagger UI of my deployed App?</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ open <span class=k>$(</span>minikube service myschool --url<span class=k>)</span>/swagger-ui.html
</span></span></code></pre></td></tr></table></div></div><p>This command will open the URL of the Spring Boot Application in your default browser :)</p><div align=center><p><img loading=lazy src=../images/hosted-swagger.webp alt="Swagger UI of the deployed application on Kubernetes"></p></div><p>The full source code of this tutorial, can be found <a href=https://github.com/nebrass/playing-with-spring-boot-on-k8s>here</a>.</p><h2 id=iv-conclusion--final-words>IV. Conclusion & final words:<a hidden class=anchor aria-hidden=true href=#iv-conclusion--final-words>#</a></h2><p>The main goal of this tutorial is to introduce you to the Kubernetes ecosystem and to let you start playing with Kubernetes.</p><p>Putting your hands on practical exercices on Kubernetes will let you master this great platform. You will be able to feel the performance of Kubernetes when you experience many use cases.</p><p>You can consider the small application that we developed as a small microservice. You can develop other small apps and make interaction with them to start playing with the microservices architecture.</p><p>What other areas around Java Microservices, Docker and Kubernetes would you like to know? Let me know at <a href=mailto:lnibrass@gmail.com>my mail</a>. I plan on making additional tutorials on these topics. I will be happy to pick topics based on your feedback!</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.nebrass.fr/tags/java/>java</a></li><li><a href=https://blog.nebrass.fr/tags/kubernetes/>kubernetes</a></li><li><a href=https://blog.nebrass.fr/tags/spring-boot/>spring-boot</a></li></ul><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Playing with Spring Boot on Kubernetes on twitter" href="https://twitter.com/intent/tweet/?text=Playing%20with%20Spring%20Boot%20on%20Kubernetes&url=https%3a%2f%2fblog.nebrass.fr%2fplaying-with-spring-boot-on-kubernetes%2f&hashtags=java%2ckubernetes%2cspring-boot"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Playing with Spring Boot on Kubernetes on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fblog.nebrass.fr%2fplaying-with-spring-boot-on-kubernetes%2f&title=Playing%20with%20Spring%20Boot%20on%20Kubernetes&summary=Playing%20with%20Spring%20Boot%20on%20Kubernetes&source=https%3a%2f%2fblog.nebrass.fr%2fplaying-with-spring-boot-on-kubernetes%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Playing with Spring Boot on Kubernetes on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fblog.nebrass.fr%2fplaying-with-spring-boot-on-kubernetes%2f&title=Playing%20with%20Spring%20Boot%20on%20Kubernetes"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Playing with Spring Boot on Kubernetes on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.nebrass.fr%2fplaying-with-spring-boot-on-kubernetes%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Playing with Spring Boot on Kubernetes on whatsapp" href="https://api.whatsapp.com/send?text=Playing%20with%20Spring%20Boot%20on%20Kubernetes%20-%20https%3a%2f%2fblog.nebrass.fr%2fplaying-with-spring-boot-on-kubernetes%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Playing with Spring Boot on Kubernetes on telegram" href="https://telegram.me/share/url?text=Playing%20with%20Spring%20Boot%20on%20Kubernetes&url=https%3a%2f%2fblog.nebrass.fr%2fplaying-with-spring-boot-on-kubernetes%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://blog.nebrass.fr>Nebrass Homepage</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script></body></html>